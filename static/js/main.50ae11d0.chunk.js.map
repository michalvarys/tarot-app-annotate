{"version":3,"sources":["Theme/index.js","SidebarBoxContainer/index.js","colors.js","ClassSelectionMenu/index.js","DebugSidebarBox/index.js","HistorySidebarBox/index.js","Crosshairs/index.js","ImageCanvas/styles.js","PreventScrollToParents/index.js","hooks/use-window-size.js","ImageCanvas/use-mouse.js","ImageCanvas/use-project-box.js","ImageCanvas/region-tools.js","PointDistances/index.js","RegionLabel/styles.js","RegionLabel/index.js","RegionTags/index.js","ImageMask/load-image.js","ImageMask/index.js","HighlightBox/index.js","RegionSelectAndTransformBoxes/index.js","SettingsProvider/index.js","VideoOrImageCanvasBackground/index.js","RegionShapes/index.js","ImageCanvas/index.js","ImageCanvas/use-wasd-mode.js","hooks/use-exclude-pattern.js","hooks/xpattern.js","ImageSelectorSidebarBox/index.js","KeyframeTimeline/get-time-string.js","KeyframeTimeline/index.js","KeyframesSelectorSidebarBox/index.js","RegionSelectorSidebarBox/styles.js","RegionSelectorSidebarBox/index.js","SettingsDialog/index.js","TagsSidebarBox/index.js","TaskDescriptionSidebarBox/index.js","Annotator/reducers/get-active-image.js","utils/get-hotkey-help-text.js","MainLayout/icon-dictionary.js","MainLayout/styles.js","ShortcutsManager/index.js","Annotator/reducers/get-implied-video-regions.js","MainLayout/use-implied-video-regions.js","MainLayout/index.js","Annotator/reducers/history-handler.js","Annotator/reducers/convert-expanding-line-to-polygon.js","utils/get-landmarks-with-transform.js","Annotator/reducers/general-reducer.js","utils/set-in-local-storage.js","utils/get-from-local-storage.js","Annotator/reducers/image-reducer.js","Annotator/reducers/video-reducer.js","Annotator/index.js","Annotator/reducers/combine-reducers.js","DemoSite/index.js","index.js"],"names":["useStyles","makeStyles","theme","container","fontFamily","createTheme","typography","overrides","MuiButton","root","textTransform","Theme","children","ThemeProvider","margin","header","display","flexDirection","alignItems","padding","paddingLeft","paddingRight","title","fontSize","fontWeight","flexGrow","color","grey","expandButton","width","height","marginTop","transition","transform","expandedContent","maxHeight","overflowY","overflow","memo","icon","subTitle","noScroll","expandedByDefault","classes","classnames","useState","expanded","changeExpanded","useEventCallback","SidebarBox","prev","next","colors","muiColors","map","c","rrggbb","bbggrr","replace","substr","parseInt","reverseParseColor","LabelContainer","styled","paddingTop","paddingBottom","cursor","opacity","backgroundColor","Circle","borderRadius","marginRight","Label","DashSep","borderBottom","marginLeft","Number","textAlign","minWidth","ClassSelectionMenu","selectedCls","regionClsList","onSelectCls","useEffect","keyMapping","i","length","onKeyDown","e","key","preventDefault","stopPropagation","window","addEventListener","removeEventListener","style","label","index","className","selected","onClick","capitalize","Box","pb","DebugSidebarBox","state","lastAction","image","images","selectedImage","region","regions","filter","r","highlighted","JSON","stringify","mode","selectedImageFrameTime","emptyText","listItemTextStyle","history","onRestoreHistory","List","name","time","ListItem","button","dense","ListItemText","primary","secondary","moment","format","ListItemSecondaryAction","IconButton","prevProps","nextProps","isEqual","a","Crosshairs","mousePosition","x","y","changeForceRenderState","current","interval","setInterval","clearInterval","position","zIndex","left","pointerEvents","top","canvas","zoomIndicator","bottom","right","fixedRegionLabel","Container","PreventScrollToParents","otherProps","mouseOver","changeMouseOver","onMouseMove","onMouseLeave","setTimeout","enabled","removeScrollBar","useWindowSize","initialWidth","Infinity","initialHeight","isClient","useRafState","innerWidth","innerHeight","setState","handler","useInterval","canvasEl","changeMat","changeDragging","zoomStart","zoomEnd","changeZoomStart","changeZoomEnd","layoutParams","zoomWithPrimary","dragWithPrimary","mat","onMouseUp","onMouseDown","dragging","useRef","prevMousePosition","zoomIn","direction","point","mx","my","scale","to","translate","scaleU","clone","mouseEvents","getBoundingClientRect","clientX","clientY","projMouse","applyToPoint","iw","ih","specialEvent","type","Math","abs","min","newMat","Matrix","from","onWheel","deltaY","onContextMenu","bbox","box","points","w","h","max","minX","Object","values","minY","x1","y1","Error","getEnclosingBox","cbox","inverse","d","Svg","fill","vectorEffect","strokeWidth","stroke","strokeDasharray","animationDuration","animationTimingFunction","animationIterationCount","animationPlayState","PointDistances","projectRegionBox","pointDistancePrecision","realSize","r1","flatMap","i1","r2","i2","pr1","pr2","prm","displayDistance","unitName","sqrt","pow","toFixed","regionInfo","boxShadow","textDecoration","commentBox","styles","editing","allowedClasses","allowedTags","onDelete","onChange","onClose","onOpen","onRegionClassAdded","allowComments","commentInputRef","Paper","textShadow","tabIndex","size","variant","placeholder","o","actionMeta","action","value","cls","options","asMutable","newTags","tags","t","isMulti","TextField","InputProps","fullWidth","multiline","rows","ref","_","commentInput","focus","comment","event","target","Button","RegionTags","regionTagList","onBeginRegionEdit","onChangeRegion","onCloseRegionEdit","onDeleteRegion","imageSrc","RegionEditLabel","RegionLabel","DefaultRegionLabel","visible","undefined","pbox","labelBoxHeight","editingLabels","locked","displayOnTop","coords","id","onMouseEnter","obj","args","newObj","copyWithout","loadImage","Array","document","getElementsByTagName","find","img","src","createElement","ctx","getContext","Image","crossOrigin","Promise","resolve","reject","onload","naturalWidth","naturalHeight","drawImage","imageData","getImageData","ImageMask","imagePosition","hide","autoSegmentationOptions","canvasRef","setCanvasRef","sampleImageData","setSampleImageData","then","autoseg","setConfig","classNames","useDebounce","cp","udtRegions","regionType","classification","centerX","centerY","Boolean","convertToUDTRegions","getMask","maskImageData","context","clearRect","putImageData","useMemo","bottomRight","topLeft","imageRendering","isNaN","strokeDashoffset","highlightBox","animationName","HighlightBox","createWithPrimary","onBeginMovePoint","onSelectRegion","unfinished","styleCoords","pathD","TransformGrabber","border","boxCursorMap","RegionSelectAndTransformBox","fullImageSegmentationMode","onBeginBoxTransform","onBeginMovePolygonPoint","onBeginMoveKeypoint","onAddPolygonPoint","showHighlightBox","px","py","proj","open","p1","p2","pa","entries","keypointId","Tooltip","RegionSelectAndTransformBoxes","props","n","p","SettingsContext","createContext","showCrosshairs","wasdMode","useSettings","useContext","SettingsProvider","localStorage","settings","startsWith","parse","getItem","pullSettingsFromLocalStorage","changeState","Provider","changeSetting","setting","setItem","Video","StyledImage","whiteSpace","videoTime","videoSrc","onLoad","useCrossOrigin","videoPlaying","onChangeVideoTime","onChangeVideoPlaying","videoRef","imageRef","error","setError","currentTime","renderLoopRunning","play","videoPlaybackSpeed","playbackRate","parseFloat","pause","checkForNewFrame","newVideoTime","floor","paused","requestAnimationFrame","onLoadedVideoMetadata","videoElm","currentTarget","videoWidth","videoHeight","duration","onImageLoaded","imageElm","onImageError","stylePosition","onError","onLoadedMetadata","clamp","num","RegionComponents","line","x2","y2","colorAlpha","polygon","fullSegmentationMode","Component","join","keypoints","keypointDefinitions","keypointsDefinitionId","landmarks","connections","kp1Id","kp2Id","kp1","kp2","midPoint","expandingWidth","slice","pointPairs","angle","atan2","PI","dx","sin","dy","cos","firstSection","secondSection","reverse","lastPoint","concat","candidatePoint","pixel","WrappedRegionList","regionId","RegionShapes","getDefaultMat","allowedArea","ImageCanvas","showTags","showPointDistances","showMask","onImageOrVideoLoaded","zoomOnAllowedArea","modifyingAllowedArea","windowSize","getLatestMat","dirs","s","keysDown","keys","keyDownListener","includes","keyUpListener","somethingChanged","useWasdMode","useMouse","useLayoutEffect","useProjectRegionBox","imageDimensions","changeImageDimensions","imageLoaded","onVideoOrImageLoaded","dims","excludePattern","pattern","createPattern","useExcludePattern","clientWidth","clientHeight","fitScale","canvasWidth","canvasHeight","save","toArray","globalAlpha","outer","inner","moveTo","forEach","lineTo","closePath","fillStyle","restore","zoomBox","highlightedRegion","highlightedRegions","disableClose","VideoOrImageCanvasBackground","mapUsedImageProps","onSelect","getTimeString","ms","precision","secs","isInteger","mins","Tick","TickText","userSelect","PositionCursor","placeItems","fontVariantNumeric","content","borderTop","borderLeft","borderRight","KeyframeMarker","borderTopLeftRadius","borderTopRightRadius","displayIntervalPairs","onChangeCurrentTime","keyframes","useMeasure","bounds","instantCurrentTime","changeInstantCurrentTime","draggingTime","changeDraggingTime","keyframeTimes","sort","b","minor","major","getMajorInterval","minorInterval","majorInterval","newTime","range","kt","KeyframeRow","KeyframesSelectorSidebarBox","currentVideoTime","onDeleteKeyframe","row","blue","chip","HeaderSep","marginBottom","Chip","text","RowLayout","order","area","trash","lock","Grid","item","xs","MemoRowHeader","MemoRow","emptyArr","mapUsedRegionProperties","SettingsDialog","Dialog","DialogTitle","DialogContent","noActions","defaultAnswers","onQuestionChange","q","answers","form","questions","defaultValue","choices","DialogActions","noop","currentImage","imageClsList","imageTagList","onChangeImage","onChangeClassification","onChangeTags","selectValue","memoImgClsList","memoImgTagList","memoCurrentTags","MarkdownContainer","description","source","pathToActiveImage","activeImage","currentImageIndex","annotationType","getIn","getHotkeyHelpText","commandName","firstSequence","getApplicationKeyMap","sequences","sequence","faStyle","iconDictionary","select","fixedWidth","faMousePointer","pan","faHandPaper","zoom","faSearch","faTag","faCrosshairs","faVectorSquare","faDrawPolygon","faGripLines","faChartLine","faMask","faEdit","AccessibilityNewIcon","FullscreenIcon","headerTitle","defaultKeyMap","binding","useDispatchHotkeyHandlers","dispatch","select_tool","selectedTool","zoom_tool","create_point","create_bounding_box","pan_tool","create_polygon","create_pixel","save_and_previous_sample","buttonName","save_and_next_sample","save_and_exit_sample","delete_region","undo","nextKeyframeTimeIndex","findIndex","t1","prevKeyframe","t2","nextKeyframe","prevRegionMap","nextRegionMap","impliedRegions","w1","w2","push","pp","newPoints","pointId","prevPoint","HotkeyDiv","withHotKeys","hotKeys","divRef","FullScreenContainer","MainLayout","alwaysShowNextButton","alwaysShowPrevButton","hideHeader","hideHeaderText","hideNext","hidePrev","hideClone","hideSettings","hideFullScreen","hideSave","fullScreenHandle","useFullScreenHandle","memoizedActionFns","params","fnKey","fn","reduce","acc","getActiveImage","nextImage","useKey","detectKeys","frameTime","innerContainerRef","hotkeyHandlers","impliedVideoRegions","getImpliedVideoRegions","useImpliedVideoRegions","refocusOnMouseEvent","useCallback","contains","activeElement","onClickIconSidebarItem","onClickHeaderItem","enter","exit","debugModeOn","$ANNOTATE_DEBUG_MODE","nextImageHasRegions","handle","onMouseOver","allowChanges","handlers","fullScreen","Workspace","allowFullscreen","headerLeftSide","KeyframeTimeline","videoDuration","headerItems","selectedTools","iconSidebarItems","helperText","alwaysShowing","enabledTools","rightSidebarItems","taskDescription","labelImages","settingsOpen","typesToSaveWithHistory","BEGIN_BOX_TRANSFORM","BEGIN_MOVE_POINT","DELETE_REGION","saveToHistory","updateIn","toDate","without","expandingLine","center","defaultPosition","getRandomId","random","toString","split","aa","oldRegionClsList","Date","now","lastMouseMoveCall","setIn","getRegionIndex","regionIndex","getRegion","modifyRegion","closeEditors","setNewImage","imageIndex","oldRegion","clsIndex","indexOf","delta","directions","freedom","original","pointIndex","splice","mouseDownAt","moveRegion","xFree","yFree","ox","oy","ow","oh","dw","dh","distFromCenter","getLandmarksWithTransform","mouseDistFromLastPoint","convertExpandingLineToPolygon","newRegion","defaultRegionCls","defaultRegionColor","editLabelEditorAfter","isNew","newExpandingLine","jointStart","newRegions","toLowerCase","val","some","metadata","copyImpliedRegions","isPlaying","Annotator","getFromLocalStorage","videoName","onExit","onNextImage","onPrevImage","onImageChange","useReducer","reducer","reducers","combineReducers","imageReducer","videoReducer","generalReducer","prevState","nextState","makeImmutable","dispatchToReducer","at","API","getImages","fetch","headers","res","json","data","cards","card","console","log","setSelectedImage","setImages","loadImages","saveImage","pixelSize","method","body","isLabelOn","Set","flat","Site","DemoSite","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.50ae11d0.chunk.js","sourcesContent":["// @flow\n\nimport React from \"react\"\nimport { ThemeProvider, createTheme } from \"@mui/material/styles\"\nimport { makeStyles } from \"@mui/styles\"\n\nconst useStyles = makeStyles((theme) => ({\n  container: {\n    fontFamily: '\"Inter\", sans-serif',\n  },\n}))\n\nconst theme = createTheme({\n  typography: {\n    fontFamily: '\"Inter\", \"Roboto\", sans-serif',\n  },\n  overrides: {\n    MuiButton: {\n      root: {\n        textTransform: \"none\",\n      },\n    },\n  },\n})\n\nexport const Theme = ({ children }: any) => {\n  const classes = useStyles()\n  return (\n    <ThemeProvider theme={theme}>\n      {/* <div className={classes.container}>{children}</div> */}\n      <div>{children}</div>\n    </ThemeProvider>\n  )\n}\n\nexport default Theme\n","// @flow\n\nimport React, { useState, memo } from \"react\"\nimport Paper from \"@mui/material/Paper\"\nimport { makeStyles } from \"@mui/styles\"\nimport { createTheme, ThemeProvider } from \"@mui/material/styles\"\nimport ExpandIcon from \"@mui/icons-material/ExpandMore\"\nimport IconButton from \"@mui/material/IconButton\"\nimport Collapse from \"@mui/material/Collapse\"\nimport { grey } from \"@mui/material/colors\"\nimport classnames from \"classnames\"\nimport useEventCallback from \"use-event-callback\"\nimport SidebarBox from \"react-material-workspace-layout/SidebarBox\"\n\nconst theme = createTheme()\nconst useStyles = makeStyles((theme) => ({\n  container: { margin: 8 },\n  header: {\n    display: \"flex\",\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    padding: 8,\n    paddingLeft: 16,\n    paddingRight: 16,\n  },\n  title: {\n    fontSize: 14,\n    fontWeight: \"bold\",\n    flexGrow: 1,\n    paddingLeft: 8,\n    color: grey[800],\n    \"& span\": {\n      color: grey[600],\n      fontSize: 12,\n    },\n  },\n  expandButton: {\n    padding: 0,\n    width: 30,\n    height: 30,\n    \"& .icon\": {\n      marginTop: -6,\n      width: 20,\n      height: 20,\n      transition: \"500ms transform\",\n      \"&.expanded\": {\n        transform: \"rotate(180deg)\",\n      },\n    },\n  },\n  expandedContent: {\n    maxHeight: 300,\n    overflowY: \"auto\",\n    \"&.noScroll\": {\n      overflowY: \"visible\",\n      overflow: \"visible\",\n    },\n  },\n}))\n\nexport const SidebarBoxContainer = ({\n  icon,\n  title,\n  subTitle,\n  children,\n  noScroll = false,\n  expandedByDefault = false,\n}) => {\n  const classes = useStyles()\n  const content = (\n    <div\n      className={classnames(classes.expandedContent, noScroll && \"noScroll\")}\n    >\n      {children}\n    </div>\n  )\n\n  const [expanded, changeExpanded] = useState(expandedByDefault)\n  const toggleExpanded = useEventCallback(() => changeExpanded(!expanded))\n\n  return (\n    <ThemeProvider theme={theme}>\n      <SidebarBox icon={icon} title={title}>\n        {children}\n      </SidebarBox>\n    </ThemeProvider>\n  )\n}\n\nexport default memo(\n  SidebarBoxContainer,\n  (prev, next) => prev.title === next.title && prev.children === next.children\n)\n","// @flow\n\nimport * as muiColors from \"@mui/material/colors\"\n\nexport const colors = [\n  muiColors.red[500],\n  muiColors.blue[500],\n  muiColors.green[500],\n  muiColors.orange[800],\n  muiColors.brown[500],\n  muiColors.lightGreen[700],\n  muiColors.pink[500],\n  muiColors.purple[500],\n  muiColors.indigo[500],\n  muiColors.teal[500],\n  muiColors.lime[500],\n  muiColors.blueGrey[500],\n]\n\nconst transparency = 0x88000000\n\nfunction reverseParseColor(rrggbb) {\n  rrggbb = rrggbb.replace(\"#\", \"\")\n  const bbggrr = rrggbb.substr(4, 2) + rrggbb.substr(2, 2) + rrggbb.substr(0, 2)\n  return parseInt(bbggrr, 16)\n}\n\nexport const colorInts: Array<number> = colors.map(\n  (c) => (reverseParseColor(c) | transparency) >>> 0\n)\n\nexport default colors\n","import React, { useEffect } from \"react\"\nimport { styled } from \"@mui/material/styles\"\nimport { createTheme, ThemeProvider } from \"@mui/material/styles\"\nimport Box from \"@mui/material/Box\"\nimport * as muiColors from \"@mui/material/colors\"\nimport SidebarBoxContainer from \"../SidebarBoxContainer\"\nimport colors from \"../colors\"\nimport BallotIcon from \"@mui/icons-material/Ballot\"\nimport capitalize from \"lodash/capitalize\"\nimport classnames from \"classnames\"\n\nconst theme = createTheme()\nconst LabelContainer = styled(\"div\")(({ theme }) => ({\n  display: \"flex\",\n  paddingTop: 4,\n  paddingBottom: 4,\n  paddingLeft: 16,\n  paddingRight: 16,\n  alignItems: \"center\",\n  cursor: \"pointer\",\n  opacity: 0.7,\n  backgroundColor: \"#fff\",\n  \"&:hover\": {\n    opacity: 1,\n  },\n  \"&.selected\": {\n    opacity: 1,\n    fontWeight: \"bold\",\n  },\n}))\nconst Circle = styled(\"div\")(({ theme }) => ({\n  width: 12,\n  height: 12,\n  borderRadius: 12,\n  marginRight: 8,\n}))\nconst Label = styled(\"div\")(({ theme }) => ({\n  fontSize: 11,\n}))\nconst DashSep = styled(\"div\")(({ theme }) => ({\n  flexGrow: 1,\n  borderBottom: `2px dotted ${muiColors.grey[300]}`,\n  marginLeft: 8,\n  marginRight: 8,\n}))\nconst Number = styled(\"div\")(({ theme }) => ({\n  fontSize: 11,\n  textAlign: \"center\",\n  minWidth: 14,\n  paddingTop: 2,\n  paddingBottom: 2,\n  fontWeight: \"bold\",\n  color: muiColors.grey[700],\n}))\n\nexport const ClassSelectionMenu = ({\n  selectedCls,\n  regionClsList,\n  onSelectCls,\n}) => {\n  useEffect(() => {\n    const keyMapping = {}\n    for (let i = 0; i < 9 && i < regionClsList.length; i++) {\n      keyMapping[i + 1] = () => onSelectCls(regionClsList[i])\n    }\n    const onKeyDown = (e) => {\n      if (keyMapping[e.key]) {\n        keyMapping[e.key]()\n        e.preventDefault()\n        e.stopPropagation()\n      }\n    }\n    window.addEventListener(\"keydown\", onKeyDown)\n    return () => window.removeEventListener(\"keydown\", onKeyDown)\n  }, [regionClsList, selectedCls])\n\n  return (\n    <ThemeProvider theme={theme}>\n      <SidebarBoxContainer\n        title=\"Classifications\"\n        subTitle=\"\"\n        icon={<BallotIcon style={{ color: muiColors.grey[700] }} />}\n        expandedByDefault\n      >\n        {regionClsList.map((label, index) => (\n          <LabelContainer\n            className={classnames({ selected: label === selectedCls })}\n            onClick={() => onSelectCls(label)}\n          >\n            <Circle\n              style={{ backgroundColor: colors[index % colors.length] }}\n            />\n            <Label className={classnames({ selected: label === selectedCls })}>\n              {capitalize(label)}\n            </Label>\n            <DashSep />\n            <Number className={classnames({ selected: label === selectedCls })}>\n              {index < 9 ? `Key [${index + 1}]` : \"\"}\n            </Number>\n          </LabelContainer>\n        ))}\n        <Box pb={2} />\n      </SidebarBoxContainer>\n    </ThemeProvider>\n  )\n}\n\nexport default ClassSelectionMenu\n","// @flow\n\nimport React from \"react\"\nimport SidebarBoxContainer from \"../SidebarBoxContainer\"\n\nexport const DebugSidebarBox = ({ state, lastAction }: any) => {\n  const image = (state.images || [])[state.selectedImage]\n  const region = image\n    ? (image.regions || []).filter((r) => r.highlighted)\n    : null\n\n  return (\n    <SidebarBoxContainer title=\"Debug\" icon={<span />} expandedByDefault>\n      <div style={{ padding: 4 }}>\n        <div>\n          <b>region</b>:\n        </div>\n        <pre>{JSON.stringify(region, null, \"  \")}</pre>\n        <div>\n          <b>lastAction</b>:\n        </div>\n        <pre>{JSON.stringify(lastAction, null, \"  \")}</pre>\n        <div>\n          <b>mode</b>:\n        </div>\n        <pre>{JSON.stringify(state.mode, null, \"  \")}</pre>\n        <div>\n          <b>frame:</b>\n        </div>\n        <pre>{JSON.stringify(state.selectedImageFrameTime, null, \"  \")}</pre>\n      </div>\n    </SidebarBoxContainer>\n  )\n}\n\nexport default DebugSidebarBox\n","// @flow\n\nimport React, { setState, memo } from \"react\"\nimport { makeStyles } from \"@mui/styles\"\nimport { createTheme, ThemeProvider } from \"@mui/material/styles\"\nimport SidebarBoxContainer from \"../SidebarBoxContainer\"\nimport HistoryIcon from \"@mui/icons-material/History\"\nimport List from \"@mui/material/List\"\nimport ListItem from \"@mui/material/ListItem\"\nimport ListItemText from \"@mui/material/ListItemText\"\nimport IconButton from \"@mui/material/IconButton\"\nimport ListItemSecondaryAction from \"@mui/material/ListItemSecondaryAction\"\nimport UndoIcon from \"@mui/icons-material/Undo\"\nimport moment from \"moment\"\nimport { grey } from \"@mui/material/colors\"\nimport isEqual from \"lodash/isEqual\"\nimport Box from \"@mui/material/Box\"\n\nconst theme = createTheme()\nconst useStyles = makeStyles((theme) => ({\n  emptyText: {\n    fontSize: 14,\n    fontWeight: \"bold\",\n    color: grey[500],\n    textAlign: \"center\",\n    padding: 20,\n  },\n}))\n\nconst listItemTextStyle = { paddingLeft: 16 }\n\nexport const HistorySidebarBox = ({\n  history,\n  onRestoreHistory,\n}: {\n  history: Array<{ name: string, time: Date }>,\n}) => {\n  const classes = useStyles()\n\n  return (\n    <ThemeProvider theme={theme}>\n      <SidebarBoxContainer\n        title=\"History\"\n        icon={<HistoryIcon style={{ color: grey[700] }} />}\n        expandedByDefault\n      >\n        <List>\n          {history.length === 0 && (\n            <div className={classes.emptyText}>No History Yet</div>\n          )}\n          {history.map(({ name, time }, i) => (\n            <ListItem button dense key={i}>\n              <ListItemText\n                style={listItemTextStyle}\n                primary={name}\n                secondary={moment(time).format(\"LT\")}\n              />\n              {i === 0 && (\n                <ListItemSecondaryAction onClick={() => onRestoreHistory()}>\n                  <IconButton>\n                    <UndoIcon />\n                  </IconButton>\n                </ListItemSecondaryAction>\n              )}\n            </ListItem>\n          ))}\n        </List>\n      </SidebarBoxContainer>\n    </ThemeProvider>\n  )\n}\n\nexport default memo(HistorySidebarBox, (prevProps, nextProps) =>\n  isEqual(\n    prevProps.history.map((a) => [a.name, a.time]),\n    nextProps.history.map((a) => [a.name, a.time])\n  )\n)\n","// @flow\n\nimport React, { Fragment, useEffect, useState } from \"react\"\n\nexport const Crosshairs = ({\n  mousePosition,\n  x,\n  y,\n}: {\n  mousePosition: { current: { x: number, y: number } },\n  x?: number,\n  y?: number,\n}) => {\n  const [forceRenderState, changeForceRenderState] = useState()\n\n  if (mousePosition) {\n    x = mousePosition.current.x\n    y = mousePosition.current.y\n  }\n\n  useEffect(() => {\n    if (!mousePosition) return\n    const interval = setInterval(() => {\n      if (x !== mousePosition.current.x || y !== mousePosition.current.y) {\n        changeForceRenderState([\n          mousePosition.current.x,\n          mousePosition.current.y,\n        ])\n      }\n    }, 10)\n    return () => clearInterval(interval)\n  })\n\n  return (\n    <Fragment>\n      <div\n        style={{\n          position: \"absolute\",\n          height: \"100%\",\n          width: 1,\n          zIndex: 10,\n          backgroundColor: \"#f00\",\n          left: x,\n          pointerEvents: \"none\",\n          top: 0,\n        }}\n      />\n      <div\n        style={{\n          position: \"absolute\",\n          width: \"100%\",\n          zIndex: 10,\n          height: 1,\n          backgroundColor: \"#f00\",\n          top: y,\n          pointerEvents: \"none\",\n          left: 0,\n        }}\n      />\n    </Fragment>\n  )\n}\n\nexport default Crosshairs\n","import { grey } from \"@mui/material/colors\"\n\nexport default {\n  canvas: { width: \"100%\", height: \"100%\", position: \"relative\", zIndex: 1 },\n  zoomIndicator: {\n    position: \"absolute\",\n    bottom: 16,\n    right: 0,\n    backgroundColor: \"rgba(0,0,0,0.4)\",\n    color: \"#fff\",\n    opacity: 0.5,\n    fontWeight: \"bolder\",\n    fontSize: 14,\n    padding: 4,\n  },\n  fixedRegionLabel: {\n    position: \"absolute\",\n    zIndex: 10,\n    top: 10,\n    left: 10,\n    opacity: 0.5,\n    transition: \"opacity 500ms\",\n    \"&:hover\": {\n      opacity: 1,\n    },\n  },\n}\n","// @flow\n\nimport React, { useState } from \"react\"\nimport { RemoveScroll } from \"react-remove-scroll\"\nimport { styled } from \"@mui/material/styles\"\nimport { createTheme, ThemeProvider } from \"@mui/material/styles\"\nimport useEventCallback from \"use-event-callback\"\n\nconst theme = createTheme()\nconst Container = styled(\"div\")(({ theme }) => ({\n  \"& > div\": {\n    width: \"100%\",\n    height: \"100%\",\n  },\n}))\n\nexport const PreventScrollToParents = ({ children, ...otherProps }) => {\n  const [mouseOver, changeMouseOver] = useState(false)\n  const onMouseMove = useEventCallback((e) => {\n    if (!mouseOver) changeMouseOver(true)\n    if (otherProps.onMouseMove) {\n      otherProps.onMouseMove(e)\n    }\n  })\n  const onMouseLeave = useEventCallback((e) => {\n    setTimeout(() => {\n      if (mouseOver) {\n        changeMouseOver(false)\n      }\n    }, 100)\n  })\n\n  return (\n    <ThemeProvider theme={theme}>\n      <Container\n        {...otherProps}\n        onMouseMove={onMouseMove}\n        onMouseLeave={onMouseLeave}\n      >\n        <RemoveScroll enabled={mouseOver} removeScrollBar={false}>\n          {children}\n        </RemoveScroll>\n      </Container>\n    </ThemeProvider>\n  )\n}\n\nexport default PreventScrollToParents\n","// @flow\n\nimport { useEffect } from \"react\"\n\nimport { useRafState, useInterval } from \"react-use\"\n\nconst useWindowSize = (initialWidth = Infinity, initialHeight = Infinity) => {\n  const isClient = typeof window !== \"undefined\"\n  const [state, setState] = useRafState({\n    width: isClient ? window.innerWidth : initialWidth,\n    height: isClient ? window.innerHeight : initialHeight,\n  })\n\n  useEffect(() => {\n    if (!isClient) return\n    const handler = () => {\n      setState({\n        width: window.innerWidth,\n        height: window.innerHeight,\n      })\n    }\n\n    window.addEventListener(\"resize\", handler)\n\n    return () => {\n      window.removeEventListener(\"resize\", handler)\n    }\n  }, [])\n\n  useInterval(() => {\n    if (!isClient) return\n    if (\n      window.innerWidth !== state.width ||\n      window.innerHeight !== state.height\n    ) {\n      setState({\n        width: window.innerWidth,\n        height: window.innerHeight,\n      })\n    }\n  }, 100)\n\n  return state\n}\n\nexport default useWindowSize\n","// @flow weak\n\nimport { useRef } from \"react\"\nimport { Matrix } from \"transformation-matrix-js\"\n\nconst getDefaultMat = () => Matrix.from(1, 0, 0, 1, -10, -10)\n\nexport default ({\n  canvasEl,\n  changeMat,\n  changeDragging,\n  zoomStart,\n  zoomEnd,\n  changeZoomStart,\n  changeZoomEnd,\n  layoutParams,\n  zoomWithPrimary,\n  dragWithPrimary,\n  mat,\n  onMouseMove,\n  onMouseUp,\n  onMouseDown,\n  dragging,\n}) => {\n  const mousePosition = useRef({ x: 0, y: 0 })\n  const prevMousePosition = useRef({ x: 0, y: 0 })\n\n  const zoomIn = (direction, point) => {\n    const [mx, my] = [point.x, point.y]\n    let scale =\n      typeof direction === \"object\" ? direction.to / mat.a : 1 + 0.2 * direction\n\n    // NOTE: We're mutating mat here\n    mat.translate(mx, my).scaleU(scale)\n    if (mat.a > 2) mat.scaleU(2 / mat.a)\n    if (mat.a < 0.05) mat.scaleU(0.05 / mat.a)\n    mat.translate(-mx, -my)\n\n    changeMat(mat.clone())\n  }\n\n  const mouseEvents = {\n    onMouseMove: (e) => {\n      const { left, top } = canvasEl.current.getBoundingClientRect()\n      prevMousePosition.current.x = mousePosition.current.x\n      prevMousePosition.current.y = mousePosition.current.y\n      mousePosition.current.x = e.clientX - left\n      mousePosition.current.y = e.clientY - top\n\n      const projMouse = mat.applyToPoint(\n        mousePosition.current.x,\n        mousePosition.current.y\n      )\n\n      if (zoomWithPrimary && zoomStart) {\n        changeZoomEnd(projMouse)\n      }\n\n      const { iw, ih } = layoutParams.current\n      onMouseMove({ x: projMouse.x / iw, y: projMouse.y / ih })\n\n      if (dragging) {\n        mat.translate(\n          prevMousePosition.current.x - mousePosition.current.x,\n          prevMousePosition.current.y - mousePosition.current.y\n        )\n\n        changeMat(mat.clone())\n      }\n      e.preventDefault()\n    },\n    onMouseDown: (e, specialEvent = {}) => {\n      e.preventDefault()\n\n      if (\n        e.button === 1 ||\n        e.button === 2 ||\n        (e.button === 0 && dragWithPrimary)\n      )\n        return changeDragging(true)\n\n      const projMouse = mat.applyToPoint(\n        mousePosition.current.x,\n        mousePosition.current.y\n      )\n      if (zoomWithPrimary && e.button === 0) {\n        changeZoomStart(projMouse)\n        changeZoomEnd(projMouse)\n        return\n      }\n      if (e.button === 0) {\n        if (specialEvent.type === \"resize-box\") {\n          // onResizeBox()\n        }\n        if (specialEvent.type === \"move-region\") {\n          // onResizeBox()\n        }\n        const { iw, ih } = layoutParams.current\n        onMouseDown({ x: projMouse.x / iw, y: projMouse.y / ih })\n      }\n    },\n    onMouseUp: (e) => {\n      e.preventDefault()\n      const projMouse = mat.applyToPoint(\n        mousePosition.current.x,\n        mousePosition.current.y\n      )\n      if (zoomStart) {\n        const zoomEnd = projMouse\n        if (\n          Math.abs(zoomStart.x - zoomEnd.x) < 10 &&\n          Math.abs(zoomStart.y - zoomEnd.y) < 10\n        ) {\n          if (mat.a < 1) {\n            zoomIn({ to: 1 }, mousePosition.current)\n          } else {\n            zoomIn({ to: 0.25 }, mousePosition.current)\n          }\n        } else {\n          const { iw, ih } = layoutParams.current\n\n          if (zoomStart.x > zoomEnd.x) {\n            ;[zoomStart.x, zoomEnd.x] = [zoomEnd.x, zoomStart.x]\n          }\n          if (zoomStart.y > zoomEnd.y) {\n            ;[zoomStart.y, zoomEnd.y] = [zoomEnd.y, zoomStart.y]\n          }\n\n          // The region defined by zoomStart and zoomEnd should be the new transform\n          let scale = Math.min(\n            (zoomEnd.x - zoomStart.x) / iw,\n            (zoomEnd.y - zoomStart.y) / ih\n          )\n          if (scale < 0.05) scale = 0.05\n          if (scale > 10) scale = 10\n\n          const newMat = getDefaultMat()\n            .translate(zoomStart.x, zoomStart.y)\n            .scaleU(scale)\n\n          changeMat(newMat.clone())\n        }\n\n        changeZoomStart(null)\n        changeZoomEnd(null)\n      }\n      if (\n        e.button === 1 ||\n        e.button === 2 ||\n        (e.button === 0 && dragWithPrimary)\n      )\n        return changeDragging(false)\n      if (e.button === 0) {\n        const { iw, ih } = layoutParams.current\n        onMouseUp({ x: projMouse.x / iw, y: projMouse.y / ih })\n      }\n    },\n    onWheel: (e) => {\n      const direction = e.deltaY > 0 ? 1 : e.deltaY < 0 ? -1 : 0\n      zoomIn(direction, mousePosition.current)\n      // e.preventDefault()\n    },\n    onContextMenu: (e) => {\n      e.preventDefault()\n    },\n  }\n  return { mouseEvents, mousePosition }\n}\n","// @flow weak\nimport useEventCallback from \"use-event-callback\"\nimport { getEnclosingBox } from \"./region-tools.js\"\n\nexport default ({ layoutParams, mat }) => {\n  return useEventCallback((r) => {\n    const { iw, ih } = layoutParams.current\n    const bbox = getEnclosingBox(r)\n    const margin = r.type === \"point\" ? 15 : 2\n    const cbox = {\n      x: bbox.x * iw - margin,\n      y: bbox.y * ih - margin,\n      w: bbox.w * iw + margin * 2,\n      h: bbox.h * ih + margin * 2,\n    }\n    const pbox = {\n      ...mat.clone().inverse().applyToPoint(cbox.x, cbox.y),\n      w: cbox.w / mat.a,\n      h: cbox.h / mat.d,\n    }\n    return pbox\n  })\n}\n","// @flow\n\nexport type BaseRegion = {\n  id: string | number,\n  cls?: string,\n  locked?: boolean,\n  visible?: boolean,\n  color: string,\n  editingLabels?: boolean,\n  highlighted?: boolean,\n  tags?: Array<string>,\n}\n\nexport type Point = {|\n  ...$Exact<BaseRegion>,\n  type: \"point\",\n  x: number,\n  y: number,\n|}\n\nexport type PixelRegion =\n  | {|\n      ...$Exact<BaseRegion>,\n      type: \"pixel\",\n      sx: number,\n      sy: number,\n      w: number,\n      h: number,\n      src: string,\n    |}\n  | {|\n      ...$Exact<BaseRegion>,\n      type: \"pixel\",\n      points: Array<[number, number]>,\n    |}\nexport type Box = {|\n  ...$Exact<BaseRegion>,\n  type: \"box\",\n  x: number,\n  y: number,\n  w: number,\n  h: number,\n|}\n\nexport type Polygon = {|\n  ...$Exact<BaseRegion>,\n  type: \"polygon\",\n  open?: boolean,\n  points: Array<[number, number]>,\n|}\n\nexport type Line = {|\n  ...$Exact<BaseRegion>,\n  type: \"line\",\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number,\n|}\n\nexport type ExpandingLine = {|\n  ...$Exact<BaseRegion>,\n  type: \"expanding-line\",\n  points: Array<{ x: number, y: number, angle: number, width: number }>,\n|}\n\nexport type KeypointDefinition = {|\n  label: string,\n  color: string,\n  defaultPosition: [number, number],\n|}\n\nexport type KeypointId = string\n\nexport type KeypointsDefinition = {|\n  [id: string]: {\n    connections: Array<[KeypointId, KeypointId]>,\n    landmarks: {\n      [KeypointId]: KeypointDefinition,\n    },\n  },\n|}\n\nexport type Keypoints = {|\n  ...$Exact<BaseRegion>,\n  type: \"keypoints\",\n  keypointsDefinitionId: string,\n  points: {\n    [string]: { x: number, y: number },\n  },\n|}\n\nexport type Region =\n  | Point\n  | PixelRegion\n  | Box\n  | Polygon\n  | ExpandingLine\n  | Keypoints\n\nexport const getEnclosingBox = (region: Region) => {\n  switch (region.type) {\n    case \"polygon\": {\n      const box = {\n        x: Math.min(...region.points.map(([x, y]) => x)),\n        y: Math.min(...region.points.map(([x, y]) => y)),\n        w: 0,\n        h: 0,\n      }\n      box.w = Math.max(...region.points.map(([x, y]) => x)) - box.x\n      box.h = Math.max(...region.points.map(([x, y]) => y)) - box.y\n      return box\n    }\n    case \"keypoints\": {\n      const minX = Math.min(\n        ...Object.values(region.points).map(({ x, y }) => x)\n      )\n      const minY = Math.min(\n        ...Object.values(region.points).map(({ x, y }) => y)\n      )\n      const maxX = Math.max(\n        ...Object.values(region.points).map(({ x, y }) => x)\n      )\n      const maxY = Math.max(\n        ...Object.values(region.points).map(({ x, y }) => y)\n      )\n      return {\n        x: minX,\n        y: minY,\n        w: maxX - minX,\n        h: maxY - minY,\n      }\n    }\n    case \"expanding-line\": {\n      const box = {\n        x: Math.min(...region.points.map(({ x, y }) => x)),\n        y: Math.min(...region.points.map(({ x, y }) => y)),\n        w: 0,\n        h: 0,\n      }\n      box.w = Math.max(...region.points.map(({ x, y }) => x)) - box.x\n      box.h = Math.max(...region.points.map(({ x, y }) => y)) - box.y\n      return box\n    }\n    case \"line\": {\n      return { x: region.x1, y: region.y1, w: 0, h: 0 }\n    }\n    case \"box\": {\n      return { x: region.x, y: region.y, w: region.w, h: region.h }\n    }\n    case \"point\": {\n      return { x: region.x, y: region.y, w: 0, h: 0 }\n    }\n    default: {\n      return { x: 0, y: 0, w: 0, h: 0 }\n    }\n  }\n  throw new Error(\"unknown region\")\n}\n\nexport const moveRegion = (region: Region, x: number, y: number) => {\n  switch (region.type) {\n    case \"point\": {\n      return { ...region, x, y }\n    }\n    case \"box\": {\n      return { ...region, x: x - region.w / 2, y: y - region.h / 2 }\n    }\n  }\n  return region\n}\n","// @flow weak\n\nimport React, { Fragment } from \"react\"\nimport { styled } from \"@mui/material/styles\"\nimport { createTheme, ThemeProvider } from \"@mui/material/styles\"\n\nconst theme = createTheme()\nconst Svg = styled(\"svg\")(({ theme }) => ({\n  pointerEvents: \"none\",\n  position: \"absolute\",\n  zIndex: 1,\n  left: 0,\n  top: 0,\n  width: \"100%\",\n  height: \"100%\",\n  \"& text\": {\n    fill: \"#fff\",\n  },\n  \"& path\": {\n    vectorEffect: \"non-scaling-stroke\",\n    strokeWidth: 2,\n    opacity: 0.5,\n    stroke: \"#FFF\",\n    fill: \"none\",\n    strokeDasharray: 5,\n    animationDuration: \"4s\",\n    animationTimingFunction: \"linear\",\n    animationIterationCount: \"infinite\",\n    animationPlayState: \"running\",\n  },\n}))\n\nexport const PointDistances = ({\n  projectRegionBox,\n  regions,\n  pointDistancePrecision,\n  realSize,\n}) => {\n  return (\n    <ThemeProvider theme={theme}>\n      <Svg>\n        {regions\n          .filter((r1) => r1.type === \"point\")\n          .flatMap((r1, i1) =>\n            regions\n              .filter((r2, i2) => i2 > i1)\n              .filter((r2) => r2.type === \"point\")\n              .map((r2) => {\n                const pr1 = projectRegionBox(r1)\n                const pr2 = projectRegionBox(r2)\n                const prm = {\n                  x: (pr1.x + pr1.w / 2 + pr2.x + pr2.w / 2) / 2,\n                  y: (pr1.y + pr1.h / 2 + pr2.y + pr2.h / 2) / 2,\n                }\n                let displayDistance\n                if (realSize) {\n                  const { w, h, unitName } = realSize\n                  displayDistance =\n                    Math.sqrt(\n                      Math.pow(r1.x * w - r2.x * w, 2) +\n                        Math.pow(r1.y * h - r2.y * h, 2)\n                    ).toFixed(pointDistancePrecision) + unitName\n                } else {\n                  displayDistance =\n                    (\n                      Math.sqrt(\n                        Math.pow(r1.x - r2.x, 2) + Math.pow(r1.y - r2.y, 2)\n                      ) * 100\n                    ).toFixed(pointDistancePrecision) + \"%\"\n                }\n                return (\n                  <Fragment>\n                    <path\n                      d={`M${pr1.x + pr1.w / 2},${pr1.y + pr1.h / 2} L${\n                        pr2.x + pr2.w / 2\n                      },${pr2.y + pr2.h / 2}`}\n                    />\n                    <text x={prm.x} y={prm.y}>\n                      {displayDistance}\n                    </text>\n                  </Fragment>\n                )\n              })\n          )}\n      </Svg>\n    </ThemeProvider>\n  )\n}\n\nexport default PointDistances\n","// @flow\n\nimport { grey } from \"@mui/material/colors\"\n\nexport default {\n  regionInfo: {\n    fontSize: 12,\n    cursor: \"default\",\n    transition: \"opacity 200ms\",\n    opacity: 0.5,\n    \"&:hover\": {\n      opacity: 0.9,\n      cursor: \"pointer\",\n    },\n    \"&.highlighted\": {\n      opacity: 0.9,\n      \"&:hover\": {\n        opacity: 1,\n      },\n    },\n    // pointerEvents: \"none\",\n    fontWeight: 600,\n    color: grey[900],\n    padding: 8,\n    \"& .name\": {\n      display: \"flex\",\n      flexDirection: \"row\",\n      alignItems: \"center\",\n      \"& .circle\": {\n        marginRight: 4,\n        boxShadow: \"0px 0px 2px rgba(0,0,0,0.4)\",\n        width: 10,\n        height: 10,\n        borderRadius: 5,\n      },\n    },\n    \"& .tags\": {\n      \"& .tag\": {\n        color: grey[700],\n        display: \"inline-block\",\n        margin: 1,\n        fontSize: 10,\n        textDecoration: \"underline\",\n      },\n    },\n  },\n  commentBox: {\n    fontWeight: 400,\n    fontSize: 13,\n  },\n}\n","// @flow\n\nimport React, { useRef, memo } from \"react\"\nimport Paper from \"@mui/material/Paper\"\nimport { makeStyles } from \"@mui/styles\"\nimport { createTheme, ThemeProvider } from \"@mui/material/styles\"\nimport styles from \"./styles\"\nimport classnames from \"classnames\"\nimport type { Region } from \"../ImageCanvas/region-tools.js\"\nimport IconButton from \"@mui/material/IconButton\"\nimport Button from \"@mui/material/Button\"\nimport TrashIcon from \"@mui/icons-material/Delete\"\nimport CheckIcon from \"@mui/icons-material/Check\"\nimport TextField from \"@mui/material/TextField\"\nimport Select from \"react-select\"\nimport CreatableSelect from \"react-select/creatable\"\n\nimport { asMutable } from \"seamless-immutable\"\n\nconst theme = createTheme()\nconst useStyles = makeStyles((theme) => styles)\n\ntype Props = {\n  region: Region,\n  editing?: boolean,\n  allowedClasses?: Array<string>,\n  allowedTags?: Array<string>,\n  cls?: string,\n  tags?: Array<string>,\n  onDelete: (Region) => null,\n  onChange: (Region) => null,\n  onClose: (Region) => null,\n  onOpen: (Region) => null,\n  onRegionClassAdded: () => {},\n  allowComments?: boolean,\n}\n\nexport const RegionLabel = ({\n  region,\n  editing,\n  allowedClasses,\n  allowedTags,\n  onDelete,\n  onChange,\n  onClose,\n  onOpen,\n  onRegionClassAdded,\n  allowComments,\n}: Props) => {\n  const classes = useStyles()\n  const commentInputRef = useRef(null)\n  const onCommentInputClick = (_) => {\n    // The TextField wraps the <input> tag with two divs\n    const commentInput = commentInputRef.current.children[0].children[0]\n\n    if (commentInput) return commentInput.focus()\n  }\n\n  return (\n    <ThemeProvider theme={theme}>\n      <Paper\n        onClick={() => (!editing ? onOpen(region) : null)}\n        className={classnames(classes.regionInfo, {\n          highlighted: region.highlighted,\n        })}\n      >\n        {!editing ? (\n          <div>\n            {region.cls && (\n              <div className=\"name\">\n                <div\n                  className=\"circle\"\n                  style={{ backgroundColor: region.color }}\n                />\n                {region.cls}\n              </div>\n            )}\n            {region.tags && (\n              <div className=\"tags\">\n                {region.tags.map((t) => (\n                  <div key={t} className=\"tag\">\n                    {t}\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        ) : (\n          <div style={{ width: 200 }}>\n            <div style={{ display: \"flex\", flexDirection: \"row\" }}>\n              <div\n                style={{\n                  display: \"flex\",\n                  backgroundColor: region.color || \"#888\",\n                  color: \"#fff\",\n                  padding: 4,\n                  paddingLeft: 8,\n                  paddingRight: 8,\n                  borderRadius: 4,\n                  fontWeight: \"bold\",\n                  textShadow: \"0px 0px 5px rgba(0,0,0,0.4)\",\n                }}\n              >\n                {region.type}\n              </div>\n              <div style={{ flexGrow: 1 }} />\n              <IconButton\n                onClick={() => onDelete(region)}\n                tabIndex={-1}\n                style={{ width: 22, height: 22 }}\n                size=\"small\"\n                variant=\"outlined\"\n              >\n                <TrashIcon style={{ marginTop: -8, width: 16, height: 16 }} />\n              </IconButton>\n            </div>\n            {(allowedClasses || []).length > 0 && (\n              <div style={{ marginTop: 6 }}>\n                <CreatableSelect\n                  placeholder=\"Classification\"\n                  onChange={(o, actionMeta) => {\n                    if (actionMeta.action == \"create-option\") {\n                      onRegionClassAdded(o.value)\n                    }\n                    return onChange({\n                      ...(region: any),\n                      cls: o.value,\n                    })\n                  }}\n                  value={\n                    region.cls ? { label: region.cls, value: region.cls } : null\n                  }\n                  options={asMutable(\n                    allowedClasses.map((c) => ({ value: c, label: c }))\n                  )}\n                />\n              </div>\n            )}\n            {(allowedTags || []).length > 0 && (\n              <div style={{ marginTop: 4 }}>\n                <Select\n                  onChange={(newTags) =>\n                    onChange({\n                      ...(region: any),\n                      tags: newTags.map((t) => t.value),\n                    })\n                  }\n                  placeholder=\"Tags\"\n                  value={(region.tags || []).map((c) => ({\n                    label: c,\n                    value: c,\n                  }))}\n                  isMulti\n                  options={asMutable(\n                    allowedTags.map((c) => ({ value: c, label: c }))\n                  )}\n                />\n              </div>\n            )}\n            {allowComments && (\n              <TextField\n                InputProps={{\n                  className: classes.commentBox,\n                }}\n                fullWidth\n                multiline\n                rows={3}\n                ref={commentInputRef}\n                onClick={onCommentInputClick}\n                value={region.comment || \"\"}\n                onChange={(event) =>\n                  onChange({ ...(region: any), comment: event.target.value })\n                }\n              />\n            )}\n            {onClose && (\n              <div style={{ marginTop: 4, display: \"flex\" }}>\n                <div style={{ flexGrow: 1 }} />\n                <Button\n                  onClick={() => onClose(region)}\n                  size=\"small\"\n                  variant=\"contained\"\n                  color=\"primary\"\n                >\n                  <CheckIcon />\n                </Button>\n              </div>\n            )}\n          </div>\n        )}\n      </Paper>\n    </ThemeProvider>\n  )\n}\n\nexport default memo(\n  RegionLabel,\n  (prevProps, nextProps) =>\n    prevProps.editing === nextProps.editing &&\n    prevProps.region === nextProps.region\n)\n","// @flow weak\n\nimport React from \"react\"\nimport Paper from \"@mui/material/Paper\"\nimport DefaultRegionLabel from \"../RegionLabel\"\nimport LockIcon from \"@mui/icons-material/Lock\"\n\nconst copyWithout = (obj, ...args) => {\n  const newObj = { ...obj }\n  for (const arg of args) {\n    delete newObj[arg]\n  }\n  return newObj\n}\n\nexport const RegionTags = ({\n  regions,\n  projectRegionBox,\n  mouseEvents,\n  regionClsList,\n  regionTagList,\n  onBeginRegionEdit,\n  onChangeRegion,\n  onCloseRegionEdit,\n  onDeleteRegion,\n  layoutParams,\n  imageSrc,\n  RegionEditLabel,\n  onRegionClassAdded,\n  allowComments,\n}) => {\n  const RegionLabel =\n    RegionEditLabel != null ? RegionEditLabel : DefaultRegionLabel\n  return regions\n    .filter((r) => r.visible || r.visible === undefined)\n    .map((region) => {\n      const pbox = projectRegionBox(region)\n      const { iw, ih } = layoutParams.current\n      let margin = 8\n      if (region.highlighted && region.type === \"box\") margin += 6\n      const labelBoxHeight =\n        region.editingLabels && !region.locked ? 170 : region.tags ? 60 : 50\n      const displayOnTop = pbox.y > labelBoxHeight\n\n      const coords = displayOnTop\n        ? {\n            left: pbox.x,\n            top: pbox.y - margin / 2,\n          }\n        : { left: pbox.x, top: pbox.y + pbox.h + margin / 2 }\n      if (region.locked) {\n        return (\n          <div\n            key={region.id}\n            style={{\n              position: \"absolute\",\n              ...coords,\n              zIndex: 10 + (region.editingLabels ? 5 : 0),\n            }}\n          >\n            <Paper\n              style={{\n                position: \"absolute\",\n                left: 0,\n                ...(displayOnTop ? { bottom: 0 } : { top: 0 }),\n                zIndex: 10,\n                backgroundColor: \"#fff\",\n                borderRadius: 4,\n                padding: 2,\n                paddingBottom: 0,\n                opacity: 0.5,\n                pointerEvents: \"none\",\n              }}\n            >\n              <LockIcon style={{ width: 16, height: 16, color: \"#333\" }} />\n            </Paper>\n          </div>\n        )\n      }\n      return (\n        <div\n          key={region.id}\n          style={{\n            position: \"absolute\",\n            ...coords,\n            zIndex: 10 + (region.editingLabels ? 5 : 0),\n            width: 200,\n          }}\n          onMouseDown={(e) => e.preventDefault()}\n          onMouseUp={(e) => e.preventDefault()}\n          onMouseEnter={(e) => {\n            if (region.editingLabels) {\n              mouseEvents.onMouseUp(e)\n              e.button = 1\n              mouseEvents.onMouseUp(e)\n            }\n          }}\n        >\n          <div\n            style={{\n              position: \"absolute\",\n              zIndex: 20,\n              left: 0,\n              ...(displayOnTop ? { bottom: 0 } : { top: 0 }),\n            }}\n            {...(!region.editingLabels\n              ? copyWithout(mouseEvents, \"onMouseDown\", \"onMouseUp\")\n              : {})}\n          >\n            <RegionLabel\n              allowedClasses={regionClsList}\n              allowedTags={regionTagList}\n              onOpen={onBeginRegionEdit}\n              onChange={onChangeRegion}\n              onClose={onCloseRegionEdit}\n              onDelete={onDeleteRegion}\n              editing={region.editingLabels}\n              region={region}\n              regions={regions}\n              imageSrc={imageSrc}\n              onRegionClassAdded={onRegionClassAdded}\n              allowComments={allowComments}\n            />\n          </div>\n        </div>\n      )\n    })\n}\n\nexport default RegionTags\n","export const loadImage = (imageSrc) => {\n  // Check if image is already loaded in a page element\n  let image = Array.from(document.getElementsByTagName(\"img\")).find(\n    (img) => img.src === imageSrc\n  )\n\n  const canvas = document.createElement(\"canvas\")\n  const ctx = canvas.getContext(\"2d\")\n\n  if (!image) {\n    image = new Image()\n    image.crossOrigin = \"anonymous\"\n    image.src = imageSrc\n  }\n\n  return new Promise((resolve, reject) => {\n    image.onload = () => {\n      canvas.width = image.naturalWidth\n      canvas.height = image.naturalHeight\n      ctx.drawImage(image, 0, 0)\n      const imageData = ctx.getImageData(\n        0,\n        0,\n        image.naturalWidth,\n        image.naturalHeight\n      )\n      resolve(imageData)\n    }\n  })\n}\n\nexport default loadImage\n","// @flow\n\nimport React, { useState, useEffect, useMemo, useRef } from \"react\"\nimport { colorInts } from \"../colors\"\nimport { useDebounce } from \"react-use\"\nimport loadImage from \"./load-image\"\nimport autoseg from \"autoseg/webworker\"\n\nfunction convertToUDTRegions(regions) {\n  return regions\n    .map((r) => {\n      switch (r.type) {\n        case \"point\": {\n          return {\n            regionType: \"point\",\n            classification: r.cls,\n            x: r.x,\n            y: r.y,\n          }\n        }\n        case \"polygon\": {\n          return {\n            regionType: \"polygon\",\n            classification: r.cls,\n            points: r.points.map(([x, y]) => ({ x, y })),\n          }\n        }\n        case \"box\": {\n          return {\n            regionType: \"bounding-box\",\n            classification: r.cls,\n            centerX: r.x + r.w / 2,\n            centerY: r.y + r.h / 2,\n            width: r.w,\n            height: r.h,\n          }\n        }\n        default: {\n          return null\n        }\n      }\n    })\n    .filter(Boolean)\n}\n\nexport const ImageMask = ({\n  regions,\n  regionClsList,\n  imageSrc,\n  imagePosition,\n  zIndex = 1,\n  hide = false,\n  autoSegmentationOptions = { type: \"simple\" },\n}) => {\n  // if (!window.mmgc) window.mmgc = MMGC_INIT()\n  // const mmgc = window.mmgc\n  const [canvasRef, setCanvasRef] = useState(null)\n\n  const [sampleImageData, setSampleImageData] = useState()\n\n  useEffect(() => {\n    if (!imageSrc) return\n\n    loadImage(imageSrc).then((imageData) => {\n      autoseg.setConfig({\n        classNames: regionClsList,\n        ...autoSegmentationOptions,\n      })\n      autoseg.loadImage(imageData)\n      setSampleImageData(imageData)\n    })\n  }, [imageSrc])\n\n  useDebounce(\n    () => {\n      if (hide) return\n      if (!canvasRef) return\n      if (!sampleImageData) return\n      if (regions.filter((cp) => cp.cls).length < 2) return\n\n      const udtRegions = convertToUDTRegions(regions)\n\n      autoseg.getMask(udtRegions).then((maskImageData) => {\n        const context = canvasRef.getContext(\"2d\")\n        context.clearRect(0, 0, maskImageData.width, maskImageData.height)\n        context.putImageData(maskImageData, 0, 0)\n      })\n    },\n    1000,\n    [canvasRef, sampleImageData, regions, hide]\n  )\n\n  const style = useMemo(() => {\n    let width = imagePosition.bottomRight.x - imagePosition.topLeft.x\n    let height = imagePosition.bottomRight.y - imagePosition.topLeft.y\n    return {\n      display: hide ? \"none\" : undefined,\n      imageRendering: \"pixelated\",\n      transform: \"translateZ(0px)\",\n      left: imagePosition.topLeft.x,\n      top: imagePosition.topLeft.y,\n      width: isNaN(width) ? 0 : width,\n      height: isNaN(height) ? 0 : height,\n      zIndex,\n      position: \"absolute\",\n      pointerEvents: \"none\",\n    }\n  }, [\n    imagePosition.topLeft.x,\n    imagePosition.topLeft.y,\n    imagePosition.bottomRight.x,\n    imagePosition.bottomRight.y,\n    zIndex,\n    hide,\n  ])\n\n  return (\n    <canvas\n      style={style}\n      width={sampleImageData ? sampleImageData.width : 0}\n      height={sampleImageData ? sampleImageData.height : 0}\n      ref={setCanvasRef}\n    />\n  )\n}\n\nexport default ImageMask\n","// @flow\n\nimport React from \"react\"\nimport classnames from \"classnames\"\nimport { makeStyles } from \"@mui/styles\"\nimport { createTheme, ThemeProvider } from \"@mui/material/styles\"\n\nconst theme = createTheme()\nconst useStyles = makeStyles((theme) => ({\n  \"@keyframes borderDance\": {\n    from: { strokeDashoffset: 0 },\n    to: { strokeDashoffset: 100 },\n  },\n  highlightBox: {\n    zIndex: 2,\n    transition: \"opacity 500ms\",\n    \"&.highlighted\": {\n      zIndex: 3,\n    },\n    \"&:not(.highlighted)\": {\n      opacity: 0,\n    },\n    \"&:not(.highlighted):hover\": {\n      opacity: 0.6,\n    },\n    \"& path\": {\n      vectorEffect: \"non-scaling-stroke\",\n      strokeWidth: 2,\n      stroke: \"#FFF\",\n      fill: \"none\",\n      strokeDasharray: 5,\n      animationName: \"$borderDance\",\n      animationDuration: \"4s\",\n      animationTimingFunction: \"linear\",\n      animationIterationCount: \"infinite\",\n      animationPlayState: \"running\",\n    },\n  },\n}))\n\nexport const HighlightBox = ({\n  mouseEvents,\n  dragWithPrimary,\n  zoomWithPrimary,\n  createWithPrimary,\n  onBeginMovePoint,\n  onSelectRegion,\n  region: r,\n  pbox,\n}: {\n  mouseEvents: any,\n  dragWithPrimary: boolean,\n  zoomWithPrimary: boolean,\n  createWithPrimary: boolean,\n  onBeginMovePoint: Function,\n  onSelectRegion: Function,\n  region: any,\n  pbox: { x: number, y: number, w: number, h: number },\n}) => {\n  const classes = useStyles()\n  if (!pbox.w || pbox.w === Infinity) return null\n  if (!pbox.h || pbox.h === Infinity) return null\n  if (r.unfinished) return null\n\n  const styleCoords =\n    r.type === \"point\"\n      ? {\n          left: pbox.x + pbox.w / 2 - 30,\n          top: pbox.y + pbox.h / 2 - 30,\n          width: 60,\n          height: 60,\n        }\n      : {\n          left: pbox.x - 5,\n          top: pbox.y - 5,\n          width: pbox.w + 10,\n          height: pbox.h + 10,\n        }\n\n  const pathD =\n    r.type === \"point\"\n      ? `M5,5 L${styleCoords.width - 5} 5L${styleCoords.width - 5} ${\n          styleCoords.height - 5\n        }L5 ${styleCoords.height - 5}Z`\n      : `M5,5 L${pbox.w + 5},5 L${pbox.w + 5},${pbox.h + 5} L5,${pbox.h + 5} Z`\n\n  return (\n    <ThemeProvider theme={theme}>\n      <svg\n        key={r.id}\n        className={classnames(classes.highlightBox, {\n          highlighted: r.highlighted,\n        })}\n        {...mouseEvents}\n        {...(!zoomWithPrimary && !dragWithPrimary\n          ? {\n              onMouseDown: (e) => {\n                if (\n                  !r.locked &&\n                  r.type === \"point\" &&\n                  r.highlighted &&\n                  e.button === 0\n                ) {\n                  return onBeginMovePoint(r)\n                }\n                if (e.button === 0 && !createWithPrimary)\n                  return onSelectRegion(r)\n                mouseEvents.onMouseDown(e)\n              },\n            }\n          : {})}\n        style={{\n          ...(r.highlighted\n            ? {\n                pointerEvents: r.type !== \"point\" ? \"none\" : undefined,\n                cursor: \"grab\",\n              }\n            : {\n                cursor: !(\n                  zoomWithPrimary ||\n                  dragWithPrimary ||\n                  createWithPrimary\n                )\n                  ? \"pointer\"\n                  : undefined,\n                pointerEvents:\n                  zoomWithPrimary ||\n                  dragWithPrimary ||\n                  (createWithPrimary && !r.highlighted)\n                    ? \"none\"\n                    : undefined,\n              }),\n          position: \"absolute\",\n          ...styleCoords,\n        }}\n      >\n        <path d={pathD} />\n      </svg>\n    </ThemeProvider>\n  )\n}\n\nexport default HighlightBox\n","import React, { Fragment, memo } from \"react\"\nimport HighlightBox from \"../HighlightBox\"\nimport { styled } from \"@mui/material/styles\"\nimport { createTheme, ThemeProvider } from \"@mui/material/styles\"\nimport PreventScrollToParents from \"../PreventScrollToParents\"\nimport Tooltip from \"@mui/material/Tooltip\"\n\nconst theme = createTheme()\nconst TransformGrabber = styled(\"div\")(({ theme }) => ({\n  width: 8,\n  height: 8,\n  zIndex: 2,\n  border: \"2px solid #FFF\",\n  position: \"absolute\",\n}))\n\nconst boxCursorMap = [\n  [\"nw-resize\", \"n-resize\", \"ne-resize\"],\n  [\"w-resize\", \"grab\", \"e-resize\"],\n  [\"sw-resize\", \"s-resize\", \"se-resize\"],\n]\n\nconst arePropsEqual = (prev, next) => {\n  return (\n    prev.region === next.region &&\n    prev.dragWithPrimary === next.dragWithPrimary &&\n    prev.createWithPrimary === next.createWithPrimary &&\n    prev.zoomWithPrimary === next.zoomWithPrimary &&\n    prev.mat === next.mat\n  )\n}\n\nexport const RegionSelectAndTransformBox = memo(\n  ({\n    region: r,\n    mouseEvents,\n    projectRegionBox,\n    dragWithPrimary,\n    createWithPrimary,\n    zoomWithPrimary,\n    onBeginMovePoint,\n    onSelectRegion,\n    layoutParams,\n    fullImageSegmentationMode = false,\n    mat,\n    onBeginBoxTransform,\n    onBeginMovePolygonPoint,\n    onBeginMoveKeypoint,\n    onAddPolygonPoint,\n    showHighlightBox,\n  }) => {\n    const pbox = projectRegionBox(r)\n    const { iw, ih } = layoutParams.current\n    return (\n      <ThemeProvider theme={theme}>\n        <Fragment>\n          <PreventScrollToParents>\n            {showHighlightBox && r.type !== \"polygon\" && (\n              <HighlightBox\n                region={r}\n                mouseEvents={mouseEvents}\n                dragWithPrimary={dragWithPrimary}\n                createWithPrimary={createWithPrimary}\n                zoomWithPrimary={zoomWithPrimary}\n                onBeginMovePoint={onBeginMovePoint}\n                onSelectRegion={onSelectRegion}\n                pbox={pbox}\n              />\n            )}\n            {r.type === \"box\" &&\n              !dragWithPrimary &&\n              !zoomWithPrimary &&\n              !r.locked &&\n              r.highlighted &&\n              mat.a < 1.2 &&\n              [\n                [0, 0],\n                [0.5, 0],\n                [1, 0],\n                [1, 0.5],\n                [1, 1],\n                [0.5, 1],\n                [0, 1],\n                [0, 0.5],\n                [0.5, 0.5],\n              ].map(([px, py], i) => (\n                <TransformGrabber\n                  key={i}\n                  {...mouseEvents}\n                  onMouseDown={(e) => {\n                    if (e.button === 0)\n                      return onBeginBoxTransform(r, [px * 2 - 1, py * 2 - 1])\n                    mouseEvents.onMouseDown(e)\n                  }}\n                  style={{\n                    left: pbox.x - 4 - 2 + pbox.w * px,\n                    top: pbox.y - 4 - 2 + pbox.h * py,\n                    cursor: boxCursorMap[py * 2][px * 2],\n                    borderRadius: px === 0.5 && py === 0.5 ? 4 : undefined,\n                  }}\n                />\n              ))}\n            {r.type === \"polygon\" &&\n              !dragWithPrimary &&\n              !zoomWithPrimary &&\n              !r.locked &&\n              r.highlighted &&\n              r.points.map(([px, py], i) => {\n                const proj = mat\n                  .clone()\n                  .inverse()\n                  .applyToPoint(px * iw, py * ih)\n                return (\n                  <TransformGrabber\n                    key={i}\n                    {...mouseEvents}\n                    onMouseDown={(e) => {\n                      if (e.button === 0 && (!r.open || i === 0))\n                        return onBeginMovePolygonPoint(r, i)\n                      mouseEvents.onMouseDown(e)\n                    }}\n                    style={{\n                      cursor: !r.open\n                        ? \"move\"\n                        : i === 0\n                        ? \"pointer\"\n                        : undefined,\n                      zIndex: 10,\n                      pointerEvents:\n                        r.open && i === r.points.length - 1\n                          ? \"none\"\n                          : undefined,\n                      left: proj.x - 4,\n                      top: proj.y - 4,\n                    }}\n                  />\n                )\n              })}\n            {r.type === \"polygon\" &&\n              r.highlighted &&\n              !dragWithPrimary &&\n              !zoomWithPrimary &&\n              !r.locked &&\n              !r.open &&\n              r.points.length > 1 &&\n              r.points\n                .map((p1, i) => [p1, r.points[(i + 1) % r.points.length]])\n                .map(([p1, p2]) => [(p1[0] + p2[0]) / 2, (p1[1] + p2[1]) / 2])\n                .map((pa, i) => {\n                  const proj = mat\n                    .clone()\n                    .inverse()\n                    .applyToPoint(pa[0] * iw, pa[1] * ih)\n                  return (\n                    <TransformGrabber\n                      key={i}\n                      {...mouseEvents}\n                      onMouseDown={(e) => {\n                        if (e.button === 0)\n                          return onAddPolygonPoint(r, pa, i + 1)\n                        mouseEvents.onMouseDown(e)\n                      }}\n                      style={{\n                        cursor: \"copy\",\n                        zIndex: 10,\n                        left: proj.x - 4,\n                        top: proj.y - 4,\n                        border: \"2px dotted #fff\",\n                        opacity: 0.5,\n                      }}\n                    />\n                  )\n                })}\n            {r.type === \"keypoints\" &&\n              !dragWithPrimary &&\n              !zoomWithPrimary &&\n              !r.locked &&\n              r.highlighted &&\n              Object.entries(r.points).map(\n                ([keypointId, { x: px, y: py }], i) => {\n                  const proj = mat\n                    .clone()\n                    .inverse()\n                    .applyToPoint(px * iw, py * ih)\n                  return (\n                    <Tooltip title={keypointId} key={i}>\n                      <TransformGrabber\n                        key={i}\n                        {...mouseEvents}\n                        onMouseDown={(e) => {\n                          if (e.button === 0 && (!r.open || i === 0))\n                            return onBeginMoveKeypoint(r, keypointId)\n                          mouseEvents.onMouseDown(e)\n                        }}\n                        style={{\n                          cursor: !r.open\n                            ? \"move\"\n                            : i === 0\n                            ? \"pointer\"\n                            : undefined,\n                          zIndex: 10,\n                          pointerEvents:\n                            r.open && i === r.points.length - 1\n                              ? \"none\"\n                              : undefined,\n                          left: proj.x - 4,\n                          top: proj.y - 4,\n                        }}\n                      />\n                    </Tooltip>\n                  )\n                }\n              )}\n          </PreventScrollToParents>\n        </Fragment>\n      </ThemeProvider>\n    )\n  },\n  arePropsEqual\n)\n\nexport const RegionSelectAndTransformBoxes = memo(\n  (props) => {\n    return props.regions\n      .filter((r) => r.visible || r.visible === undefined)\n      .filter((r) => !r.locked)\n      .map((r, i) => {\n        return <RegionSelectAndTransformBox key={r.id} {...props} region={r} />\n      })\n  },\n  (n, p) => n.regions === p.regions && n.mat === p.mat\n)\n\nexport default RegionSelectAndTransformBoxes\n","// @flow\n\nimport React, { createContext, useContext, useState } from \"react\"\n\nconst defaultSettings = {\n  showCrosshairs: false,\n  showHighlightBox: true,\n  wasdMode: true,\n}\n\nexport const SettingsContext = createContext(defaultSettings)\n\nconst pullSettingsFromLocalStorage = () => {\n  if (!window || !window.localStorage) return {}\n  let settings = {}\n  for (let i = 0; i < window.localStorage.length; i++) {\n    const key = window.localStorage.key(i)\n    if (key.startsWith(\"settings_\")) {\n      try {\n        settings[key.replace(\"settings_\", \"\")] = JSON.parse(\n          window.localStorage.getItem(key)\n        )\n      } catch (e) {}\n    }\n  }\n  return settings\n}\n\nexport const useSettings = () => useContext(SettingsContext)\n\nexport const SettingsProvider = ({ children }) => {\n  const [state, changeState] = useState(() => pullSettingsFromLocalStorage())\n  const changeSetting = (setting: string, value: any) => {\n    changeState({ ...state, [setting]: value })\n    window.localStorage.setItem(`settings_${setting}`, JSON.stringify(value))\n  }\n  return (\n    <SettingsContext.Provider value={{ ...state, changeSetting }}>\n      {children}\n    </SettingsContext.Provider>\n  )\n}\n\nexport default SettingsProvider\n","// @flow weak\n\nimport React, { useRef, useEffect, useMemo, useState } from \"react\"\nimport { styled } from \"@mui/material/styles\"\nimport { createTheme, ThemeProvider } from \"@mui/material/styles\"\nimport useEventCallback from \"use-event-callback\"\nimport { useSettings } from \"../SettingsProvider\"\n\nconst theme = createTheme()\nconst Video = styled(\"video\")(({ theme }) => ({\n  zIndex: 0,\n  position: \"absolute\",\n}))\n\nconst StyledImage = styled(\"img\")(({ theme }) => ({\n  zIndex: 0,\n  position: \"absolute\",\n}))\n\nconst Error = styled(\"div\")(({ theme }) => ({\n  zIndex: 0,\n  position: \"absolute\",\n  left: 0,\n  right: 0,\n  bottom: 0,\n  top: 0,\n  backgroundColor: \"rgba(255,0,0,0.2)\",\n  color: \"#ff0000\",\n  fontWeight: \"bold\",\n  whiteSpace: \"pre-wrap\",\n  padding: 50,\n}))\n\nexport default ({\n  imagePosition,\n  mouseEvents,\n  videoTime,\n  videoSrc,\n  imageSrc,\n  onLoad,\n  useCrossOrigin = false,\n  videoPlaying,\n  onChangeVideoTime,\n  onChangeVideoPlaying,\n}) => {\n  const settings = useSettings()\n  const videoRef = useRef()\n  const imageRef = useRef()\n  const [error, setError] = useState()\n\n  useEffect(() => {\n    if (!videoPlaying && videoRef.current) {\n      videoRef.current.currentTime = (videoTime || 0) / 1000\n    }\n  }, [videoTime])\n\n  useEffect(() => {\n    let renderLoopRunning = false\n    if (videoRef.current) {\n      if (videoPlaying) {\n        videoRef.current.play()\n        renderLoopRunning = true\n        if (settings.videoPlaybackSpeed) {\n          videoRef.current.playbackRate = parseFloat(\n            settings.videoPlaybackSpeed\n          )\n        }\n      } else {\n        videoRef.current.pause()\n      }\n    }\n\n    function checkForNewFrame() {\n      if (!renderLoopRunning) return\n      if (!videoRef.current) return\n      const newVideoTime = Math.floor(videoRef.current.currentTime * 1000)\n      if (videoTime !== newVideoTime) {\n        onChangeVideoTime(newVideoTime)\n      }\n      if (videoRef.current.paused) {\n        renderLoopRunning = false\n        onChangeVideoPlaying(false)\n      }\n      requestAnimationFrame(checkForNewFrame)\n    }\n    checkForNewFrame()\n\n    return () => {\n      renderLoopRunning = false\n    }\n  }, [videoPlaying])\n\n  const onLoadedVideoMetadata = useEventCallback((event) => {\n    const videoElm = event.currentTarget\n    videoElm.currentTime = (videoTime || 0) / 1000\n    if (onLoad)\n      onLoad({\n        naturalWidth: videoElm.videoWidth,\n        naturalHeight: videoElm.videoHeight,\n        videoElm: videoElm,\n        duration: videoElm.duration,\n      })\n  })\n  const onImageLoaded = useEventCallback((event) => {\n    const imageElm = event.currentTarget\n    if (onLoad)\n      onLoad({\n        naturalWidth: imageElm.naturalWidth,\n        naturalHeight: imageElm.naturalHeight,\n        imageElm,\n      })\n  })\n  const onImageError = useEventCallback((event) => {\n    setError(\n      `Could not load image\\n\\nMake sure your image works by visiting ${\n        imageSrc || videoSrc\n      } in a web browser. If that URL works, the server hosting the URL may be not allowing you to access the image from your current domain. Adjust server settings to enable the image to be viewed.${\n        !useCrossOrigin\n          ? \"\"\n          : `\\n\\nYour image may be blocked because it's not being sent with CORs headers. To do pixel segmentation, browser web security requires CORs headers in order for the algorithm to read the pixel data from the image. CORs headers are easy to add if you're using an S3 bucket or own the server hosting your images.`\n      }\\n\\n If you need a hand, reach out to the community at universaldatatool.slack.com`\n    )\n  })\n\n  const stylePosition = useMemo(() => {\n    let width = imagePosition.bottomRight.x - imagePosition.topLeft.x\n    let height = imagePosition.bottomRight.y - imagePosition.topLeft.y\n    return {\n      imageRendering: \"pixelated\",\n      left: imagePosition.topLeft.x,\n      top: imagePosition.topLeft.y,\n      width: isNaN(width) ? 0 : width,\n      height: isNaN(height) ? 0 : height,\n    }\n  }, [\n    imagePosition.topLeft.x,\n    imagePosition.topLeft.y,\n    imagePosition.bottomRight.x,\n    imagePosition.bottomRight.y,\n  ])\n\n  if (!videoSrc && !imageSrc)\n    return <Error>No imageSrc or videoSrc provided</Error>\n\n  if (error) return <Error>{error}</Error>\n\n  return (\n    <ThemeProvider theme={theme}>\n      {imageSrc && videoTime === undefined ? (\n        <StyledImage\n          {...mouseEvents}\n          src={imageSrc}\n          ref={imageRef}\n          style={stylePosition}\n          onLoad={onImageLoaded}\n          onError={onImageError}\n          crossOrigin={useCrossOrigin ? \"anonymous\" : undefined}\n        />\n      ) : (\n        <Video\n          {...mouseEvents}\n          ref={videoRef}\n          style={stylePosition}\n          onLoadedMetadata={onLoadedVideoMetadata}\n          src={videoSrc || imageSrc}\n        />\n      )}\n    </ThemeProvider>\n  )\n}\n","// @flow\n\nimport React, { memo } from \"react\"\nimport colorAlpha from \"color-alpha\"\n\nfunction clamp(num, min, max) {\n  return num <= min ? min : num >= max ? max : num\n}\n\nconst RegionComponents = {\n  point: memo(({ region, iw, ih }) => (\n    <g transform={`translate(${region.x * iw} ${region.y * ih})`}>\n      <path\n        d={\"M0 8L8 0L0 -8L-8 0Z\"}\n        strokeWidth={2}\n        stroke={region.color}\n        fill=\"transparent\"\n      />\n    </g>\n  )),\n  line: memo(({ region, iw, ih }) => (\n    <g transform={`translate(${region.x1 * iw} ${region.y1 * ih})`}>\n      <line\n        strokeWidth={2}\n        x1={0}\n        y1={0}\n        x2={(region.x2 - region.x1) * iw}\n        y2={(region.y2 - region.y1) * ih}\n        stroke={colorAlpha(region.color, 0.75)}\n        fill={colorAlpha(region.color, 0.25)}\n      />\n    </g>\n  )),\n  box: memo(({ region, iw, ih }) => (\n    <g transform={`translate(${region.x * iw} ${region.y * ih})`}>\n      <rect\n        strokeWidth={2}\n        x={0}\n        y={0}\n        width={Math.max(region.w * iw, 0)}\n        height={Math.max(region.h * ih, 0)}\n        stroke={colorAlpha(region.color, 0.75)}\n        fill={colorAlpha(region.color, 0.25)}\n      />\n    </g>\n  )),\n  polygon: memo(({ region, iw, ih, fullSegmentationMode }) => {\n    const Component = region.open ? \"polyline\" : \"polygon\"\n    const alphaBase = fullSegmentationMode ? 0.5 : 1\n    return (\n      <Component\n        points={region.points\n          .map(([x, y]) => [x * iw, y * ih])\n          .map((a) => a.join(\" \"))\n          .join(\" \")}\n        strokeWidth={2}\n        stroke={colorAlpha(region.color, 0.75)}\n        fill={colorAlpha(region.color, 0.25)}\n      />\n    )\n  }),\n  keypoints: ({ region, iw, ih, keypointDefinitions }) => {\n    const { points, keypointsDefinitionId } = region\n    if (!keypointDefinitions[keypointsDefinitionId]) {\n      throw new Error(\n        `No definition for keypoint configuration \"${keypointsDefinitionId}\"`\n      )\n    }\n    const { landmarks, connections } =\n      keypointDefinitions[keypointsDefinitionId]\n    return (\n      <g>\n        {Object.entries(points).map(([keypointId, { x, y }], i) => (\n          <g key={i} transform={`translate(${x * iw} ${y * ih})`}>\n            <path\n              d={\"M0 8L8 0L0 -8L-8 0Z\"}\n              strokeWidth={2}\n              stroke={landmarks[keypointId].color}\n              fill=\"transparent\"\n            />\n          </g>\n        ))}\n        {connections.map(([kp1Id, kp2Id]) => {\n          const kp1 = points[kp1Id]\n          const kp2 = points[kp2Id]\n          const midPoint = { x: (kp1.x + kp2.x) / 2, y: (kp1.y + kp2.y) / 2 }\n\n          return (\n            <g key={`${kp1.x},${kp1.y}.${kp2.x},${kp2.y}`}>\n              <line\n                x1={kp1.x * iw}\n                y1={kp1.y * ih}\n                x2={midPoint.x * iw}\n                y2={midPoint.y * ih}\n                strokeWidth={2}\n                stroke={landmarks[kp1Id].color}\n              />\n              <line\n                x1={kp2.x * iw}\n                y1={kp2.y * ih}\n                x2={midPoint.x * iw}\n                y2={midPoint.y * ih}\n                strokeWidth={2}\n                stroke={landmarks[kp2Id].color}\n              />\n            </g>\n          )\n        })}\n      </g>\n    )\n  },\n  \"expanding-line\": memo(({ region, iw, ih }) => {\n    let { expandingWidth = 0.005, points } = region\n    expandingWidth = points.slice(-1)[0].width || expandingWidth\n    const pointPairs = points.map(({ x, y, angle, width }, i) => {\n      if (!angle) {\n        const n = points[clamp(i + 1, 0, points.length - 1)]\n        const p = points[clamp(i - 1, 0, points.length - 1)]\n        angle = Math.atan2(p.x - n.x, p.y - n.y) + Math.PI / 2\n      }\n      const dx = (Math.sin(angle) * (width || expandingWidth)) / 2\n      const dy = (Math.cos(angle) * (width || expandingWidth)) / 2\n      return [\n        { x: x + dx, y: y + dy },\n        { x: x - dx, y: y - dy },\n      ]\n    })\n    const firstSection = pointPairs.map(([p1, p2]) => p1)\n    const secondSection = pointPairs.map(([p1, p2]) => p2).asMutable()\n    secondSection.reverse()\n    const lastPoint = points.slice(-1)[0]\n    return (\n      <>\n        <polygon\n          points={firstSection\n            .concat(region.candidatePoint ? [region.candidatePoint] : [])\n            .concat(secondSection)\n            .map((p) => `${p.x * iw} ${p.y * ih}`)\n            .join(\" \")}\n          strokeWidth={2}\n          stroke={colorAlpha(region.color, 0.75)}\n          fill={colorAlpha(region.color, 0.25)}\n        />\n        {points.map(({ x, y, angle }, i) => (\n          <g\n            key={i}\n            transform={`translate(${x * iw} ${y * ih}) rotate(${\n              (-(angle || 0) * 180) / Math.PI\n            })`}\n          >\n            <g>\n              <rect\n                x={-5}\n                y={-5}\n                width={10}\n                height={10}\n                strokeWidth={2}\n                stroke={colorAlpha(region.color, 0.75)}\n                fill={colorAlpha(region.color, 0.25)}\n              />\n            </g>\n          </g>\n        ))}\n        <rect\n          x={lastPoint.x * iw - 8}\n          y={lastPoint.y * ih - 8}\n          width={16}\n          height={16}\n          strokeWidth={4}\n          stroke={colorAlpha(region.color, 0.5)}\n          fill={\"transparent\"}\n        />\n      </>\n    )\n  }),\n  pixel: () => null,\n}\n\nexport const WrappedRegionList = memo(\n  ({ regions, keypointDefinitions, iw, ih, fullSegmentationMode }) => {\n    return regions\n      .filter((r) => r.visible !== false)\n      .map((r) => {\n        const Component = RegionComponents[r.type]\n        return (\n          <Component\n            key={r.regionId}\n            region={r}\n            iw={iw}\n            ih={ih}\n            keypointDefinitions={keypointDefinitions}\n            fullSegmentationMode={fullSegmentationMode}\n          />\n        )\n      })\n  },\n  (n, p) => n.regions === p.regions && n.iw === p.iw && n.ih === p.ih\n)\n\nexport const RegionShapes = ({\n  mat,\n  imagePosition,\n  regions = [],\n  keypointDefinitions,\n  fullSegmentationMode,\n}) => {\n  const iw = imagePosition.bottomRight.x - imagePosition.topLeft.x\n  const ih = imagePosition.bottomRight.y - imagePosition.topLeft.y\n  if (isNaN(iw) || isNaN(ih)) return null\n  return (\n    <svg\n      width={iw}\n      height={ih}\n      style={{\n        position: \"absolute\",\n        zIndex: 2,\n        left: imagePosition.topLeft.x,\n        top: imagePosition.topLeft.y,\n        pointerEvents: \"none\",\n        width: iw,\n        height: ih,\n      }}\n    >\n      <WrappedRegionList\n        key=\"wrapped-region-list\"\n        regions={regions}\n        iw={iw}\n        ih={ih}\n        keypointDefinitions={keypointDefinitions}\n        fullSegmentationMode={fullSegmentationMode}\n      />\n    </svg>\n  )\n}\n\nexport default RegionShapes\n","// @flow weak\n\nimport React, {\n  useRef,\n  useState,\n  useLayoutEffect,\n  useEffect,\n  useMemo,\n} from \"react\"\nimport type { Node } from \"react\"\nimport { Matrix } from \"transformation-matrix-js\"\nimport Crosshairs from \"../Crosshairs\"\nimport type {\n  Region,\n  Point,\n  Polygon,\n  Box,\n  Keypoints,\n  KeypointsDefinition,\n} from \"./region-tools.js\"\nimport { makeStyles } from \"@mui/styles\"\nimport { createTheme, ThemeProvider } from \"@mui/material/styles\"\nimport styles from \"./styles\"\nimport PreventScrollToParents from \"../PreventScrollToParents\"\nimport useWindowSize from \"../hooks/use-window-size.js\"\nimport useMouse from \"./use-mouse\"\nimport useProjectRegionBox from \"./use-project-box\"\nimport useExcludePattern from \"../hooks/use-exclude-pattern\"\nimport { useRafState } from \"react-use\"\nimport PointDistances from \"../PointDistances\"\nimport RegionTags from \"../RegionTags\"\nimport RegionLabel from \"../RegionLabel\"\nimport ImageMask from \"../ImageMask\"\nimport RegionSelectAndTransformBoxes from \"../RegionSelectAndTransformBoxes\"\nimport VideoOrImageCanvasBackground from \"../VideoOrImageCanvasBackground\"\nimport useEventCallback from \"use-event-callback\"\nimport RegionShapes from \"../RegionShapes\"\nimport useWasdMode from \"./use-wasd-mode\"\n\nconst theme = createTheme()\nconst useStyles = makeStyles((theme) => styles)\n\ntype Props = {\n  regions: Array<Region>,\n  imageSrc?: string,\n  videoSrc?: string,\n  videoTime?: number,\n  keypointDefinitions?: KeypointDefinitions,\n  onMouseMove?: ({ x: number, y: number }) => any,\n  onMouseDown?: ({ x: number, y: number }) => any,\n  onMouseUp?: ({ x: number, y: number }) => any,\n  dragWithPrimary?: boolean,\n  zoomWithPrimary?: boolean,\n  createWithPrimary?: boolean,\n  showTags?: boolean,\n  realSize?: { width: number, height: number, unitName: string },\n  showCrosshairs?: boolean,\n  showMask?: boolean,\n  showHighlightBox?: boolean,\n  showPointDistances?: boolean,\n  pointDistancePrecision?: number,\n  regionClsList?: Array<string>,\n  regionTagList?: Array<string>,\n  allowedArea?: { x: number, y: number, w: number, h: number },\n  RegionEditLabel?: Node,\n  videoPlaying?: boolean,\n  zoomOnAllowedArea?: boolean,\n  fullImageSegmentationMode?: boolean,\n  autoSegmentationOptions?: Object,\n  modifyingAllowedArea?: boolean,\n  allowComments?: Boolean,\n  onChangeRegion: (Region) => any,\n  onBeginRegionEdit: (Region) => any,\n  onCloseRegionEdit: (Region) => any,\n  onDeleteRegion: (Region) => any,\n  onBeginBoxTransform: (Box, [number, number]) => any,\n  onBeginMovePolygonPoint: (Polygon, index: number) => any,\n  onBeginMoveKeypoint: (Keypoints, index: number) => any,\n  onAddPolygonPoint: (Polygon, point: [number, number], index: number) => any,\n  onSelectRegion: (Region) => any,\n  onBeginMovePoint: (Point) => any,\n  onImageOrVideoLoaded: ({\n    naturalWidth: number,\n    naturalHeight: number,\n    duration?: number,\n  }) => any,\n  onChangeVideoTime: (number) => any,\n  onRegionClassAdded: () => {},\n  onChangeVideoPlaying?: Function,\n}\n\nconst getDefaultMat = (allowedArea = null, { iw, ih } = {}) => {\n  let mat = Matrix.from(1, 0, 0, 1, -10, -10)\n  if (allowedArea && iw) {\n    mat = mat\n      .translate(allowedArea.x * iw, allowedArea.y * ih)\n      .scaleU(allowedArea.w + 0.05)\n  }\n  return mat\n}\n\nexport const ImageCanvas = ({\n  regions,\n  imageSrc,\n  videoSrc,\n  videoTime,\n  realSize,\n  showTags,\n  onMouseMove = (p) => null,\n  onMouseDown = (p) => null,\n  onMouseUp = (p) => null,\n  dragWithPrimary = false,\n  zoomWithPrimary = false,\n  createWithPrimary = false,\n  pointDistancePrecision = 0,\n  regionClsList,\n  regionTagList,\n  showCrosshairs,\n  showHighlightBox = true,\n  showPointDistances,\n  allowedArea,\n  RegionEditLabel = null,\n  videoPlaying = false,\n  showMask = true,\n  fullImageSegmentationMode,\n  autoSegmentationOptions,\n  onImageOrVideoLoaded,\n  onChangeRegion,\n  onBeginRegionEdit,\n  onCloseRegionEdit,\n  onBeginBoxTransform,\n  onBeginMovePolygonPoint,\n  onAddPolygonPoint,\n  onBeginMoveKeypoint,\n  onSelectRegion,\n  onBeginMovePoint,\n  onDeleteRegion,\n  onChangeVideoTime,\n  onChangeVideoPlaying,\n  onRegionClassAdded,\n  zoomOnAllowedArea = true,\n  modifyingAllowedArea = false,\n  keypointDefinitions,\n  allowComments,\n}: Props) => {\n  const classes = useStyles()\n\n  const canvasEl = useRef(null)\n  const layoutParams = useRef({})\n  const [dragging, changeDragging] = useRafState(false)\n  const [maskImagesLoaded, changeMaskImagesLoaded] = useRafState(0)\n  const [zoomStart, changeZoomStart] = useRafState(null)\n  const [zoomEnd, changeZoomEnd] = useRafState(null)\n  const [mat, changeMat] = useRafState(getDefaultMat())\n  const maskImages = useRef({})\n  const windowSize = useWindowSize()\n\n  const getLatestMat = useEventCallback(() => mat)\n  useWasdMode({ getLatestMat, changeMat })\n\n  const { mouseEvents, mousePosition } = useMouse({\n    canvasEl,\n    dragging,\n    mat,\n    layoutParams,\n    changeMat,\n    zoomStart,\n    zoomEnd,\n    changeZoomStart,\n    changeZoomEnd,\n    changeDragging,\n    zoomWithPrimary,\n    dragWithPrimary,\n    onMouseMove,\n    onMouseDown,\n    onMouseUp,\n  })\n\n  useLayoutEffect(() => changeMat(mat.clone()), [windowSize])\n\n  const innerMousePos = mat.applyToPoint(\n    mousePosition.current.x,\n    mousePosition.current.y\n  )\n\n  const projectRegionBox = useProjectRegionBox({ layoutParams, mat })\n\n  const [imageDimensions, changeImageDimensions] = useState()\n  const imageLoaded = Boolean(imageDimensions && imageDimensions.naturalWidth)\n\n  const onVideoOrImageLoaded = useEventCallback(\n    ({ naturalWidth, naturalHeight, duration }) => {\n      const dims = { naturalWidth, naturalHeight, duration }\n      if (onImageOrVideoLoaded) onImageOrVideoLoaded(dims)\n      changeImageDimensions(dims)\n      // Redundant update to fix rerendering issues\n      setTimeout(() => changeImageDimensions(dims), 10)\n    }\n  )\n\n  const excludePattern = useExcludePattern()\n\n  const canvas = canvasEl.current\n  if (canvas && imageLoaded) {\n    const { clientWidth, clientHeight } = canvas\n\n    const fitScale = Math.max(\n      imageDimensions.naturalWidth / (clientWidth - 20),\n      imageDimensions.naturalHeight / (clientHeight - 20)\n    )\n\n    const [iw, ih] = [\n      imageDimensions.naturalWidth / fitScale,\n      imageDimensions.naturalHeight / fitScale,\n    ]\n\n    layoutParams.current = {\n      iw,\n      ih,\n      fitScale,\n      canvasWidth: clientWidth,\n      canvasHeight: clientHeight,\n    }\n  }\n\n  useEffect(() => {\n    if (!imageLoaded) return\n    changeMat(\n      getDefaultMat(\n        zoomOnAllowedArea ? allowedArea : null,\n        layoutParams.current\n      )\n    )\n    // eslint-disable-next-line\n  }, [imageLoaded])\n\n  useLayoutEffect(() => {\n    if (!imageDimensions) return\n    const { clientWidth, clientHeight } = canvas\n    canvas.width = clientWidth\n    canvas.height = clientHeight\n    const context = canvas.getContext(\"2d\")\n\n    context.save()\n    context.transform(...mat.clone().inverse().toArray())\n\n    const { iw, ih } = layoutParams.current\n\n    if (allowedArea) {\n      // Pattern to indicate the NOT allowed areas\n      const { x, y, w, h } = allowedArea\n      context.save()\n      context.globalAlpha = 1\n      const outer = [\n        [0, 0],\n        [iw, 0],\n        [iw, ih],\n        [0, ih],\n      ]\n      const inner = [\n        [x * iw, y * ih],\n        [x * iw + w * iw, y * ih],\n        [x * iw + w * iw, y * ih + h * ih],\n        [x * iw, y * ih + h * ih],\n      ]\n      context.moveTo(...outer[0])\n      outer.forEach((p) => context.lineTo(...p))\n      context.lineTo(...outer[0])\n      context.closePath()\n\n      inner.reverse()\n      context.moveTo(...inner[0])\n      inner.forEach((p) => context.lineTo(...p))\n      context.lineTo(...inner[0])\n\n      context.fillStyle = excludePattern || \"#f00\"\n      context.fill()\n\n      context.restore()\n    }\n\n    context.restore()\n  })\n\n  const { iw, ih } = layoutParams.current\n\n  let zoomBox =\n    !zoomStart || !zoomEnd\n      ? null\n      : {\n          ...mat.clone().inverse().applyToPoint(zoomStart.x, zoomStart.y),\n          w: (zoomEnd.x - zoomStart.x) / mat.a,\n          h: (zoomEnd.y - zoomStart.y) / mat.d,\n        }\n  if (zoomBox) {\n    if (zoomBox.w < 0) {\n      zoomBox.x += zoomBox.w\n      zoomBox.w *= -1\n    }\n    if (zoomBox.h < 0) {\n      zoomBox.y += zoomBox.h\n      zoomBox.h *= -1\n    }\n  }\n\n  const imagePosition = {\n    topLeft: mat.clone().inverse().applyToPoint(0, 0),\n    bottomRight: mat.clone().inverse().applyToPoint(iw, ih),\n  }\n\n  const highlightedRegion = useMemo(() => {\n    const highlightedRegions = regions.filter((r) => r.highlighted)\n    if (highlightedRegions.length !== 1) return null\n    return highlightedRegions[0]\n  }, [regions])\n\n  return (\n    <ThemeProvider theme={theme}>\n      <div\n        style={{\n          width: \"100%\",\n          height: \"100%\",\n          maxHeight: \"calc(100vh - 68px)\",\n          position: \"relative\",\n          overflow: \"hidden\",\n          cursor: createWithPrimary\n            ? \"crosshair\"\n            : dragging\n            ? \"grabbing\"\n            : dragWithPrimary\n            ? \"grab\"\n            : zoomWithPrimary\n            ? mat.a < 1\n              ? \"zoom-out\"\n              : \"zoom-in\"\n            : undefined,\n        }}\n      >\n        {showCrosshairs && (\n          <Crosshairs key=\"crossHairs\" mousePosition={mousePosition} />\n        )}\n        {imageLoaded && !dragging && (\n          <RegionSelectAndTransformBoxes\n            key=\"regionSelectAndTransformBoxes\"\n            regions={\n              !modifyingAllowedArea || !allowedArea\n                ? regions\n                : [\n                    {\n                      type: \"box\",\n                      id: \"$$allowed_area\",\n                      cls: \"allowed_area\",\n                      highlighted: true,\n                      x: allowedArea.x,\n                      y: allowedArea.y,\n                      w: allowedArea.w,\n                      h: allowedArea.h,\n                      visible: true,\n                      color: \"#ff0\",\n                    },\n                  ]\n            }\n            mouseEvents={mouseEvents}\n            projectRegionBox={projectRegionBox}\n            dragWithPrimary={dragWithPrimary}\n            createWithPrimary={createWithPrimary}\n            zoomWithPrimary={zoomWithPrimary}\n            onBeginMovePoint={onBeginMovePoint}\n            onSelectRegion={onSelectRegion}\n            layoutParams={layoutParams}\n            mat={mat}\n            onBeginBoxTransform={onBeginBoxTransform}\n            onBeginMovePolygonPoint={onBeginMovePolygonPoint}\n            onBeginMoveKeypoint={onBeginMoveKeypoint}\n            onAddPolygonPoint={onAddPolygonPoint}\n            showHighlightBox={showHighlightBox}\n          />\n        )}\n        {imageLoaded && showTags && !dragging && (\n          <PreventScrollToParents key=\"regionTags\">\n            <RegionTags\n              regions={regions}\n              projectRegionBox={projectRegionBox}\n              mouseEvents={mouseEvents}\n              regionClsList={regionClsList}\n              regionTagList={regionTagList}\n              onBeginRegionEdit={onBeginRegionEdit}\n              onChangeRegion={onChangeRegion}\n              onCloseRegionEdit={onCloseRegionEdit}\n              onDeleteRegion={onDeleteRegion}\n              layoutParams={layoutParams}\n              imageSrc={imageSrc}\n              RegionEditLabel={RegionEditLabel}\n              onRegionClassAdded={onRegionClassAdded}\n              allowComments={allowComments}\n            />\n          </PreventScrollToParents>\n        )}\n        {!showTags && highlightedRegion && (\n          <div key=\"topLeftTag\" className={classes.fixedRegionLabel}>\n            <RegionLabel\n              disableClose\n              allowedClasses={regionClsList}\n              allowedTags={regionTagList}\n              onChange={onChangeRegion}\n              onDelete={onDeleteRegion}\n              editing\n              region={highlightedRegion}\n              imageSrc={imageSrc}\n              allowComments={allowComments}\n            />\n          </div>\n        )}\n\n        {zoomWithPrimary && zoomBox !== null && (\n          <div\n            key=\"zoomBox\"\n            style={{\n              position: \"absolute\",\n              zIndex: 1,\n              border: \"1px solid #fff\",\n              pointerEvents: \"none\",\n              left: zoomBox.x,\n              top: zoomBox.y,\n              width: zoomBox.w,\n              height: zoomBox.h,\n            }}\n          />\n        )}\n        {showPointDistances && (\n          <PointDistances\n            key=\"pointDistances\"\n            regions={regions}\n            realSize={realSize}\n            projectRegionBox={projectRegionBox}\n            pointDistancePrecision={pointDistancePrecision}\n          />\n        )}\n        <PreventScrollToParents\n          style={{ width: \"100%\", height: \"100%\" }}\n          {...mouseEvents}\n        >\n          <>\n            {fullImageSegmentationMode && (\n              <ImageMask\n                hide={!showMask}\n                autoSegmentationOptions={autoSegmentationOptions}\n                imagePosition={imagePosition}\n                regionClsList={regionClsList}\n                imageSrc={imageSrc}\n                regions={regions}\n              />\n            )}\n            <canvas\n              style={{ opacity: 0.25 }}\n              className={classes.canvas}\n              ref={canvasEl}\n            />\n            <RegionShapes\n              mat={mat}\n              keypointDefinitions={keypointDefinitions}\n              imagePosition={imagePosition}\n              regions={regions}\n              fullSegmentationMode={fullImageSegmentationMode}\n            />\n            <VideoOrImageCanvasBackground\n              videoPlaying={videoPlaying}\n              imagePosition={imagePosition}\n              mouseEvents={mouseEvents}\n              onLoad={onVideoOrImageLoaded}\n              videoTime={videoTime}\n              videoSrc={videoSrc}\n              imageSrc={imageSrc}\n              useCrossOrigin={fullImageSegmentationMode}\n              onChangeVideoTime={onChangeVideoTime}\n              onChangeVideoPlaying={onChangeVideoPlaying}\n            />\n          </>\n        </PreventScrollToParents>\n        <div className={classes.zoomIndicator}>\n          {((1 / mat.a) * 100).toFixed(0)}%\n        </div>\n      </div>\n    </ThemeProvider>\n  )\n}\n\nexport default ImageCanvas\n","import { useEffect } from \"react\"\nimport { useSettings } from \"../SettingsProvider\"\n\nexport default ({ getLatestMat, changeMat }) => {\n  const { wasdMode } = useSettings()\n  useEffect(() => {\n    if (!wasdMode) return\n    const vel = 10\n    const dirs = {\n      w: [0, -vel],\n      a: [-vel, 0],\n      s: [0, vel],\n      d: [vel, 0],\n    }\n    const keysDown = {}\n    const keys = Object.keys(dirs)\n    const keyDownListener = (e) => {\n      if (keys.includes(e.key)) {\n        keysDown[e.key] = true\n        e.preventDefault()\n        e.stopPropagation()\n      }\n    }\n    const keyUpListener = (e) => {\n      if (keys.includes(e.key)) {\n        keysDown[e.key] = false\n        e.preventDefault()\n        e.stopPropagation()\n      }\n    }\n    const interval = setInterval(() => {\n      let newMat = getLatestMat().clone()\n      let somethingChanged = false\n      for (const key in keysDown) {\n        if (keysDown[key]) {\n          newMat = newMat.translate(...dirs[key])\n          somethingChanged = true\n        }\n      }\n      if (somethingChanged) changeMat(newMat)\n    }, 16)\n    window.addEventListener(\"keydown\", keyDownListener)\n    window.addEventListener(\"keyup\", keyUpListener)\n    return () => {\n      clearInterval(interval)\n      window.removeEventListener(\"keydown\", keyDownListener)\n      window.removeEventListener(\"keyup\", keyUpListener)\n    }\n  }, [wasdMode])\n}\n","// @flow weak\n\nimport { useRef } from \"react\"\nimport excludePatternSrc from \"./xpattern.js\"\n\nexport default () => {\n  const excludePattern = useRef(null)\n  if (excludePattern.current === null) {\n    excludePattern.current = {\n      image: new Image(),\n      pattern: null,\n    }\n    const canvas = document.createElement(\"canvas\")\n    canvas.width = 100\n    canvas.height = 100\n    const context = canvas.getContext(\"2d\")\n\n    excludePattern.current.image.onload = () => {\n      excludePattern.current.pattern = context.createPattern(\n        excludePattern.current.image,\n        \"repeat\"\n      )\n    }\n    excludePattern.current.image.src = excludePatternSrc\n  }\n  return excludePattern.current.pattern\n}\n","export default `data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH4wMSAxY5oG+lzgAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAcSURBVAjXY/jPwPCfAQnA+TAGugLcAhhakRUAAK3lEe8m9qZhAAAAAElFTkSuQmCC`\n","// @flow\n\nimport React, { memo } from \"react\"\nimport { makeStyles } from \"@mui/styles\"\nimport { createTheme, ThemeProvider } from \"@mui/material/styles\"\nimport SidebarBoxContainer from \"../SidebarBoxContainer\"\nimport CollectionsIcon from \"@mui/icons-material/Collections\"\nimport { grey } from \"@mui/material/colors\"\nimport List from \"@mui/material/List\"\nimport ListItem from \"@mui/material/ListItem\"\nimport ListItemText from \"@mui/material/ListItemText\"\nimport Avatar from \"@mui/material/Avatar\"\nimport isEqual from \"lodash/isEqual\"\n\nconst theme = createTheme()\nconst useStyles = makeStyles((theme) => ({\n  img: { width: 40, height: 40, borderRadius: 8 },\n}))\n\nexport const ImageSelectorSidebarBox = ({ images, onSelect }) => {\n  const classes = useStyles()\n  return (\n    <ThemeProvider theme={theme}>\n      <SidebarBoxContainer\n        title=\"Images\"\n        subTitle={`(${images.length})`}\n        icon={<CollectionsIcon style={{ color: grey[700] }} />}\n      >\n        <div>\n          <List>\n            {images.map((img, i) => (\n              <ListItem button onClick={() => onSelect(img)} dense key={i}>\n                <img className={classes.img} src={img.src} />\n                <ListItemText\n                  primary={img.name}\n                  secondary={`${(img.regions || []).length} Labels`}\n                />\n              </ListItem>\n            ))}\n          </List>\n        </div>\n      </SidebarBoxContainer>\n    </ThemeProvider>\n  )\n}\n\nconst mapUsedImageProps = (a) => [a.name, (a.regions || []).length, a.src]\n\nexport default memo(ImageSelectorSidebarBox, (prevProps, nextProps) =>\n  isEqual(\n    prevProps.images.map(mapUsedImageProps),\n    nextProps.images.map(mapUsedImageProps)\n  )\n)\n","// @flow\n\nconst getTimeString = (ms, precision = 1) => {\n  if (ms < 1000) {\n    return ms + \"ms\"\n  } else {\n    const secs = ms / 1000\n    if (secs < 60) {\n      if (Number.isInteger(secs)) {\n        return secs + \"s\"\n      } else {\n        return secs.toFixed(precision) + \"s\"\n      }\n    } else {\n      const mins = secs / 60\n      if (Number.isInteger(mins)) {\n        return mins + \"m\"\n      } else {\n        return mins.toFixed(precision) + \"m\"\n      }\n    }\n  }\n}\n\nexport default getTimeString\n","// @flow weak\n\nimport React, { useMemo, useState, useEffect } from \"react\"\nimport { styled } from \"@mui/material/styles\"\nimport { createTheme, ThemeProvider } from \"@mui/material/styles\"\nimport range from \"lodash/range\"\nimport * as colors from \"@mui/material/colors\"\nimport useMeasure from \"react-use-measure\"\nimport useEventCallback from \"use-event-callback\"\nimport { useRafState } from \"react-use\"\nimport getTimeString from \"./get-time-string\"\n\nconst theme = createTheme()\n\nconst Container = styled(\"div\")(({ theme }) => ({\n  position: \"relative\",\n  display: \"flex\",\n  flexGrow: 1,\n  minWidth: 240,\n  height: 64,\n  marginLeft: 16,\n  marginRight: 16,\n}))\n\nconst Tick = styled(\"div\")(({ theme }) => ({\n  position: \"absolute\",\n  width: 2,\n  marginLeft: -1,\n  height: \"100%\",\n  backgroundColor: colors.grey[300],\n  bottom: 0,\n}))\nconst TickText = styled(\"div\")(({ theme }) => ({\n  position: \"absolute\",\n  userSelect: \"none\",\n  fontSize: 10,\n  color: colors.grey[600],\n  fontWeight: \"bold\",\n  bottom: 0,\n}))\n\nconst PositionCursor = styled(\"div\")(({ theme }) => ({\n  position: \"absolute\",\n  bottom: \"calc(50% + 6px)\",\n  fontSize: 10,\n  fontWeight: \"bold\",\n  color: \"#fff\",\n  display: \"grid\",\n  placeItems: \"center\",\n  width: 48,\n  marginLeft: -24,\n  borderRadius: 2,\n  height: 24,\n  backgroundColor: colors.blue[500],\n  userSelect: \"none\",\n  fontVariantNumeric: \"tabular-nums\",\n\n  \"&::before\": {\n    position: \"absolute\",\n    bottom: -6,\n    left: 24 - 8,\n    content: '\"\"',\n    width: 0,\n    height: 0,\n    borderTop: `8px solid ${colors.blue[500]}`,\n    borderLeft: \"8px solid transparent\",\n    borderRight: \"8px solid transparent\",\n  },\n}))\n\nconst KeyframeMarker = styled(\"div\")(({ theme }) => ({\n  position: \"absolute\",\n  bottom: 8,\n  cursor: \"pointer\",\n  opacity: 0.75,\n  fontSize: 10,\n  fontWeight: \"bold\",\n  color: \"#fff\",\n  display: \"grid\",\n  placeItems: \"center\",\n  width: 16,\n  marginLeft: 0,\n  borderTopLeftRadius: 2,\n  borderTopRightRadius: 2,\n  height: 12,\n  marginLeft: -8,\n  backgroundColor: colors.red[500],\n  userSelect: \"none\",\n  fontVariantNumeric: \"tabular-nums\",\n\n  \"&::before\": {\n    position: \"absolute\",\n    bottom: -8,\n    left: 0,\n    content: '\"\"',\n    width: 0,\n    height: 0,\n    borderTop: `8px solid ${colors.red[500]}`,\n    borderLeft: \"8px solid transparent\",\n    borderRight: \"8px solid transparent\",\n  },\n}))\n\nconst min = 60000\nconst displayIntervalPairs = [\n  [50, 250],\n  [100, 500],\n  [250, 1000],\n  [1000, 5000],\n  [5000, 30000],\n  [10000, min],\n  [30000, min * 2],\n  [min, min * 5],\n  [min * 5, min * 30],\n  [min * 10, min * 60],\n  [min * 30, min * 60 * 3],\n  [min * 60, min * 60 * 5],\n]\n\nconst getMajorInterval = (duration) => {\n  for (const [minor, major] of displayIntervalPairs) {\n    if (duration / major < 6 && duration / major > 2) {\n      return [minor, major]\n    }\n  }\n  return [duration / 4, duration]\n}\n\nexport default ({\n  currentTime = 0,\n  duration,\n  onChangeCurrentTime,\n  keyframes,\n}) => {\n  const [ref, bounds] = useMeasure()\n  const [instantCurrentTime, changeInstantCurrentTime] = useState(currentTime)\n  const [draggingTime, changeDraggingTime] = useRafState(false)\n  const keyframeTimes = Object.keys(keyframes || {})\n    .map((t) => parseInt(t))\n    .filter((t) => !isNaN(t))\n    .sort((a, b) => a - b)\n\n  useEffect(() => {\n    if (currentTime !== instantCurrentTime) {\n      changeInstantCurrentTime(currentTime)\n    }\n  }, [currentTime])\n\n  const [minorInterval, majorInterval] = useMemo(\n    () => getMajorInterval(duration),\n    [duration]\n  )\n\n  const onMouseMove = useEventCallback((e) => {\n    if (draggingTime) {\n      const px = (e.clientX - bounds.left) / bounds.width\n      changeInstantCurrentTime(\n        Math.min(duration, Math.max(0, Math.floor(px * duration)))\n      )\n    }\n  })\n\n  const onMouseUp = useEventCallback((e) => {\n    changeDraggingTime(false)\n    const px = (e.clientX - bounds.left) / bounds.width\n    const newTime = Math.min(duration, Math.max(0, Math.floor(px * duration)))\n    changeInstantCurrentTime(newTime)\n    onChangeCurrentTime(newTime)\n  })\n\n  // TODO skeleton\n  if (!duration) return null\n\n  return (\n    <ThemeProvider theme={theme}>\n      <Container onMouseMove={onMouseMove} onMouseUp={onMouseUp} ref={ref}>\n        {range(0, duration, majorInterval).map((a) => (\n          <>\n            <Tick\n              key={a}\n              style={{ left: (a / duration) * bounds.width, height: \"50%\" }}\n            />\n            <TickText\n              style={{\n                left: (a / duration) * bounds.width + 8,\n                bottom: \"calc(50% - 12px)\",\n              }}\n            >\n              {getTimeString(a)}\n            </TickText>\n          </>\n        ))}\n        {range(0, duration, minorInterval)\n          .filter((a) => !Number.isInteger(a / majorInterval))\n          .map((a) => (\n            <Tick\n              key={a}\n              style={{\n                left: (a / duration) * bounds.width,\n                height: \"25%\",\n              }}\n            />\n          ))}\n        {keyframeTimes.map((kt) => (\n          <KeyframeMarker\n            onClick={() => onChangeCurrentTime(kt)}\n            key={kt}\n            style={{ left: (kt / duration) * bounds.width }}\n          />\n        ))}\n        <PositionCursor\n          onMouseDown={(e) => changeDraggingTime(true)}\n          style={{\n            cursor: draggingTime ? \"grabbing\" : \"grab\",\n            left: (instantCurrentTime / duration) * bounds.width,\n          }}\n        >\n          {getTimeString(instantCurrentTime)}\n        </PositionCursor>\n      </Container>\n    </ThemeProvider>\n  )\n}\n","// @flow weak\n\nimport React from \"react\"\nimport AddLocationIcon from \"@mui/icons-material/AddLocation\"\nimport SidebarBoxContainer from \"../SidebarBoxContainer\"\nimport * as colors from \"@mui/material/colors\"\nimport getTimeString from \"../KeyframeTimeline/get-time-string.js\"\nimport TrashIcon from \"@mui/icons-material/Delete\"\nimport { styled } from \"@mui/material/styles\"\nimport { createTheme, ThemeProvider } from \"@mui/material/styles\"\n\nconst theme = createTheme()\nconst KeyframeRow = styled(\"div\")(({ theme }) => ({\n  cursor: \"pointer\",\n  display: \"flex\",\n  alignItems: \"center\",\n  padding: 8,\n  fontSize: 14,\n  color: colors.grey[700],\n  \"&.current\": {\n    backgroundColor: colors.blue[100],\n  },\n  \"&:hover\": {\n    backgroundColor: colors.grey[100],\n  },\n  \"& .time\": {\n    flexGrow: 1,\n    fontWeight: \"bold\",\n    \"& .regionCount\": {\n      marginLeft: 8,\n      fontWeight: \"normal\",\n      color: colors.grey[500],\n    },\n  },\n  \"& .trash\": {\n    \"& .icon\": {\n      fontSize: 18,\n      color: colors.grey[600],\n      transition: \"transform 80ms\",\n      \"&:hover\": {\n        color: colors.grey[800],\n        transform: \"scale(1.25,1.25)\",\n      },\n    },\n  },\n}))\n\nconst KeyframesSelectorSidebarBox = ({\n  currentVideoTime,\n  keyframes,\n  onChangeVideoTime,\n  onDeleteKeyframe,\n}) => {\n  const keyframeTimes = Object.keys(keyframes).map((t) => parseInt(t))\n\n  return (\n    <ThemeProvider theme={theme}>\n      <SidebarBoxContainer\n        title=\"Keyframes\"\n        subTitle=\"\"\n        icon={<AddLocationIcon style={{ color: colors.grey[700] }} />}\n        expandedByDefault\n      >\n        {keyframeTimes.map((t) => (\n          <KeyframeRow\n            fullWidth\n            key={t}\n            className={currentVideoTime === t ? \"current\" : \"\"}\n            onClick={() => onChangeVideoTime(t)}\n          >\n            <div className=\"time\">\n              {getTimeString(t, 2)}\n              <span className=\"regionCount\">\n                ({(keyframes[t]?.regions || []).length})\n              </span>\n            </div>\n            <div className=\"trash\">\n              <TrashIcon\n                onClick={(e) => {\n                  onDeleteKeyframe(t)\n                  e.stopPropagation()\n                }}\n                className=\"icon\"\n              />\n            </div>\n          </KeyframeRow>\n        ))}\n      </SidebarBoxContainer>\n    </ThemeProvider>\n  )\n}\n\nexport default KeyframesSelectorSidebarBox\n","import { grey, blue, orange, purple } from \"@mui/material/colors\"\n\nexport default {\n  container: {\n    fontSize: 11,\n    fontWeight: \"bold\",\n    color: grey[700],\n    \"& .icon\": {\n      marginTop: 4,\n      width: 16,\n      height: 16,\n    },\n    \"& .icon2\": {\n      opacity: 0.5,\n      width: 16,\n      height: 16,\n      transition: \"200ms opacity\",\n      \"&:hover\": {\n        cursor: \"pointer\",\n        opacity: 1,\n      },\n    },\n  },\n  row: {\n    padding: 4,\n    cursor: \"pointer\",\n    \"&.header:hover\": {\n      backgroundColor: \"#fff\",\n    },\n    \"&.highlighted\": {\n      backgroundColor: blue[100],\n    },\n    \"&:hover\": {\n      backgroundColor: blue[50],\n      color: grey[800],\n    },\n  },\n  chip: {\n    display: \"flex\",\n    flexDirection: \"row\",\n    padding: 2,\n    borderRadius: 2,\n    paddingLeft: 4,\n    paddingRight: 4,\n    alignItems: \"center\",\n    \"& .color\": {\n      borderRadius: 5,\n      width: 10,\n      height: 10,\n      marginRight: 4,\n    },\n    \"& .text\": {},\n  },\n}\n","// @flow\n\nimport React, { Fragment, useState, memo } from \"react\"\nimport SidebarBoxContainer from \"../SidebarBoxContainer\"\nimport { makeStyles } from \"@mui/styles\"\nimport { createTheme, ThemeProvider } from \"@mui/material/styles\"\nimport { styled } from \"@mui/material/styles\"\nimport { grey } from \"@mui/material/colors\"\nimport RegionIcon from \"@mui/icons-material/PictureInPicture\"\nimport Grid from \"@mui/material/Grid\"\nimport ReorderIcon from \"@mui/icons-material/SwapVert\"\nimport PieChartIcon from \"@mui/icons-material/PieChart\"\nimport TrashIcon from \"@mui/icons-material/Delete\"\nimport LockIcon from \"@mui/icons-material/Lock\"\nimport UnlockIcon from \"@mui/icons-material/LockOpen\"\nimport VisibleIcon from \"@mui/icons-material/Visibility\"\nimport VisibleOffIcon from \"@mui/icons-material/VisibilityOff\"\nimport styles from \"./styles\"\nimport classnames from \"classnames\"\nimport isEqual from \"lodash/isEqual\"\n\nconst theme = createTheme()\nconst useStyles = makeStyles((theme) => styles)\n\nconst HeaderSep = styled(\"div\")(({ theme }) => ({\n  borderTop: `1px solid ${grey[200]}`,\n  marginTop: 2,\n  marginBottom: 2,\n}))\n\nconst Chip = ({ color, text }) => {\n  const classes = useStyles()\n  return (\n    <span className={classes.chip}>\n      <div className=\"color\" style={{ backgroundColor: color }} />\n      <div className=\"text\">{text}</div>\n    </span>\n  )\n}\n\nconst RowLayout = ({\n  header,\n  highlighted,\n  order,\n  classification,\n  area,\n  tags,\n  trash,\n  lock,\n  visible,\n  onClick,\n}) => {\n  const classes = useStyles()\n  const [mouseOver, changeMouseOver] = useState(false)\n  return (\n    <div\n      onClick={onClick}\n      onMouseEnter={() => changeMouseOver(true)}\n      onMouseLeave={() => changeMouseOver(false)}\n      className={classnames(classes.row, { header, highlighted })}\n    >\n      <Grid container alignItems=\"center\">\n        <Grid item xs={2}>\n          <div style={{ textAlign: \"right\", paddingRight: 10 }}>{order}</div>\n        </Grid>\n        <Grid item xs={5}>\n          {classification}\n        </Grid>\n        <Grid item xs={2}>\n          <div style={{ textAlign: \"right\", paddingRight: 6 }}>{area}</div>\n        </Grid>\n        <Grid item xs={1}>\n          {trash}\n        </Grid>\n        <Grid item xs={1}>\n          {lock}\n        </Grid>\n        <Grid item xs={1}>\n          {visible}\n        </Grid>\n      </Grid>\n    </div>\n  )\n}\n\nconst RowHeader = () => {\n  return (\n    <RowLayout\n      header\n      highlighted={false}\n      order={<ReorderIcon className=\"icon\" />}\n      classification={<div style={{ paddingLeft: 10 }}>Class</div>}\n      area={<PieChartIcon className=\"icon\" />}\n      trash={<TrashIcon className=\"icon\" />}\n      lock={<LockIcon className=\"icon\" />}\n      visible={<VisibleIcon className=\"icon\" />}\n    />\n  )\n}\n\nconst MemoRowHeader = memo(RowHeader)\n\nconst Row = ({\n  region: r,\n  highlighted,\n  onSelectRegion,\n  onDeleteRegion,\n  onChangeRegion,\n  visible,\n  locked,\n  color,\n  cls,\n  index,\n}) => {\n  return (\n    <RowLayout\n      header={false}\n      highlighted={highlighted}\n      onClick={() => onSelectRegion(r)}\n      order={`#${index + 1}`}\n      classification={<Chip text={cls || \"\"} color={color || \"#ddd\"} />}\n      area=\"\"\n      trash={<TrashIcon onClick={() => onDeleteRegion(r)} className=\"icon2\" />}\n      lock={\n        r.locked ? (\n          <LockIcon\n            onClick={() => onChangeRegion({ ...r, locked: false })}\n            className=\"icon2\"\n          />\n        ) : (\n          <UnlockIcon\n            onClick={() => onChangeRegion({ ...r, locked: true })}\n            className=\"icon2\"\n          />\n        )\n      }\n      visible={\n        r.visible || r.visible === undefined ? (\n          <VisibleIcon\n            onClick={() => onChangeRegion({ ...r, visible: false })}\n            className=\"icon2\"\n          />\n        ) : (\n          <VisibleOffIcon\n            onClick={() => onChangeRegion({ ...r, visible: true })}\n            className=\"icon2\"\n          />\n        )\n      }\n    />\n  )\n}\n\nconst MemoRow = memo(\n  Row,\n  (prevProps, nextProps) =>\n    prevProps.highlighted === nextProps.highlighted &&\n    prevProps.visible === nextProps.visible &&\n    prevProps.locked === nextProps.locked &&\n    prevProps.id === nextProps.id &&\n    prevProps.index === nextProps.index &&\n    prevProps.cls === nextProps.cls &&\n    prevProps.color === nextProps.color\n)\n\nconst emptyArr = []\n\nexport const RegionSelectorSidebarBox = ({\n  regions = emptyArr,\n  onDeleteRegion,\n  onChangeRegion,\n  onSelectRegion,\n}) => {\n  const classes = useStyles()\n  return (\n    <ThemeProvider theme={theme}>\n      <SidebarBoxContainer\n        title=\"Regions\"\n        subTitle=\"\"\n        icon={<RegionIcon style={{ color: grey[700] }} />}\n        expandedByDefault\n      >\n        <div className={classes.container}>\n          <MemoRowHeader />\n          <HeaderSep />\n          {regions.map((r, i) => (\n            <MemoRow\n              key={r.id}\n              {...r}\n              region={r}\n              index={i}\n              onSelectRegion={onSelectRegion}\n              onDeleteRegion={onDeleteRegion}\n              onChangeRegion={onChangeRegion}\n            />\n          ))}\n        </div>\n      </SidebarBoxContainer>\n    </ThemeProvider>\n  )\n}\n\nconst mapUsedRegionProperties = (r) => [\n  r.id,\n  r.color,\n  r.locked,\n  r.visible,\n  r.highlighted,\n]\n\nexport default memo(RegionSelectorSidebarBox, (prevProps, nextProps) =>\n  isEqual(\n    (prevProps.regions || emptyArr).map(mapUsedRegionProperties),\n    (nextProps.regions || emptyArr).map(mapUsedRegionProperties)\n  )\n)\n","// @flow\n\nimport React from \"react\"\nimport Dialog from \"@mui/material/Dialog\"\nimport DialogTitle from \"@mui/material/DialogTitle\"\nimport DialogContent from \"@mui/material/DialogContent\"\nimport DialogActions from \"@mui/material/DialogActions\"\nimport Button from \"@mui/material/Button\"\nimport Survey from \"material-survey/components/Survey\"\nimport { useSettings } from \"../SettingsProvider\"\n\nexport const SettingsDialog = ({ open, onClose }) => {\n  const settings = useSettings()\n  return (\n    <Dialog open={open || false} onClose={onClose}>\n      <DialogTitle>Settings</DialogTitle>\n      <DialogContent style={{ minWidth: 400 }}>\n        <Survey\n          variant=\"flat\"\n          noActions\n          defaultAnswers={settings}\n          onQuestionChange={(q, a, answers) => settings.changeSetting(q, a)}\n          form={{\n            questions: [\n              {\n                type: \"boolean\",\n                title: \"Show Crosshairs\",\n                name: \"showCrosshairs\",\n              },\n              {\n                type: \"boolean\",\n                title: \"Show Highlight Box\",\n                name: \"showHighlightBox\",\n              },\n              {\n                type: \"boolean\",\n                title: \"WASD Mode\",\n                name: \"wasdMode\",\n              },\n              {\n                type: \"dropdown\",\n                title: \"Video Playback Speed\",\n                name: \"videoPlaybackSpeed\",\n                defaultValue: \"1x\",\n                choices: [\"0.25x\", \"0.5x\", \"1x\", \"2x\"],\n              },\n            ],\n          }}\n        />\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={onClose}>Close</Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nexport default SettingsDialog\n","// @flow\n\nimport React, { useMemo, memo } from \"react\"\nimport SidebarBoxContainer from \"../SidebarBoxContainer\"\nimport StyleIcon from \"@mui/icons-material/Style\"\nimport { grey } from \"@mui/material/colors\"\nimport Select from \"react-select\"\nimport useEventCallback from \"use-event-callback\"\nimport { asMutable } from \"seamless-immutable\"\n\ntype Props = {\n  tags: Array<string>,\n  currentImage: { cls?: string, tags?: Array<string> },\n  imageClsList?: Array<string>,\n  imageTagList?: Array<string>,\n  onChangeImage: (Array<string>) => any,\n}\n\nconst emptyArr = []\nconst noop = () => null\n\nexport const TagsSidebarBox = ({\n  currentImage,\n  imageClsList = emptyArr,\n  imageTagList = emptyArr,\n  onChangeImage = noop,\n}: Props) => {\n  const { tags = [], cls = null } = currentImage || {}\n  const onChangeClassification = useEventCallback((o) =>\n    onChangeImage({ cls: o.value })\n  )\n  const onChangeTags = useEventCallback((o) =>\n    onChangeImage({ tags: o.map((a) => a.value) })\n  )\n  const selectValue = useMemo(\n    () => (cls ? { value: cls, label: cls } : null),\n    [cls]\n  )\n  const memoImgClsList = useMemo(\n    () => asMutable(imageClsList.map((c) => ({ value: c, label: c }))),\n    [imageClsList]\n  )\n  const memoImgTagList = useMemo(\n    () => asMutable(imageTagList.map((c) => ({ value: c, label: c }))),\n    [imageTagList]\n  )\n  const memoCurrentTags = useMemo(\n    () => tags.map((r) => ({ value: r, label: r })),\n    [tags]\n  )\n\n  if (!currentImage) return null\n\n  return (\n    <SidebarBoxContainer\n      title=\"Image Tags\"\n      expandedByDefault\n      noScroll\n      icon={<StyleIcon style={{ color: grey[700] }} />}\n    >\n      {imageClsList.length > 0 && (\n        <div style={{ padding: 8 }}>\n          <Select\n            placeholder=\"Image Classification\"\n            onChange={onChangeClassification}\n            value={selectValue}\n            options={memoImgClsList}\n          />\n        </div>\n      )}\n      {imageTagList.length > 0 && (\n        <div style={{ padding: 8, paddingTop: 0 }}>\n          <Select\n            isMulti\n            placeholder=\"Image Tags\"\n            onChange={onChangeTags}\n            value={memoCurrentTags}\n            options={memoImgTagList}\n          />\n        </div>\n      )}\n    </SidebarBoxContainer>\n  )\n}\n\nexport default memo(\n  TagsSidebarBox,\n  (prevProps, nextProps) =>\n    prevProps.currentImage.cls === nextProps.currentImage.cls &&\n    prevProps.currentImage.tags === nextProps.currentImage.tags &&\n    prevProps.imageClsList === nextProps.imageClsList &&\n    prevProps.imageTagList === nextProps.imageTagList\n)\n","// @flow\n\nimport React, { memo } from \"react\"\nimport SidebarBoxContainer from \"../SidebarBoxContainer\"\nimport DescriptionIcon from \"@mui/icons-material/Description\"\nimport { styled } from \"@mui/material/styles\"\nimport { createTheme, ThemeProvider } from \"@mui/material/styles\"\nimport { grey } from \"@mui/material/colors\"\nimport Markdown from \"react-markdown\"\n\nconst theme = createTheme()\nconst MarkdownContainer = styled(\"div\")(({ theme }) => ({\n  paddingLeft: 16,\n  paddingRight: 16,\n  fontSize: 12,\n  \"& h1\": { fontSize: 18 },\n  \"& h2\": { fontSize: 14 },\n  \"& h3\": { fontSize: 12 },\n  \"& h4\": { fontSize: 12 },\n  \"& h5\": { fontSize: 12 },\n  \"& h6\": { fontSize: 12 },\n  \"& p\": { fontSize: 12 },\n  \"& a\": {},\n  \"& img\": { width: \"100%\" },\n}))\n\nexport const TaskDescriptionSidebarBox = ({ description }) => {\n  return (\n    <ThemeProvider theme={theme}>\n      <SidebarBoxContainer\n        title=\"Task Description\"\n        icon={<DescriptionIcon style={{ color: grey[700] }} />}\n        expandedByDefault={description && description !== \"\" ? false : true}\n      >\n        <MarkdownContainer>\n          <Markdown source={description} />\n        </MarkdownContainer>\n      </SidebarBoxContainer>\n    </ThemeProvider>\n  )\n}\n\nexport default memo(TaskDescriptionSidebarBox)\n","import { getIn } from \"seamless-immutable\"\n\nexport default (state) => {\n  let currentImageIndex = null,\n    pathToActiveImage,\n    activeImage\n  if (state.annotationType === \"image\") {\n    currentImageIndex = state.selectedImage\n    if (currentImageIndex === -1) {\n      currentImageIndex = null\n      activeImage = null\n    } else {\n      pathToActiveImage = [\"images\", currentImageIndex]\n      activeImage = getIn(state, pathToActiveImage)\n    }\n  } else if (state.annotationType === \"video\") {\n    pathToActiveImage = [\"keyframes\", state.currentVideoTime || 0]\n    activeImage = getIn(state, pathToActiveImage) || null\n  }\n  return { currentImageIndex, pathToActiveImage, activeImage }\n}\n","import { getApplicationKeyMap } from \"react-hotkeys\"\n\nexport const getHotkeyHelpText = (commandName) => {\n  const firstSequence =\n    getApplicationKeyMap()[commandName]?.sequences?.[0]?.sequence\n\n  if (!firstSequence) return \"\"\n  return ` (${firstSequence})`\n}\n\nexport default getHotkeyHelpText\n","// @flow\n\nimport React from \"react\"\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport {\n  faArrowsAlt,\n  faMousePointer,\n  faExpandArrowsAlt,\n  faGripLines,\n  faTag,\n  faPaintBrush,\n  faCrosshairs,\n  faDrawPolygon,\n  faVectorSquare,\n  faHandPaper,\n  faSearch,\n  faMask,\n  faEdit,\n  faChartLine,\n} from \"@fortawesome/free-solid-svg-icons\"\nimport FullscreenIcon from \"@mui/icons-material/Fullscreen\"\nimport AccessibilityNewIcon from \"@mui/icons-material/AccessibilityNew\"\n\nconst faStyle = { marginTop: 4, width: 16, height: 16, marginBottom: 4 }\n\nexport const iconDictionary = {\n  select: () => (\n    <FontAwesomeIcon\n      style={faStyle}\n      size=\"xs\"\n      fixedWidth\n      icon={faMousePointer}\n    />\n  ),\n  pan: () => (\n    <FontAwesomeIcon style={faStyle} size=\"xs\" fixedWidth icon={faHandPaper} />\n  ),\n  zoom: () => (\n    <FontAwesomeIcon style={faStyle} size=\"xs\" fixedWidth icon={faSearch} />\n  ),\n  \"show-tags\": () => (\n    <FontAwesomeIcon style={faStyle} size=\"xs\" fixedWidth icon={faTag} />\n  ),\n  \"create-point\": () => (\n    <FontAwesomeIcon style={faStyle} size=\"xs\" fixedWidth icon={faCrosshairs} />\n  ),\n  \"create-box\": () => (\n    <FontAwesomeIcon\n      style={faStyle}\n      size=\"xs\"\n      fixedWidth\n      icon={faVectorSquare}\n    />\n  ),\n  \"create-polygon\": () => (\n    <FontAwesomeIcon\n      style={faStyle}\n      size=\"xs\"\n      fixedWidth\n      icon={faDrawPolygon}\n    />\n  ),\n  \"create-expanding-line\": () => (\n    <FontAwesomeIcon style={faStyle} size=\"xs\" fixedWidth icon={faGripLines} />\n  ),\n  \"create-line\": () => (\n    <FontAwesomeIcon style={faStyle} size=\"xs\" fixedWidth icon={faChartLine} />\n  ),\n  \"show-mask\": () => (\n    <FontAwesomeIcon style={faStyle} size=\"xs\" fixedWidth icon={faMask} />\n  ),\n  \"modify-allowed-area\": () => (\n    <FontAwesomeIcon style={faStyle} size=\"xs\" fixedWidth icon={faEdit} />\n  ),\n  \"create-keypoints\": AccessibilityNewIcon,\n  window: FullscreenIcon,\n}\n\nexport default iconDictionary\n","import { grey } from \"@mui/material/colors\"\n\nexport default {\n  container: {\n    display: \"flex\",\n    flexGrow: 1,\n    flexDirection: \"column\",\n    height: \"100%\",\n    maxHeight: \"100vh\",\n    backgroundColor: \"#fff\",\n    overflow: \"hidden\",\n    \"&.fullscreen\": {\n      position: \"absolute\",\n      zIndex: 99999,\n      left: 0,\n      right: 0,\n      top: 0,\n      bottom: 0,\n    },\n  },\n  headerTitle: {\n    fontWeight: \"bold\",\n    color: grey[700],\n    paddingLeft: 16,\n  },\n}\n","import React, { useMemo } from \"react\"\nimport { HotKeys } from \"react-hotkeys\"\n\nexport const defaultHotkeys = [\n  {\n    id: \"select_tool\",\n    description: \"Switch to the Select Tool\",\n    binding: \"escape\",\n  },\n  {\n    id: \"zoom_tool\",\n    description: \"Select the Zoom Tool\",\n    binding: \"z\",\n  },\n  {\n    id: \"create_point\",\n    description: \"Create a point\",\n  },\n  {\n    id: \"create_bounding_box\",\n    description: \"Create a bounding box\",\n    binding: \"b\",\n  },\n  {\n    id: \"pan_tool\",\n    description: \"Select the Pan Tool\",\n    binding: \"m\",\n  },\n  {\n    id: \"create_polygon\",\n    description: \"Create a Polygon\",\n    binding: \"p\",\n  },\n  {\n    id: \"create_pixel\",\n    description: \"Create a Pixel Mask\",\n  },\n  {\n    id: \"save_and_previous_sample\",\n    description: \"Save and go to previous sample\",\n    binding: \"ArrowLeft\",\n  },\n  {\n    id: \"save_and_next_sample\",\n    description: \"Save and go to next sample\",\n    binding: \"ArrowRight\",\n  },\n  {\n    id: \"save_and_exit_sample\",\n    description: \"Save and exit current sample\",\n  },\n  {\n    id: \"exit_sample\",\n    description: \"Exit sample without saving\",\n  },\n  {\n    id: \"delete_region\",\n    description: \"Delete selected region\",\n    binding: \"d\",\n  },\n  {\n    id: \"undo\",\n    description: \"Undo latest change\",\n    binding: \"Ctrl+z\",\n  },\n]\nexport const defaultKeyMap = {}\nfor (const { id, binding } of defaultHotkeys) defaultKeyMap[id] = binding\n\nexport const useDispatchHotkeyHandlers = ({ dispatch }) => {\n  const handlers = useMemo(\n    () => ({\n      select_tool: () => {\n        dispatch({\n          type: \"SELECT_TOOL\",\n          selectedTool: \"select\",\n        })\n      },\n      zoom_tool: () => {\n        dispatch({\n          type: \"SELECT_TOOL\",\n          selectedTool: \"zoom\",\n        })\n      },\n      create_point: () => {\n        dispatch({\n          type: \"SELECT_TOOL\",\n          selectedTool: \"create-point\",\n        })\n      },\n      create_bounding_box: () => {\n        dispatch({\n          type: \"SELECT_TOOL\",\n          selectedTool: \"create-box\",\n        })\n      },\n      pan_tool: () => {\n        dispatch({\n          type: \"SELECT_TOOL\",\n          selectedTool: \"pan\",\n        })\n      },\n      create_polygon: () => {\n        dispatch({\n          type: \"SELECT_TOOL\",\n          selectedTool: \"create-polygon\",\n        })\n      },\n      create_pixel: () => {\n        dispatch({\n          type: \"SELECT_TOOL\",\n          selectedTool: \"create-pixel\",\n        })\n      },\n      save_and_previous_sample: () => {\n        dispatch({\n          type: \"HEADER_BUTTON_CLICKED\",\n          buttonName: \"Prev\",\n        })\n      },\n      save_and_next_sample: () => {\n        dispatch({\n          type: \"HEADER_BUTTON_CLICKED\",\n          buttonName: \"Next\",\n        })\n      },\n      save_and_exit_sample: () => {\n        dispatch({\n          type: \"HEADER_BUTTON_CLICKED\",\n          buttonName: \"Save\",\n        })\n      },\n      delete_region: () => {\n        dispatch({\n          type: \"DELETE_SELECTED_REGION\",\n        })\n      },\n      undo: () => {\n        dispatch({\n          type: \"RESTORE_HISTORY\",\n        })\n      },\n      // TODO\n      // exit_sample: () => {\n      //   dispatch({\n      //     type: \"\",\n      //   })\n      // }\n    }),\n    [dispatch]\n  )\n  return handlers\n}\n\nexport default ({ children, dispatch }) => {\n  const handlers = useDispatchHotkeyHandlers({ dispatch })\n  return (\n    <HotKeys allowChanges handlers={handlers}>\n      {children}\n    </HotKeys>\n  )\n}\n","// @flow\n\nimport type { Region } from \"../../ImageCanvas/region-tools.js\"\n\nconst emptyArr = []\n\nexport default (\n  keyframes: { [string | number]: { regions: Array<Region> } },\n  time: number\n) => {\n  if (keyframes[time || 0]) {\n    return keyframes[time || 0].regions\n  }\n  // Get surrounding video keyframes\n  const keyframeTimes = Object.keys(keyframes)\n    .map((a) => parseInt(a))\n    .filter((a) => !isNaN(a))\n  if (keyframeTimes.length === 0) return emptyArr\n  keyframeTimes.sort((a, b) => a - b)\n  let nextKeyframeTimeIndex = keyframeTimes.findIndex((kt) => kt >= time)\n  if (nextKeyframeTimeIndex === -1) {\n    return (\n      keyframes[keyframeTimes[keyframeTimes.length - 1]].regions || emptyArr\n    )\n  } else if (nextKeyframeTimeIndex === 0) {\n    return emptyArr\n  }\n\n  const t1 = keyframeTimes[nextKeyframeTimeIndex - 1]\n  const prevKeyframe = keyframes[t1]\n  const t2 = keyframeTimes[nextKeyframeTimeIndex]\n  const nextKeyframe = keyframes[t2]\n\n  const [prevRegionMap, nextRegionMap] = [{}, {}]\n  for (const region of prevKeyframe.regions) prevRegionMap[region.id] = region\n  for (const region of nextKeyframe.regions) nextRegionMap[region.id] = region\n\n  const impliedRegions = []\n\n  // Weighted time coefficients for linear transition\n  const w1 = (t2 - time) / (t2 - t1)\n  const w2 = 1 - w1\n\n  for (const regionId in prevRegionMap) {\n    const [prev, next] = [prevRegionMap[regionId], nextRegionMap[regionId]]\n    if (!next) {\n      impliedRegions.push({\n        ...prev,\n        highlighted: false,\n        editingLabels: false,\n      })\n      continue\n    }\n    switch (prev.type) {\n      case \"point\": {\n        impliedRegions.push({\n          ...prev,\n          highlighted: false,\n          editingLabels: false,\n          x: prev.x * w1 + next.x * w2,\n          y: prev.y * w1 + next.y * w2,\n        })\n        break\n      }\n      case \"box\": {\n        impliedRegions.push({\n          ...prev,\n          highlighted: false,\n          editingLabels: false,\n          x: prev.x * w1 + next.x * w2,\n          y: prev.y * w1 + next.y * w2,\n          w: prev.w * w1 + next.w * w2,\n          h: prev.h * w1 + next.h * w2,\n        })\n        break\n      }\n      case \"polygon\": {\n        if (next.points.length === prev.points.length) {\n          impliedRegions.push({\n            ...prev,\n            highlighted: false,\n            editingLabels: false,\n            points: prev.points.map((pp, i) => [\n              pp[0] * w1 + next.points[i][0] * w2,\n              pp[1] * w1 + next.points[i][1] * w2,\n            ]),\n          })\n        } else {\n          impliedRegions.push(prev)\n        }\n        break\n      }\n      case \"keypoints\": {\n        const newPoints = {}\n        for (const [pointId, prevPoint] of Object.entries(prev.points)) {\n          newPoints[pointId] = {\n            x: prevPoint.x * w1 + next.points[pointId].x * w2,\n            y: prevPoint.y * w1 + next.points[pointId].y * w2,\n          }\n        }\n        impliedRegions.push({\n          ...prev,\n          highlighted: false,\n          editingLabels: false,\n          points: newPoints,\n        })\n        break\n      }\n      default:\n        break\n    }\n  }\n\n  return impliedRegions\n}\n","// @flow\n\nimport { useMemo } from \"react\"\nimport type { MainLayoutVideoAnnotationState } from \"../Annotator/types\"\nimport getImpliedVideoRegions from \"../Annotator/reducers/get-implied-video-regions.js\"\n\nconst emptyArr = []\n\nexport default (state: MainLayoutVideoAnnotationState) => {\n  if (state.annotationType !== \"video\") return emptyArr\n  const { keyframes, currentVideoTime = 0 } = state\n  // TODO memoize\n  return useMemo(\n    () => getImpliedVideoRegions(keyframes, currentVideoTime),\n    [keyframes, currentVideoTime]\n  )\n}\n","// @flow\n\nimport type { Action, MainLayoutState } from \"./types\"\nimport { FullScreen, useFullScreenHandle } from \"react-full-screen\"\nimport React, { useCallback, useRef } from \"react\"\nimport { makeStyles } from \"@mui/styles\"\nimport { createTheme, ThemeProvider } from \"@mui/material/styles\"\nimport { styled } from \"@mui/material/styles\"\n\nimport ClassSelectionMenu from \"../ClassSelectionMenu\"\nimport DebugBox from \"../DebugSidebarBox\"\nimport HistorySidebarBox from \"../HistorySidebarBox\"\nimport ImageCanvas from \"../ImageCanvas\"\nimport ImageSelector from \"../ImageSelectorSidebarBox\"\nimport KeyframeTimeline from \"../KeyframeTimeline\"\nimport KeyframesSelector from \"../KeyframesSelectorSidebarBox\"\nimport type { Node } from \"react\"\nimport RegionSelector from \"../RegionSelectorSidebarBox\"\nimport SettingsDialog from \"../SettingsDialog\"\nimport TagsSidebarBox from \"../TagsSidebarBox\"\nimport TaskDescription from \"../TaskDescriptionSidebarBox\"\nimport Workspace from \"react-material-workspace-layout/Workspace\"\nimport classnames from \"classnames\"\nimport getActiveImage from \"../Annotator/reducers/get-active-image\"\nimport getHotkeyHelpText from \"../utils/get-hotkey-help-text\"\nimport iconDictionary from \"./icon-dictionary\"\nimport styles from \"./styles\"\nimport { useDispatchHotkeyHandlers } from \"../ShortcutsManager\"\nimport useEventCallback from \"use-event-callback\"\nimport useImpliedVideoRegions from \"./use-implied-video-regions\"\nimport useKey from \"use-key-hook\"\nimport { useSettings } from \"../SettingsProvider\"\nimport { withHotKeys } from \"react-hotkeys\"\n\n// import Fullscreen from \"../Fullscreen\"\n\nconst emptyArr = []\nconst theme = createTheme()\nconst useStyles = makeStyles((theme) => styles)\n\nconst HotkeyDiv = withHotKeys(({ hotKeys, children, divRef, ...props }) => (\n  <div {...{ ...hotKeys, ...props }} ref={divRef}>\n    {children}\n  </div>\n))\n\nconst FullScreenContainer = styled(\"div\")(({ theme }) => ({\n  width: \"100%\",\n  height: \"100%\",\n  \"& .fullscreen\": {\n    width: \"100%\",\n    height: \"100%\",\n  },\n}))\n\ntype Props = {\n  state: MainLayoutState,\n  RegionEditLabel?: Node,\n  dispatch: (Action) => any,\n  alwaysShowNextButton?: boolean,\n  alwaysShowPrevButton?: boolean,\n  onRegionClassAdded: () => {},\n  hideHeader?: boolean,\n  hideHeaderText?: boolean,\n}\n\nexport const MainLayout = ({\n  state,\n  dispatch,\n  alwaysShowNextButton = false,\n  alwaysShowPrevButton = false,\n  RegionEditLabel,\n  onRegionClassAdded,\n  hideHeader,\n  hideHeaderText,\n  hideNext = false,\n  hidePrev = false,\n  hideClone = false,\n  hideSettings = false,\n  hideFullScreen = false,\n  hideSave = false,\n}: Props) => {\n  const classes = useStyles()\n  const settings = useSettings()\n  const fullScreenHandle = useFullScreenHandle()\n\n  const memoizedActionFns = useRef({})\n  const action = (type: string, ...params: Array<string>) => {\n    const fnKey = `${type}(${params.join(\",\")})`\n    if (memoizedActionFns.current[fnKey])\n      return memoizedActionFns.current[fnKey]\n\n    const fn = (...args: any) =>\n      params.length > 0\n        ? dispatch(\n            ({\n              type,\n              ...params.reduce((acc, p, i) => ((acc[p] = args[i]), acc), {}),\n            }: any)\n          )\n        : dispatch({ type, ...args[0] })\n    memoizedActionFns.current[fnKey] = fn\n    return fn\n  }\n\n  const { currentImageIndex, activeImage } = getActiveImage(state)\n  let nextImage\n  if (currentImageIndex !== null) {\n    nextImage = state.images[currentImageIndex + 1]\n  }\n\n  useKey(() => dispatch({ type: \"CANCEL\" }), {\n    detectKeys: [27],\n  })\n\n  const isAVideoFrame = activeImage && activeImage.frameTime !== undefined\n  const innerContainerRef = useRef()\n  const hotkeyHandlers = useDispatchHotkeyHandlers({ dispatch })\n\n  let impliedVideoRegions = useImpliedVideoRegions(state)\n\n  const refocusOnMouseEvent = useCallback((e) => {\n    if (!innerContainerRef.current) return\n    if (innerContainerRef.current.contains(document.activeElement)) return\n    if (innerContainerRef.current.contains(e.target)) {\n      innerContainerRef.current.focus()\n      e.target.focus()\n    }\n  }, [])\n\n  const canvas = (\n    <ImageCanvas\n      {...settings}\n      showCrosshairs={\n        settings.showCrosshairs &&\n        ![\"select\", \"pan\", \"zoom\"].includes(state.selectedTool)\n      }\n      key={state.selectedImage}\n      showMask={state.showMask}\n      fullImageSegmentationMode={state.fullImageSegmentationMode}\n      autoSegmentationOptions={state.autoSegmentationOptions}\n      showTags={state.showTags}\n      allowedArea={state.allowedArea}\n      modifyingAllowedArea={state.selectedTool === \"modify-allowed-area\"}\n      regionClsList={state.regionClsList}\n      regionTagList={state.regionTagList}\n      regions={\n        state.annotationType === \"image\"\n          ? activeImage.regions || []\n          : impliedVideoRegions\n      }\n      realSize={activeImage ? activeImage.realSize : undefined}\n      videoPlaying={state.videoPlaying}\n      imageSrc={state.annotationType === \"image\" ? activeImage.src : null}\n      videoSrc={state.annotationType === \"video\" ? state.videoSrc : null}\n      pointDistancePrecision={state.pointDistancePrecision}\n      createWithPrimary={state.selectedTool.includes(\"create\")}\n      dragWithPrimary={state.selectedTool === \"pan\"}\n      zoomWithPrimary={state.selectedTool === \"zoom\"}\n      showPointDistances={state.showPointDistances}\n      videoTime={\n        state.annotationType === \"image\"\n          ? state.selectedImageFrameTime\n          : state.currentVideoTime\n      }\n      keypointDefinitions={state.keypointDefinitions}\n      onMouseMove={action(\"MOUSE_MOVE\")}\n      onMouseDown={action(\"MOUSE_DOWN\")}\n      onMouseUp={action(\"MOUSE_UP\")}\n      onChangeRegion={action(\"CHANGE_REGION\", \"region\")}\n      onBeginRegionEdit={action(\"OPEN_REGION_EDITOR\", \"region\")}\n      onCloseRegionEdit={action(\"CLOSE_REGION_EDITOR\", \"region\")}\n      onDeleteRegion={action(\"DELETE_REGION\", \"region\")}\n      onBeginBoxTransform={action(\"BEGIN_BOX_TRANSFORM\", \"box\", \"directions\")}\n      onBeginMovePolygonPoint={action(\n        \"BEGIN_MOVE_POLYGON_POINT\",\n        \"polygon\",\n        \"pointIndex\"\n      )}\n      onBeginMoveKeypoint={action(\n        \"BEGIN_MOVE_KEYPOINT\",\n        \"region\",\n        \"keypointId\"\n      )}\n      onAddPolygonPoint={action(\n        \"ADD_POLYGON_POINT\",\n        \"polygon\",\n        \"point\",\n        \"pointIndex\"\n      )}\n      onSelectRegion={action(\"SELECT_REGION\", \"region\")}\n      onBeginMovePoint={action(\"BEGIN_MOVE_POINT\", \"point\")}\n      onImageLoaded={action(\"IMAGE_LOADED\", \"image\")}\n      RegionEditLabel={RegionEditLabel}\n      onImageOrVideoLoaded={action(\"IMAGE_OR_VIDEO_LOADED\", \"metadata\")}\n      onChangeVideoTime={action(\"CHANGE_VIDEO_TIME\", \"newTime\")}\n      onChangeVideoPlaying={action(\"CHANGE_VIDEO_PLAYING\", \"isPlaying\")}\n      onRegionClassAdded={onRegionClassAdded}\n      allowComments={state.allowComments}\n    />\n  )\n\n  const onClickIconSidebarItem = useEventCallback((item) => {\n    dispatch({ type: \"SELECT_TOOL\", selectedTool: item.name })\n  })\n\n  const onClickHeaderItem = useEventCallback((item) => {\n    if (item.name === \"Fullscreen\") {\n      fullScreenHandle.enter()\n    } else if (item.name === \"Window\") {\n      fullScreenHandle.exit()\n    }\n    dispatch({ type: \"HEADER_BUTTON_CLICKED\", buttonName: item.name })\n  })\n\n  const debugModeOn = Boolean(window.localStorage.$ANNOTATE_DEBUG_MODE && state)\n  const nextImageHasRegions =\n    !nextImage || (nextImage.regions && nextImage.regions.length > 0)\n\n  return (\n    <ThemeProvider theme={theme}>\n      <FullScreenContainer>\n        <FullScreen\n          handle={fullScreenHandle}\n          onChange={(open) => {\n            if (!open) {\n              fullScreenHandle.exit()\n              action(\"HEADER_BUTTON_CLICKED\", \"buttonName\")(\"Window\")\n            }\n          }}\n        >\n          <HotkeyDiv\n            tabIndex={-1}\n            divRef={innerContainerRef}\n            onMouseDown={refocusOnMouseEvent}\n            onMouseOver={refocusOnMouseEvent}\n            allowChanges\n            handlers={hotkeyHandlers}\n            className={classnames(\n              classes.container,\n              state.fullScreen && \"Fullscreen\"\n            )}\n          >\n            <Workspace\n              allowFullscreen\n              iconDictionary={iconDictionary}\n              hideHeader={hideHeader}\n              hideHeaderText={hideHeaderText}\n              headerLeftSide={[\n                state.annotationType === \"video\" ? (\n                  <KeyframeTimeline\n                    currentTime={state.currentVideoTime}\n                    duration={state.videoDuration}\n                    onChangeCurrentTime={action(\"CHANGE_VIDEO_TIME\", \"newTime\")}\n                    keyframes={state.keyframes}\n                  />\n                ) : activeImage ? (\n                  <div className={classes.headerTitle}>{activeImage.name}</div>\n                ) : null,\n              ].filter(Boolean)}\n              headerItems={[\n                !hidePrev && { name: \"Prev\" },\n                !hideNext && { name: \"Next\" },\n                state.annotationType !== \"video\"\n                  ? null\n                  : !state.videoPlaying\n                  ? { name: \"Play\" }\n                  : { name: \"Pause\" },\n                !hideClone &&\n                  !nextImageHasRegions &&\n                  activeImage.regions && { name: \"Clone\" },\n                !hideSettings && { name: \"Settings\" },\n                !hideFullScreen &&\n                  (state.fullScreen\n                    ? { name: \"Window\" }\n                    : { name: \"Fullscreen\" }),\n                !hideSave && { name: \"Save\" },\n              ].filter(Boolean)}\n              onClickHeaderItem={onClickHeaderItem}\n              onClickIconSidebarItem={onClickIconSidebarItem}\n              selectedTools={[\n                state.selectedTool,\n                state.showTags && \"show-tags\",\n                state.showMask && \"show-mask\",\n              ].filter(Boolean)}\n              iconSidebarItems={[\n                {\n                  name: \"select\",\n                  helperText: \"Select\" + getHotkeyHelpText(\"select_tool\"),\n                  alwaysShowing: true,\n                },\n                {\n                  name: \"pan\",\n                  helperText:\n                    \"Drag/Pan (right or middle click)\" +\n                    getHotkeyHelpText(\"pan_tool\"),\n                  alwaysShowing: true,\n                },\n                {\n                  name: \"zoom\",\n                  helperText:\n                    \"Zoom In/Out (scroll)\" + getHotkeyHelpText(\"zoom_tool\"),\n                  alwaysShowing: true,\n                },\n                {\n                  name: \"show-tags\",\n                  helperText: \"Show / Hide Tags\",\n                  alwaysShowing: true,\n                },\n                {\n                  name: \"create-point\",\n                  helperText: \"Add Point\" + getHotkeyHelpText(\"create_point\"),\n                },\n                {\n                  name: \"create-box\",\n                  helperText:\n                    \"Add Bounding Box\" +\n                    getHotkeyHelpText(\"create_bounding_box\"),\n                },\n                {\n                  name: \"create-polygon\",\n                  helperText:\n                    \"Add Polygon\" + getHotkeyHelpText(\"create_polygon\"),\n                },\n                {\n                  name: \"create-line\",\n                  helperText: \"Add Line\",\n                },\n                {\n                  name: \"create-expanding-line\",\n                  helperText: \"Add Expanding Line\",\n                },\n                {\n                  name: \"create-keypoints\",\n                  helperText: \"Add Keypoints (Pose)\",\n                },\n                state.fullImageSegmentationMode && {\n                  name: \"show-mask\",\n                  alwaysShowing: true,\n                  helperText: \"Show / Hide Mask\",\n                },\n                {\n                  name: \"modify-allowed-area\",\n                  helperText: \"Modify Allowed Area\",\n                },\n              ]\n                .filter(Boolean)\n                .filter(\n                  (a) => a.alwaysShowing || state.enabledTools.includes(a.name)\n                )}\n              rightSidebarItems={[\n                debugModeOn && (\n                  <DebugBox state={debugModeOn} lastAction={state.lastAction} />\n                ),\n                state.taskDescription && (\n                  <TaskDescription description={state.taskDescription} />\n                ),\n                state.regionClsList && (\n                  <ClassSelectionMenu\n                    selectedCls={state.selectedCls}\n                    regionClsList={state.regionClsList}\n                    onSelectCls={action(\"SELECT_CLASSIFICATION\", \"cls\")}\n                  />\n                ),\n                state.labelImages && (\n                  <TagsSidebarBox\n                    currentImage={activeImage}\n                    imageClsList={state.imageClsList}\n                    imageTagList={state.imageTagList}\n                    onChangeImage={action(\"CHANGE_IMAGE\", \"delta\")}\n                    expandedByDefault\n                  />\n                ),\n                // (state.images?.length || 0) > 1 && (\n                //   <ImageSelector\n                //     onSelect={action(\"SELECT_REGION\", \"region\")}\n                //     images={state.images}\n                //   />\n                // ),\n                <RegionSelector\n                  regions={activeImage ? activeImage.regions : emptyArr}\n                  onSelectRegion={action(\"SELECT_REGION\", \"region\")}\n                  onDeleteRegion={action(\"DELETE_REGION\", \"region\")}\n                  onChangeRegion={action(\"CHANGE_REGION\", \"region\")}\n                />,\n                state.keyframes && (\n                  <KeyframesSelector\n                    onChangeVideoTime={action(\"CHANGE_VIDEO_TIME\", \"newTime\")}\n                    onDeleteKeyframe={action(\"DELETE_KEYFRAME\", \"time\")}\n                    onChangeCurrentTime={action(\"CHANGE_VIDEO_TIME\", \"newTime\")}\n                    currentTime={state.currentVideoTime}\n                    duration={state.videoDuration}\n                    keyframes={state.keyframes}\n                  />\n                ),\n                <HistorySidebarBox\n                  history={state.history}\n                  onRestoreHistory={action(\"RESTORE_HISTORY\")}\n                />,\n              ].filter(Boolean)}\n            >\n              {canvas}\n            </Workspace>\n            <SettingsDialog\n              open={state.settingsOpen}\n              onClose={() =>\n                dispatch({\n                  type: \"HEADER_BUTTON_CLICKED\",\n                  buttonName: \"Settings\",\n                })\n              }\n            />\n          </HotkeyDiv>\n        </FullScreen>\n      </FullScreenContainer>\n    </ThemeProvider>\n  )\n}\n\nexport default MainLayout\n","// @flow\n\nimport type { MainLayoutState, Action } from \"../../MainLayout/types\"\nimport { setIn, updateIn, asMutable, without } from \"seamless-immutable\"\nimport moment from \"moment\"\n\nconst typesToSaveWithHistory = {\n  BEGIN_BOX_TRANSFORM: \"Transform/Move Box\",\n  BEGIN_MOVE_POINT: \"Move Point\",\n  DELETE_REGION: \"Delete Region\",\n}\n\nexport const saveToHistory = (state: MainLayoutState, name: string) =>\n  updateIn(state, [\"history\"], (h) =>\n    [\n      {\n        time: moment().toDate(),\n        state: without(state, \"history\"),\n        name,\n      },\n    ].concat((h || []).slice(0, 9))\n  )\n\nexport default (reducer) => {\n  return (state: MainLayoutState, action: Action) => {\n    const prevState = state\n    const nextState = reducer(state, action)\n\n    if (action.type === \"RESTORE_HISTORY\") {\n      if (state.history.length > 0) {\n        return setIn(\n          nextState.history[0].state,\n          [\"history\"],\n          nextState.history.slice(1)\n        )\n      }\n    } else {\n      if (\n        prevState !== nextState &&\n        Object.keys(typesToSaveWithHistory).includes(action.type)\n      ) {\n        return setIn(\n          nextState,\n          [\"history\"],\n          [\n            {\n              time: moment().toDate(),\n              state: without(prevState, \"history\"),\n              name: typesToSaveWithHistory[action.type] || action.type,\n            },\n          ]\n            .concat(nextState.history || [])\n            .slice(0, 9)\n        )\n      }\n    }\n\n    return nextState\n  }\n}\n","// @flow\n\nfunction clamp(num, min, max) {\n  return num <= min ? min : num >= max ? max : num\n}\n\nexport default (expandingLine) => {\n  const expandingWidth = expandingLine.expandingWidth || 0.005\n  const pointPairs = expandingLine.points.map(({ x, y, angle, width }, i) => {\n    if (!angle) {\n      const n =\n        expandingLine.points[clamp(i + 1, 0, expandingLine.points.length - 1)]\n      const p =\n        expandingLine.points[clamp(i - 1, 0, expandingLine.points.length - 1)]\n      angle = Math.atan2(p.x - n.x, p.y - n.y) + Math.PI / 2\n    }\n    const dx = (Math.sin(angle) * (width || expandingWidth)) / 2\n    const dy = (Math.cos(angle) * (width || expandingWidth)) / 2\n    return [\n      { x: x + dx, y: y + dy },\n      { x: x - dx, y: y - dy },\n    ]\n  })\n  const firstSection = pointPairs.map(([p1, p2]) => p1)\n  const secondSection = pointPairs.map(([p1, p2]) => p2).asMutable()\n  secondSection.reverse()\n\n  const newPoints = firstSection.concat(secondSection).map(({ x, y }) => [x, y])\n\n  return {\n    ...expandingLine,\n    type: \"polygon\",\n    open: false,\n    points: newPoints,\n    unfinished: undefined,\n    candidatePoint: undefined,\n  }\n\n  // let { expandingWidth = 0.005, points } = region\n  // expandingWidth = points.slice(-1)[0].width || expandingWidth\n  // const lastPoint = points.slice(-1)[0]\n  // return (\n  //   <>\n  //     <polygon\n  //       points={\n  //         .map((p) => `${p.x * iw} ${p.y * ih}`)\n  //         .join(\" \")}\n  // return {\n  //   ...expandingLine,\n  //   unfinished: undefined,\n  //   candidatePoint: undefined,\n  // }\n}\n","// @flow\nimport type { KeypointDefinition } from \"../ImageCanvas/region-tools\"\n\ntype Parameters = {\n  center: { x: number, y: number },\n  scale: number,\n  landmarks: {\n    [string]: KeypointDefinition,\n  },\n}\n\nexport default ({ center, scale, landmarks }: Parameters) => {\n  const points = {}\n  for (const [keypointId, { defaultPosition }] of (Object.entries(\n    landmarks\n  ): any)) {\n    points[keypointId] = {\n      x: defaultPosition[0] * scale + center.x,\n      y: defaultPosition[1] * scale + center.y,\n    }\n  }\n  return points\n}\n","// @flow\nimport type { MainLayoutState, Action } from \"../../MainLayout/types\"\nimport { moveRegion } from \"../../ImageCanvas/region-tools.js\"\nimport { getIn, setIn, updateIn } from \"seamless-immutable\"\nimport moment from \"moment\"\nimport isEqual from \"lodash/isEqual\"\nimport getActiveImage from \"./get-active-image\"\nimport { saveToHistory } from \"./history-handler.js\"\nimport colors from \"../../colors\"\nimport fixTwisted from \"./fix-twisted\"\nimport convertExpandingLineToPolygon from \"./convert-expanding-line-to-polygon\"\nimport clamp from \"clamp\"\nimport getLandmarksWithTransform from \"../../utils/get-landmarks-with-transform\"\nimport setInLocalStorage from \"../../utils/set-in-local-storage\"\n\nconst getRandomId = () => Math.random().toString().split(\".\")[1]\n\nexport default (state: MainLayoutState, action: Action) => {\n  if (\n    state.allowedArea &&\n    state.selectedTool !== \"modify-allowed-area\" &&\n    [\"MOUSE_DOWN\", \"MOUSE_UP\", \"MOUSE_MOVE\"].includes(action.type)\n  ) {\n    const aa = state.allowedArea\n    action.x = clamp(action.x, aa.x, aa.x + aa.w)\n    action.y = clamp(action.y, aa.y, aa.y + aa.h)\n  }\n\n  if (action.type === \"ON_CLS_ADDED\" && action.cls && action.cls !== \"\") {\n    const oldRegionClsList = state.regionClsList\n    const newState = {\n      ...state,\n      regionClsList: oldRegionClsList.concat(action.cls),\n    }\n    return newState\n  }\n\n  // Throttle certain actions\n  if (action.type === \"MOUSE_MOVE\") {\n    if (Date.now() - ((state: any).lastMouseMoveCall || 0) < 16) return state\n    state = setIn(state, [\"lastMouseMoveCall\"], Date.now())\n  }\n  if (!action.type.includes(\"MOUSE\")) {\n    state = setIn(state, [\"lastAction\"], action)\n  }\n\n  const { currentImageIndex, pathToActiveImage, activeImage } =\n    getActiveImage(state)\n\n  const getRegionIndex = (region) => {\n    const regionId =\n      typeof region === \"string\" || typeof region === \"number\"\n        ? region\n        : region.id\n    if (!activeImage) return null\n    const regionIndex = (activeImage.regions || []).findIndex(\n      (r) => r.id === regionId\n    )\n    return regionIndex === -1 ? null : regionIndex\n  }\n  const getRegion = (regionId) => {\n    if (!activeImage) return null\n    const regionIndex = getRegionIndex(regionId)\n    if (regionIndex === null) return [null, null]\n    const region = activeImage.regions[regionIndex]\n    return [region, regionIndex]\n  }\n  const modifyRegion = (regionId, obj) => {\n    const [region, regionIndex] = getRegion(regionId)\n    if (!region) return state\n    if (obj !== null) {\n      return setIn(state, [...pathToActiveImage, \"regions\", regionIndex], {\n        ...region,\n        ...obj,\n      })\n    } else {\n      // delete region\n      const regions = activeImage.regions\n      return setIn(\n        state,\n        [...pathToActiveImage, \"regions\"],\n        (regions || []).filter((r) => r.id !== region.id)\n      )\n    }\n  }\n  const unselectRegions = (state: MainLayoutState) => {\n    if (!activeImage) return state\n    return setIn(\n      state,\n      [...pathToActiveImage, \"regions\"],\n      (activeImage.regions || []).map((r) => ({\n        ...r,\n        highlighted: false,\n      }))\n    )\n  }\n\n  const closeEditors = (state: MainLayoutState) => {\n    if (currentImageIndex === null) return state\n    return setIn(\n      state,\n      [...pathToActiveImage, \"regions\"],\n      (activeImage.regions || []).map((r) => ({\n        ...r,\n        editingLabels: false,\n      }))\n    )\n  }\n\n  const setNewImage = (img: string | Object, index: number) => {\n    let { src, frameTime } = typeof img === \"object\" ? img : { src: img }\n    return setIn(\n      setIn(state, [\"selectedImage\"], index),\n      [\"selectedImageFrameTime\"],\n      frameTime\n    )\n  }\n\n  switch (action.type) {\n    case \"@@INIT\": {\n      return state\n    }\n    case \"SELECT_IMAGE\": {\n      return setNewImage(action.image, action.imageIndex)\n    }\n    case \"SELECT_CLASSIFICATION\": {\n      return setIn(state, [\"selectedCls\"], action.cls)\n    }\n    case \"CHANGE_REGION\": {\n      const regionIndex = getRegionIndex(action.region)\n      if (regionIndex === null) return state\n      const oldRegion = activeImage.regions[regionIndex]\n      if (oldRegion.cls !== action.region.cls) {\n        state = saveToHistory(state, \"Change Region Classification\")\n        const clsIndex = state.regionClsList.indexOf(action.region.cls)\n        if (clsIndex !== -1) {\n          state = setIn(state, [\"selectedCls\"], action.region.cls)\n          action.region.color = colors[clsIndex % colors.length]\n        }\n      }\n      if (!isEqual(oldRegion.tags, action.region.tags)) {\n        state = saveToHistory(state, \"Change Region Tags\")\n      }\n      if (!isEqual(oldRegion.comment, action.region.comment)) {\n        state = saveToHistory(state, \"Change Region Comment\")\n      }\n      return setIn(\n        state,\n        [...pathToActiveImage, \"regions\", regionIndex],\n        action.region\n      )\n    }\n    case \"CHANGE_IMAGE\": {\n      if (!activeImage) return state\n      const { delta } = action\n      for (const key of Object.keys(delta)) {\n        if (key === \"cls\") saveToHistory(state, \"Change Image Class\")\n        if (key === \"tags\") saveToHistory(state, \"Change Image Tags\")\n        state = setIn(state, [...pathToActiveImage, key], delta[key])\n      }\n      return state\n    }\n    case \"SELECT_REGION\": {\n      const { region } = action\n      const regionIndex = getRegionIndex(action.region)\n      if (regionIndex === null) return state\n      const regions = [...(activeImage.regions || [])].map((r) => ({\n        ...r,\n        highlighted: r.id === region.id,\n        editingLabels: r.id === region.id,\n      }))\n      return setIn(state, [...pathToActiveImage, \"regions\"], regions)\n    }\n    case \"BEGIN_MOVE_POINT\": {\n      state = closeEditors(state)\n      return setIn(state, [\"mode\"], {\n        mode: \"MOVE_REGION\",\n        regionId: action.point.id,\n      })\n    }\n    case \"BEGIN_BOX_TRANSFORM\": {\n      const { box, directions } = action\n      state = closeEditors(state)\n      if (directions[0] === 0 && directions[1] === 0) {\n        return setIn(state, [\"mode\"], { mode: \"MOVE_REGION\", regionId: box.id })\n      } else {\n        return setIn(state, [\"mode\"], {\n          mode: \"RESIZE_BOX\",\n          regionId: box.id,\n          freedom: directions,\n          original: { x: box.x, y: box.y, w: box.w, h: box.h },\n        })\n      }\n    }\n    case \"BEGIN_MOVE_POLYGON_POINT\": {\n      const { polygon, pointIndex } = action\n      state = closeEditors(state)\n      if (\n        state.mode &&\n        state.mode.mode === \"DRAW_POLYGON\" &&\n        pointIndex === 0\n      ) {\n        return setIn(\n          modifyRegion(polygon, {\n            points: polygon.points.slice(0, -1),\n            open: false,\n          }),\n          [\"mode\"],\n          null\n        )\n      } else {\n        state = saveToHistory(state, \"Move Polygon Point\")\n      }\n      return setIn(state, [\"mode\"], {\n        mode: \"MOVE_POLYGON_POINT\",\n        regionId: polygon.id,\n        pointIndex,\n      })\n    }\n    case \"BEGIN_MOVE_KEYPOINT\": {\n      const { region, keypointId } = action\n      state = closeEditors(state)\n      state = saveToHistory(state, \"Move Keypoint\")\n      return setIn(state, [\"mode\"], {\n        mode: \"MOVE_KEYPOINT\",\n        regionId: region.id,\n        keypointId,\n      })\n    }\n    case \"ADD_POLYGON_POINT\": {\n      const { polygon, point, pointIndex } = action\n      const regionIndex = getRegionIndex(polygon)\n      if (regionIndex === null) return state\n      const points = [...polygon.points]\n      points.splice(pointIndex, 0, point)\n      return setIn(state, [...pathToActiveImage, \"regions\", regionIndex], {\n        ...polygon,\n        points,\n      })\n    }\n    case \"MOUSE_MOVE\": {\n      const { x, y } = action\n\n      if (!state.mode) return state\n      if (!activeImage) return state\n      const { mouseDownAt } = state\n      switch (state.mode.mode) {\n        case \"MOVE_POLYGON_POINT\": {\n          const { pointIndex, regionId } = state.mode\n          const regionIndex = getRegionIndex(regionId)\n          if (regionIndex === null) return state\n          return setIn(\n            state,\n            [\n              ...pathToActiveImage,\n              \"regions\",\n              regionIndex,\n              \"points\",\n              pointIndex,\n            ],\n            [x, y]\n          )\n        }\n        case \"MOVE_KEYPOINT\": {\n          const { keypointId, regionId } = state.mode\n          const [region, regionIndex] = getRegion(regionId)\n          if (regionIndex === null) return state\n          return setIn(\n            state,\n            [\n              ...pathToActiveImage,\n              \"regions\",\n              regionIndex,\n              \"points\",\n              keypointId,\n            ],\n            { ...(region: any).points[keypointId], x, y }\n          )\n        }\n        case \"MOVE_REGION\": {\n          const { regionId } = state.mode\n          if (regionId === \"$$allowed_area\") {\n            const {\n              allowedArea: { w, h },\n            } = state\n            return setIn(state, [\"allowedArea\"], {\n              x: x - w / 2,\n              y: y - h / 2,\n              w,\n              h,\n            })\n          }\n          const regionIndex = getRegionIndex(regionId)\n          if (regionIndex === null) return state\n          return setIn(\n            state,\n            [...pathToActiveImage, \"regions\", regionIndex],\n            moveRegion(activeImage.regions[regionIndex], x, y)\n          )\n        }\n        case \"RESIZE_BOX\": {\n          const {\n            regionId,\n            freedom: [xFree, yFree],\n            original: { x: ox, y: oy, w: ow, h: oh },\n          } = state.mode\n\n          const dx = xFree === 0 ? ox : xFree === -1 ? Math.min(ox + ow, x) : ox\n          const dw =\n            xFree === 0\n              ? ow\n              : xFree === -1\n              ? ow + (ox - dx)\n              : Math.max(0, ow + (x - ox - ow))\n          const dy = yFree === 0 ? oy : yFree === -1 ? Math.min(oy + oh, y) : oy\n          const dh =\n            yFree === 0\n              ? oh\n              : yFree === -1\n              ? oh + (oy - dy)\n              : Math.max(0, oh + (y - oy - oh))\n\n          // determine if we should switch the freedom\n          if (dw <= 0.001) {\n            state = setIn(state, [\"mode\", \"freedom\"], [xFree * -1, yFree])\n          }\n          if (dh <= 0.001) {\n            state = setIn(state, [\"mode\", \"freedom\"], [xFree, yFree * -1])\n          }\n\n          if (regionId === \"$$allowed_area\") {\n            return setIn(state, [\"allowedArea\"], {\n              x: dx,\n              w: dw,\n              y: dy,\n              h: dh,\n            })\n          }\n\n          const regionIndex = getRegionIndex(regionId)\n          if (regionIndex === null) return state\n          const box = activeImage.regions[regionIndex]\n\n          return setIn(state, [...pathToActiveImage, \"regions\", regionIndex], {\n            ...box,\n            x: dx,\n            w: dw,\n            y: dy,\n            h: dh,\n          })\n        }\n        case \"RESIZE_KEYPOINTS\": {\n          const { regionId, landmarks, centerX, centerY } = state.mode\n          const distFromCenter = Math.sqrt(\n            (centerX - x) ** 2 + (centerY - y) ** 2\n          )\n          const scale = distFromCenter / 0.15\n          return modifyRegion(regionId, {\n            points: getLandmarksWithTransform({\n              landmarks,\n              center: { x: centerX, y: centerY },\n              scale,\n            }),\n          })\n        }\n        case \"DRAW_POLYGON\": {\n          const { regionId } = state.mode\n          const [region, regionIndex] = getRegion(regionId)\n          if (!region) return setIn(state, [\"mode\"], null)\n          return setIn(\n            state,\n            [\n              ...pathToActiveImage,\n              \"regions\",\n              regionIndex,\n              \"points\",\n              (region: any).points.length - 1,\n            ],\n            [x, y]\n          )\n        }\n        case \"DRAW_LINE\": {\n          const { regionId } = state.mode\n          const [region, regionIndex] = getRegion(regionId)\n          if (!region) return setIn(state, [\"mode\"], null)\n          return setIn(state, [...pathToActiveImage, \"regions\", regionIndex], {\n            ...region,\n            x2: x,\n            y2: y,\n          })\n        }\n        case \"DRAW_EXPANDING_LINE\": {\n          const { regionId } = state.mode\n          const [expandingLine, regionIndex] = getRegion(regionId)\n          if (!expandingLine) return state\n          const isMouseDown = Boolean(state.mouseDownAt)\n          if (isMouseDown) {\n            // If the mouse is down, set width/angle\n            const lastPoint = expandingLine.points.slice(-1)[0]\n            const mouseDistFromLastPoint = Math.sqrt(\n              (lastPoint.x - x) ** 2 + (lastPoint.y - y) ** 2\n            )\n            if (mouseDistFromLastPoint < 0.002 && !lastPoint.width) return state\n\n            const newState = setIn(\n              state,\n              [...pathToActiveImage, \"regions\", regionIndex, \"points\"],\n              expandingLine.points.slice(0, -1).concat([\n                {\n                  ...lastPoint,\n                  width: mouseDistFromLastPoint * 2,\n                  angle: Math.atan2(lastPoint.x - x, lastPoint.y - y),\n                },\n              ])\n            )\n            return newState\n          } else {\n            // If mouse is up, move the next candidate point\n            return setIn(\n              state,\n              [...pathToActiveImage, \"regions\", regionIndex],\n              {\n                ...expandingLine,\n                candidatePoint: { x, y },\n              }\n            )\n          }\n\n          return state\n        }\n        case \"SET_EXPANDING_LINE_WIDTH\": {\n          const { regionId } = state.mode\n          const [expandingLine, regionIndex] = getRegion(regionId)\n          if (!expandingLine) return state\n          const lastPoint = expandingLine.points.slice(-1)[0]\n          const { mouseDownAt } = state\n          return setIn(\n            state,\n            [...pathToActiveImage, \"regions\", regionIndex, \"expandingWidth\"],\n            Math.sqrt((lastPoint.x - x) ** 2 + (lastPoint.y - y) ** 2)\n          )\n        }\n        default:\n          return state\n      }\n    }\n    case \"MOUSE_DOWN\": {\n      if (!activeImage) return state\n      const { x, y } = action\n\n      state = setIn(state, [\"mouseDownAt\"], { x, y })\n\n      if (state.mode) {\n        switch (state.mode.mode) {\n          case \"DRAW_POLYGON\": {\n            const [polygon, regionIndex] = getRegion(state.mode.regionId)\n            if (!polygon) break\n            return setIn(\n              state,\n              [...pathToActiveImage, \"regions\", regionIndex],\n              { ...polygon, points: polygon.points.concat([[x, y]]) }\n            )\n          }\n          case \"DRAW_LINE\": {\n            const [line, regionIndex] = getRegion(state.mode.regionId)\n            if (!line) break\n            setIn(state, [...pathToActiveImage, \"regions\", regionIndex], {\n              ...line,\n              x2: x,\n              y2: y,\n            })\n            return setIn(state, [\"mode\"], null)\n          }\n          case \"DRAW_EXPANDING_LINE\": {\n            const [expandingLine, regionIndex] = getRegion(state.mode.regionId)\n            if (!expandingLine) break\n            const lastPoint = expandingLine.points.slice(-1)[0]\n            if (\n              expandingLine.points.length > 1 &&\n              Math.sqrt((lastPoint.x - x) ** 2 + (lastPoint.y - y) ** 2) < 0.002\n            ) {\n              if (!lastPoint.width) {\n                return setIn(state, [\"mode\"], {\n                  mode: \"SET_EXPANDING_LINE_WIDTH\",\n                  regionId: state.mode.regionId,\n                })\n              } else {\n                return state\n                  .setIn(\n                    [...pathToActiveImage, \"regions\", regionIndex],\n                    convertExpandingLineToPolygon(expandingLine)\n                  )\n                  .setIn([\"mode\"], null)\n              }\n            }\n\n            // Create new point\n            return setIn(\n              state,\n              [...pathToActiveImage, \"regions\", regionIndex, \"points\"],\n              expandingLine.points.concat([{ x, y, angle: null, width: null }])\n            )\n          }\n          case \"SET_EXPANDING_LINE_WIDTH\": {\n            const [expandingLine, regionIndex] = getRegion(state.mode.regionId)\n            if (!expandingLine) break\n            const { expandingWidth } = expandingLine\n            return state\n              .setIn(\n                [...pathToActiveImage, \"regions\", regionIndex],\n                convertExpandingLineToPolygon({\n                  ...expandingLine,\n                  points: expandingLine.points.map((p) =>\n                    p.width ? p : { ...p, width: expandingWidth }\n                  ),\n                  expandingWidth: undefined,\n                })\n              )\n              .setIn([\"mode\"], null)\n          }\n          default:\n            break\n        }\n      }\n\n      let newRegion\n      let defaultRegionCls = state.selectedCls,\n        defaultRegionColor = \"#ff0000\"\n\n      const clsIndex = (state.regionClsList || []).indexOf(defaultRegionCls)\n      if (clsIndex !== -1) {\n        defaultRegionColor = colors[clsIndex % colors.length]\n      }\n\n      switch (state.selectedTool) {\n        case \"create-point\": {\n          state = saveToHistory(state, \"Create Point\")\n          newRegion = {\n            type: \"point\",\n            x,\n            y,\n            highlighted: true,\n            editingLabels: true,\n            color: defaultRegionColor,\n            id: getRandomId(),\n            cls: defaultRegionCls,\n          }\n          break\n        }\n        case \"create-box\": {\n          state = saveToHistory(state, \"Create Box\")\n          newRegion = {\n            type: \"box\",\n            x: x,\n            y: y,\n            w: 0,\n            h: 0,\n            highlighted: true,\n            editingLabels: false,\n            color: defaultRegionColor,\n            cls: defaultRegionCls,\n            id: getRandomId(),\n          }\n          state = setIn(state, [\"mode\"], {\n            mode: \"RESIZE_BOX\",\n            editLabelEditorAfter: true,\n            regionId: newRegion.id,\n            freedom: [1, 1],\n            original: { x, y, w: newRegion.w, h: newRegion.h },\n            isNew: true,\n          })\n          break\n        }\n        case \"create-polygon\": {\n          if (state.mode && state.mode.mode === \"DRAW_POLYGON\") break\n          state = saveToHistory(state, \"Create Polygon\")\n          newRegion = {\n            type: \"polygon\",\n            points: [\n              [x, y],\n              [x, y],\n            ],\n            open: true,\n            highlighted: true,\n            color: defaultRegionColor,\n            cls: defaultRegionCls,\n            id: getRandomId(),\n          }\n          state = setIn(state, [\"mode\"], {\n            mode: \"DRAW_POLYGON\",\n            regionId: newRegion.id,\n          })\n          break\n        }\n        case \"create-expanding-line\": {\n          state = saveToHistory(state, \"Create Expanding Line\")\n          newRegion = {\n            type: \"expanding-line\",\n            unfinished: true,\n            points: [{ x, y, angle: null, width: null }],\n            open: true,\n            highlighted: true,\n            color: defaultRegionColor,\n            cls: defaultRegionCls,\n            id: getRandomId(),\n          }\n          state = setIn(state, [\"mode\"], {\n            mode: \"DRAW_EXPANDING_LINE\",\n            regionId: newRegion.id,\n          })\n          break\n        }\n        case \"create-line\": {\n          if (state.mode && state.mode.mode === \"DRAW_LINE\") break\n          state = saveToHistory(state, \"Create Line\")\n          newRegion = {\n            type: \"line\",\n            x1: x,\n            y1: y,\n            x2: x,\n            y2: y,\n            highlighted: true,\n            editingLabels: false,\n            color: defaultRegionColor,\n            cls: defaultRegionCls,\n            id: getRandomId(),\n          }\n          state = setIn(state, [\"mode\"], {\n            mode: \"DRAW_LINE\",\n            regionId: newRegion.id,\n          })\n          break\n        }\n        case \"create-keypoints\": {\n          state = saveToHistory(state, \"Create Keypoints\")\n          const [[keypointsDefinitionId, { landmarks, connections }]] =\n            (Object.entries(state.keypointDefinitions): any)\n\n          newRegion = {\n            type: \"keypoints\",\n            keypointsDefinitionId,\n            points: getLandmarksWithTransform({\n              landmarks,\n              center: { x, y },\n              scale: 1,\n            }),\n            highlighted: true,\n            editingLabels: false,\n            id: getRandomId(),\n          }\n          state = setIn(state, [\"mode\"], {\n            mode: \"RESIZE_KEYPOINTS\",\n            landmarks,\n            centerX: x,\n            centerY: y,\n            regionId: newRegion.id,\n            isNew: true,\n          })\n          break\n        }\n        default:\n          break\n      }\n\n      const regions = [...(getIn(state, pathToActiveImage).regions || [])]\n        .map((r) =>\n          setIn(r, [\"editingLabels\"], false).setIn([\"highlighted\"], false)\n        )\n        .concat(newRegion ? [newRegion] : [])\n\n      return setIn(state, [...pathToActiveImage, \"regions\"], regions)\n    }\n    case \"MOUSE_UP\": {\n      const { x, y } = action\n\n      const { mouseDownAt = { x, y } } = state\n      if (!state.mode) return state\n      state = setIn(state, [\"mouseDownAt\"], null)\n      switch (state.mode.mode) {\n        case \"RESIZE_BOX\": {\n          if (state.mode.isNew) {\n            if (\n              Math.abs(state.mode.original.x - x) < 0.002 ||\n              Math.abs(state.mode.original.y - y) < 0.002\n            ) {\n              return setIn(\n                modifyRegion(state.mode.regionId, null),\n                [\"mode\"],\n                null\n              )\n            }\n          }\n          if (state.mode.editLabelEditorAfter) {\n            return {\n              ...modifyRegion(state.mode.regionId, { editingLabels: true }),\n              mode: null,\n            }\n          }\n        }\n        case \"MOVE_REGION\":\n        case \"RESIZE_KEYPOINTS\":\n        case \"MOVE_POLYGON_POINT\": {\n          return { ...state, mode: null }\n        }\n        case \"MOVE_KEYPOINT\": {\n          return { ...state, mode: null }\n        }\n        case \"CREATE_POINT_LINE\": {\n          return state\n        }\n        case \"DRAW_EXPANDING_LINE\": {\n          const [expandingLine, regionIndex] = getRegion(state.mode.regionId)\n          if (!expandingLine) return state\n          let newExpandingLine = expandingLine\n          const lastPoint =\n            expandingLine.points.length !== 0\n              ? expandingLine.points.slice(-1)[0]\n              : mouseDownAt\n          let jointStart\n          if (expandingLine.points.length > 1) {\n            jointStart = expandingLine.points.slice(-2)[0]\n          } else {\n            jointStart = lastPoint\n          }\n          const mouseDistFromLastPoint = Math.sqrt(\n            (lastPoint.x - x) ** 2 + (lastPoint.y - y) ** 2\n          )\n          if (mouseDistFromLastPoint > 0.002) {\n            // The user is drawing has drawn the width for the last point\n            const newPoints = [...expandingLine.points]\n            for (let i = 0; i < newPoints.length - 1; i++) {\n              if (newPoints[i].width) continue\n              newPoints[i] = {\n                ...newPoints[i],\n                width: lastPoint.width,\n              }\n            }\n            newExpandingLine = setIn(\n              expandingLine,\n              [\"points\"],\n              fixTwisted(newPoints)\n            )\n          } else {\n            return state\n          }\n          return setIn(\n            state,\n            [...pathToActiveImage, \"regions\", regionIndex],\n            newExpandingLine\n          )\n        }\n        default:\n          return state\n      }\n    }\n    case \"OPEN_REGION_EDITOR\": {\n      const { region } = action\n      const regionIndex = getRegionIndex(action.region)\n      if (regionIndex === null) return state\n      const newRegions = setIn(\n        activeImage.regions.map((r) => ({\n          ...r,\n          highlighted: false,\n          editingLabels: false,\n        })),\n        [regionIndex],\n        {\n          ...(activeImage.regions || [])[regionIndex],\n          highlighted: true,\n          editingLabels: true,\n        }\n      )\n      return setIn(state, [...pathToActiveImage, \"regions\"], newRegions)\n    }\n    case \"CLOSE_REGION_EDITOR\": {\n      const { region } = action\n      const regionIndex = getRegionIndex(action.region)\n      if (regionIndex === null) return state\n      return setIn(state, [...pathToActiveImage, \"regions\", regionIndex], {\n        ...(activeImage.regions || [])[regionIndex],\n        editingLabels: false,\n      })\n    }\n    case \"DELETE_REGION\": {\n      const regionIndex = getRegionIndex(action.region)\n      if (regionIndex === null) return state\n      return setIn(\n        state,\n        [...pathToActiveImage, \"regions\"],\n        (activeImage.regions || []).filter((r) => r.id !== action.region.id)\n      )\n    }\n    case \"DELETE_SELECTED_REGION\": {\n      return setIn(\n        state,\n        [...pathToActiveImage, \"regions\"],\n        (activeImage.regions || []).filter((r) => !r.highlighted)\n      )\n    }\n    case \"HEADER_BUTTON_CLICKED\": {\n      const buttonName = action.buttonName.toLowerCase()\n      switch (buttonName) {\n        case \"prev\": {\n          if (currentImageIndex === null) return state\n          if (currentImageIndex === 0) return state\n          return setNewImage(\n            state.images[currentImageIndex - 1],\n            currentImageIndex - 1\n          )\n        }\n        case \"next\": {\n          if (currentImageIndex === null) return state\n          if (currentImageIndex === state.images.length - 1) return state\n          return setNewImage(\n            state.images[currentImageIndex + 1],\n            currentImageIndex + 1\n          )\n        }\n        case \"clone\": {\n          if (currentImageIndex === null) return state\n          if (currentImageIndex === state.images.length - 1) return state\n          return setIn(\n            setNewImage(\n              state.images[currentImageIndex + 1],\n              currentImageIndex + 1\n            ),\n            [\"images\", currentImageIndex + 1, \"regions\"],\n            activeImage.regions\n          )\n        }\n        case \"settings\": {\n          return setIn(state, [\"settingsOpen\"], !state.settingsOpen)\n        }\n        case \"help\": {\n          return state\n        }\n        case \"fullscreen\": {\n          return setIn(state, [\"fullScreen\"], true)\n        }\n        case \"exit fullscreen\":\n        case \"window\": {\n          return setIn(state, [\"fullScreen\"], false)\n        }\n        case \"hotkeys\": {\n          return state\n        }\n        case \"exit\":\n        case \"done\": {\n          return state\n        }\n        default:\n          return state\n      }\n    }\n    case \"SELECT_TOOL\": {\n      if (action.selectedTool === \"show-tags\") {\n        setInLocalStorage(\"showTags\", !state.showTags)\n        return setIn(state, [\"showTags\"], !state.showTags)\n      } else if (action.selectedTool === \"show-mask\") {\n        return setIn(state, [\"showMask\"], !state.showMask)\n      }\n      if (action.selectedTool === \"modify-allowed-area\" && !state.allowedArea) {\n        state = setIn(state, [\"allowedArea\"], { x: 0, y: 0, w: 1, h: 1 })\n      }\n      state = setIn(state, [\"mode\"], null)\n      return setIn(state, [\"selectedTool\"], action.selectedTool)\n    }\n    case \"CANCEL\": {\n      const { mode } = state\n      if (mode) {\n        switch (mode.mode) {\n          case \"DRAW_EXPANDING_LINE\":\n          case \"SET_EXPANDING_LINE_WIDTH\":\n          case \"DRAW_POLYGON\": {\n            const { regionId } = mode\n            return modifyRegion(regionId, null)\n          }\n          case \"MOVE_POLYGON_POINT\":\n          case \"RESIZE_BOX\":\n          case \"MOVE_REGION\": {\n            return setIn(state, [\"mode\"], null)\n          }\n          default:\n            return state\n        }\n      }\n      // Close any open boxes\n      const regions: any = activeImage.regions\n      if (regions && regions.some((r) => r.editingLabels)) {\n        return setIn(\n          state,\n          [...pathToActiveImage, \"regions\"],\n          regions.map((r) => ({\n            ...r,\n            editingLabels: false,\n          }))\n        )\n      } else if (regions) {\n        return setIn(\n          state,\n          [...pathToActiveImage, \"regions\"],\n          regions.map((r) => ({\n            ...r,\n            highlighted: false,\n          }))\n        )\n      }\n      break\n    }\n    default:\n      break\n  }\n  return state\n}\n","export default (key, val) => {\n  window.localStorage.setItem(\n    `__REACT_IMAGE_ANNOTATE_${key}`,\n    JSON.stringify(val)\n  )\n}\n","export default (key, defaultValue) => {\n  try {\n    return JSON.parse(window.localStorage[`__REACT_IMAGE_ANNOTATE_${key}`])\n  } catch (e) {\n    return defaultValue\n  }\n}\n","// @flow\n\nimport type {\n  MainLayoutImageAnnotationState,\n  Action,\n} from \"../../MainLayout/types\"\nimport { setIn } from \"seamless-immutable\"\nimport getActiveImage from \"./get-active-image\"\n\nexport default (state: MainLayoutImageAnnotationState, action: Action) => {\n  const { currentImageIndex, pathToActiveImage, activeImage } =\n    getActiveImage(state)\n\n  switch (action.type) {\n    case \"IMAGE_OR_VIDEO_LOADED\": {\n      return setIn(state, [\"images\", currentImageIndex, \"pixelSize\"], {\n        w: action.metadata.naturalWidth,\n        h: action.metadata.naturalHeight,\n      })\n    }\n  }\n  return state\n}\n","// @flow\n\nimport type {\n  MainLayoutVideoAnnotationState,\n  Action,\n} from \"../../MainLayout/types\"\nimport { setIn, without } from \"seamless-immutable\"\nimport getImpliedVideoRegions from \"./get-implied-video-regions\"\nimport { saveToHistory } from \"./history-handler.js\"\n\nexport default (state: MainLayoutVideoAnnotationState, action: Action) => {\n  const copyImpliedRegions = () => {\n    return setIn(\n      saveToHistory(state, \"Add Keyframe\"),\n      [\"keyframes\", state.currentVideoTime || 0],\n      {\n        regions: getImpliedVideoRegions(\n          state.keyframes,\n          state.currentVideoTime\n        ),\n      }\n    )\n  }\n\n  switch (action.type) {\n    case \"IMAGE_OR_VIDEO_LOADED\": {\n      const { duration } = action.metadata\n      if (typeof duration === \"number\") {\n        return setIn(state, [\"videoDuration\"], duration * 1000)\n      }\n    }\n    case \"HEADER_BUTTON_CLICKED\": {\n      switch (action.buttonName.toLowerCase()) {\n        case \"play\":\n          return setIn(state, [\"videoPlaying\"], true)\n        case \"pause\":\n          return setIn(state, [\"videoPlaying\"], false)\n      }\n    }\n    case \"CHANGE_VIDEO_TIME\": {\n      return setIn(state, [\"currentVideoTime\"], action.newTime)\n    }\n    case \"CHANGE_VIDEO_PLAYING\": {\n      return setIn(state, [\"videoPlaying\"], action.isPlaying)\n    }\n    case \"DELETE_KEYFRAME\": {\n      return setIn(state, [\"keyframes\"], without(state.keyframes, action.time))\n    }\n    default:\n      break\n  }\n\n  // Before the user modifies regions, copy the interpolated regions over to a\n  // new keyframe\n  if (!state.keyframes[state.currentVideoTime]) {\n    switch (action.type) {\n      case \"BEGIN_BOX_TRANSFORM\":\n      case \"BEGIN_MOVE_POINT\":\n      case \"BEGIN_MOVE_KEYPOINT\":\n      case \"BEGIN_MOVE_POLYGON_POINT\":\n      case \"ADD_POLYGON_POINT\":\n      case \"SELECT_REGION\":\n      case \"CHANGE_REGION\":\n      case \"DELETE_REGION\":\n      case \"OPEN_REGION_EDITOR\":\n        return copyImpliedRegions()\n      case \"MOUSE_DOWN\": {\n        switch (state.selectedTool) {\n          case \"create-point\":\n          case \"create-polygon\":\n          case \"create-box\":\n          case \"create-keypoints\":\n            return copyImpliedRegions()\n          default:\n            break\n        }\n        break\n      }\n      default:\n        break\n    }\n  }\n\n  return state\n}\n","import React, { useEffect, useMemo, useReducer } from \"react\"\nimport makeImmutable, { without } from \"seamless-immutable\"\nimport MainLayout from \"../MainLayout\"\nimport SettingsProvider from \"../SettingsProvider\"\nimport combineReducers from \"./reducers/combine-reducers.js\"\nimport generalReducer from \"./reducers/general-reducer.js\"\nimport getFromLocalStorage from \"../utils/get-from-local-storage\"\nimport historyHandler from \"./reducers/history-handler.js\"\nimport imageReducer from \"./reducers/image-reducer.js\"\nimport useEventCallback from \"use-event-callback\"\nimport videoReducer from \"./reducers/video-reducer.js\"\n\nexport const Annotator = ({\n  images,\n  allowedArea,\n  selectedImage = images && images.length > 0 ? 0 : undefined,\n  showPointDistances,\n  pointDistancePrecision,\n  showTags = getFromLocalStorage(\"showTags\", true),\n  enabledTools = [\n    \"select\",\n    \"create-point\",\n    \"create-box\",\n    \"create-polygon\",\n    \"create-line\",\n    \"create-expanding-line\",\n    \"show-mask\",\n  ],\n  selectedTool = \"select\",\n  regionTagList = [],\n  regionClsList = [],\n  imageTagList = [],\n  imageClsList = [],\n  keyframes = {},\n  taskDescription = \"\",\n  fullImageSegmentationMode = false,\n  RegionEditLabel,\n  videoSrc,\n  videoTime = 0,\n  videoName,\n  onExit,\n  onNextImage,\n  onPrevImage,\n  keypointDefinitions,\n  autoSegmentationOptions = { type: \"autoseg\" },\n  hideHeader,\n  hideHeaderText,\n  hideNext,\n  hidePrev,\n  hideClone,\n  hideSettings,\n  hideFullScreen,\n  hideSave,\n  allowComments,\n  onChange,\n  onImageChange\n}) => {\n  if (typeof selectedImage === \"string\") {\n    selectedImage = (images || []).findIndex((img) => img.src === selectedImage)\n    if (selectedImage === -1) selectedImage = undefined\n  }\n  const annotationType = images ? \"image\" : \"video\"\n  const [state, dispatchToReducer] = useReducer(\n    historyHandler(\n      combineReducers(\n        annotationType === \"image\" ? imageReducer : videoReducer,\n        generalReducer\n      )\n    ),\n    makeImmutable({\n      annotationType,\n      showTags,\n      allowedArea,\n      showPointDistances,\n      pointDistancePrecision,\n      selectedTool,\n      fullImageSegmentationMode: fullImageSegmentationMode,\n      autoSegmentationOptions,\n      mode: null,\n      taskDescription,\n      showMask: true,\n      labelImages: imageClsList.length > 0 || imageTagList.length > 0,\n      regionClsList,\n      regionTagList,\n      imageClsList,\n      imageTagList,\n      currentVideoTime: videoTime,\n      enabledTools,\n      history: [],\n      videoName,\n      keypointDefinitions,\n      allowComments,\n      ...(annotationType === \"image\"\n        ? {\n          selectedImage,\n          images,\n          selectedImageFrameTime:\n            images && images.length > 0 ? images[0].frameTime : undefined,\n        }\n        : {\n          videoSrc,\n          keyframes,\n        }),\n    })\n  )\n\n  const dispatch = useEventCallback((action) => {\n    if (action.type === \"HEADER_BUTTON_CLICKED\") {\n      if ([\"Exit\", \"Done\", \"Save\", \"Complete\"].includes(action.buttonName)) {\n        return onExit(without(state, \"history\"))\n      } else if (action.buttonName === \"Next\" && onNextImage) {\n        return onNextImage(without(state, \"history\"))\n      } else if (action.buttonName === \"Prev\" && onPrevImage) {\n        return onPrevImage(without(state, \"history\"))\n      }\n    }\n    dispatchToReducer(action)\n  })\n\n  const onRegionClassAdded = useEventCallback((cls) => {\n    dispatchToReducer({\n      type: \"ON_CLS_ADDED\",\n      cls: cls,\n    })\n  })\n\n  const currentImage = useMemo(() => state.images.at(state.selectedImage), [state.images, state.selectedImage])\n\n  useEffect(() => {\n    // eslint-disable-next-line no-unused-expressions\n    onChange?.(currentImage)\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [currentImage])\n\n  useEffect(() => {\n    // eslint-disable-next-line no-unused-expressions\n    onImageChange?.(state.selectedImage)\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [state.selectedImage])\n\n\n  useEffect(() => {\n    if (selectedImage === undefined) return\n    dispatchToReducer({\n      type: \"SELECT_IMAGE\",\n      imageIndex: selectedImage,\n      image: state.images[selectedImage],\n    })\n  }, [selectedImage, state.images])\n\n  if (!images && !videoSrc)\n    return 'Missing required prop \"images\" or \"videoSrc\"'\n\n  return (\n    <SettingsProvider>\n      <MainLayout\n        RegionEditLabel={RegionEditLabel}\n        alwaysShowNextButton={Boolean(onNextImage)}\n        alwaysShowPrevButton={Boolean(onPrevImage)}\n        state={state}\n        dispatch={dispatch}\n        onRegionClassAdded={onRegionClassAdded}\n        hideHeader={hideHeader}\n        hideHeaderText={hideHeaderText}\n        hideNext={hideNext}\n        hidePrev={hidePrev}\n        hideClone={hideClone}\n        hideSettings={hideSettings}\n        hideFullScreen={hideFullScreen}\n        hideSave={hideSave}\n      />\n    </SettingsProvider>\n  )\n}\n\nexport default Annotator\n","export default (...reducers) =>\n  (state, action) => {\n    for (const reducer of reducers) {\n      state = reducer(state, action)\n    }\n    return state\n  }\n","// @flow\nimport React, { useEffect, useState } from \"react\"\nimport Annotator from \"../Annotator\"\n\nconst API = \"http://167.235.19.121:1000\"\nasync function getImages() {\n  try {\n    const res = await fetch(`${API}/api/decks/1`, { mode: 'cors', headers: { 'Content-Type': 'application/json' } })\n    const data = await res.json()\n\n    return data.cards.map(card => {\n      const data = JSON.parse(card.data)\n\n      return {\n        ...card,\n        src: `${API}${card.src}`,\n        ...data\n      }\n    })\n  } catch (err) {\n    console.log(err)\n    return []\n  }\n}\n\nexport default () => {\n  const [selectedImage, setSelectedImage] = useState(0)\n  const [images, setImages] = useState([])\n  const loadImages = async () => {\n    try {\n      const images = await getImages()\n      console.log(images)\n      setImages(images)\n    } catch (err) {\n      console.log(err)\n    }\n  }\n  useEffect(() => {\n    loadImages()\n  }, [])\n\n  const saveImage = async (image) => {\n    try {\n      const { id, regions, pixelSize } = image\n      const res = await fetch(`${API}/api/cards/${id}`, {\n        method: 'PUT',\n        mode: 'cors',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          regions,\n          pixelSize\n        })\n      })\n      const data = await res.json()\n      console.log(data)\n    } catch (err) {\n      console.log(err)\n    }\n  }\n\n  if (!images.length) return <div>Loading...</div>\n\n  return (\n    <div>\n      <Annotator\n        labelImages\n        showTags\n        allowComments\n        isLabelOn\n        hideClone\n        hideNext={selectedImage === images.length - 1}\n        hidePrev={selectedImage === 0}\n        hideSettings\n\n        imageClsList={[]}\n        regionClsList={[...new Set(images.map(i => i.regions.map(r => r.cls)).flat())]}\n        enabledTools={[\"create-polygon\", \"select\"]}\n        images={images}\n        selectedImage={selectedImage}\n        onExit={(state) => {\n          saveImage(state.images[state.selectedImage])\n          console.log(state)\n        }}\n        onChange={(state) => console.log(state)}\n        onNextImage={(state) => {\n          setSelectedImage(i => i + 1)\n          saveImage(state.images[state.selectedImage])\n        }}\n        onPrevImage={(state) => {\n          setSelectedImage(i => i - 1)\n          saveImage(state.images[state.selectedImage])\n        }}\n      />\n    </div>\n  )\n}\n","// @flow\n\nimport React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport Theme from \"./Theme\"\nimport DemoSite from \"./DemoSite\"\nimport \"./site.css\"\n\nconst Site = () => {\n  return <Theme><DemoSite /></Theme>\n}\n\nReactDOM.render(<Site />, document.getElementById(\"root\"))\n"],"sourceRoot":""}