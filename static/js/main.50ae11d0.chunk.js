(this["webpackJsonpreact-image-annotate"]=this["webpackJsonpreact-image-annotate"]||[]).push([[0],{449:function(e,t,n){e.exports=n(660)},659:function(e,t,n){},660:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),i=n(35),r=n.n(i),s=n(266),c=n(671),l=n(669);const d=Object(l.a)(e=>({container:{fontFamily:'"Inter", sans-serif'}})),g=Object(s.a)({typography:{fontFamily:'"Inter", "Roboto", sans-serif'},overrides:{MuiButton:{root:{textTransform:"none"}}}});var m=({children:e})=>{d();return a.a.createElement(c.a,{theme:g},a.a.createElement("div",null,e))},h=n(6),u=n(98),p=n.n(u),b=n(9),y=n(214),O=n(12),E=n.n(O),f=n(142),x=n(257),w=n(5),v=n(725),j=n(97),I=n(37),T=n.n(I),C=n(26),M=n(404);const N=Object(s.a)(),_=Object(l.a)(e=>({container:{margin:8},header:{display:"flex",flexDirection:"row",alignItems:"center",padding:8,paddingLeft:16,paddingRight:16},title:{fontSize:14,fontWeight:"bold",flexGrow:1,paddingLeft:8,color:j.a[800],"& span":{color:j.a[600],fontSize:12}},expandButton:{padding:0,width:30,height:30,"& .icon":{marginTop:-6,width:20,height:20,transition:"500ms transform","&.expanded":{transform:"rotate(180deg)"}}},expandedContent:{maxHeight:300,overflowY:"auto","&.noScroll":{overflowY:"visible",overflow:"visible"}}}));var S=Object(o.memo)(({icon:e,title:t,subTitle:n,children:i,noScroll:r=!1,expandedByDefault:s=!1})=>{const l=_(),d=(T()(l.expandedContent,r&&"noScroll"),Object(o.useState)(s)),g=Object(b.a)(d,2),m=g[0],h=g[1];Object(C.a)(()=>h(!m));return a.a.createElement(c.a,{theme:N},a.a.createElement(M.a,{icon:e,title:t},i))},(e,t)=>e.title===t.title&&e.children===t.children),k=n(94),L=n(92),R=n(96),D=n(112),A=n(353),P=n(354),W=n(355),B=n(93),z=n(356),G=n(357),H=n(358),V=n(359);const U=[k.a[500],L.a[500],R.a[500],D.a[800],A.a[500],P.a[700],W.a[500],B.a[500],z.a[500],G.a[500],H.a[500],V.a[500]];U.map(e=>(2281701376|function(e){const t=(e=e.replace("#","")).substr(4,2)+e.substr(2,2)+e.substr(0,2);return parseInt(t,16)}(e))>>>0);var F=U,Y=n(408),K=n.n(Y),X=n(407),Z=n.n(X);const q=Object(s.a)(),J=Object(w.a)("div")(({theme:e})=>({display:"flex",paddingTop:4,paddingBottom:4,paddingLeft:16,paddingRight:16,alignItems:"center",cursor:"pointer",opacity:.7,backgroundColor:"#fff","&:hover":{opacity:1},"&.selected":{opacity:1,fontWeight:"bold"}})),$=Object(w.a)("div")(({theme:e})=>({width:12,height:12,borderRadius:12,marginRight:8})),Q=Object(w.a)("div")(({theme:e})=>({fontSize:11})),ee=Object(w.a)("div")(({theme:e})=>({flexGrow:1,borderBottom:"2px dotted ".concat(j.a[300]),marginLeft:8,marginRight:8})),te=Object(w.a)("div")(({theme:e})=>({fontSize:11,textAlign:"center",minWidth:14,paddingTop:2,paddingBottom:2,fontWeight:"bold",color:j.a[700]}));var ne=({selectedCls:e,regionClsList:t,onSelectCls:n})=>(Object(o.useEffect)(()=>{const e={};for(let a=0;a<9&&a<t.length;a++)e[a+1]=()=>n(t[a]);const o=t=>{e[t.key]&&(e[t.key](),t.preventDefault(),t.stopPropagation())};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[t,e]),a.a.createElement(c.a,{theme:q},a.a.createElement(S,{title:"Classifications",subTitle:"",icon:a.a.createElement(K.a,{style:{color:j.a[700]}}),expandedByDefault:!0},t.map((t,o)=>a.a.createElement(J,{className:T()({selected:t===e}),onClick:()=>n(t)},a.a.createElement($,{style:{backgroundColor:F[o%F.length]}}),a.a.createElement(Q,{className:T()({selected:t===e})},Z()(t)),a.a.createElement(ee,null),a.a.createElement(te,{className:T()({selected:t===e})},o<9?"Key [".concat(o+1,"]"):""))),a.a.createElement(v.a,{pb:2}))));var oe=({state:e,lastAction:t})=>{const n=(e.images||[])[e.selectedImage],o=n?(n.regions||[]).filter(e=>e.highlighted):null;return a.a.createElement(S,{title:"Debug",icon:a.a.createElement("span",null),expandedByDefault:!0},a.a.createElement("div",{style:{padding:4}},a.a.createElement("div",null,a.a.createElement("b",null,"region"),":"),a.a.createElement("pre",null,JSON.stringify(o,null,"  ")),a.a.createElement("div",null,a.a.createElement("b",null,"lastAction"),":"),a.a.createElement("pre",null,JSON.stringify(t,null,"  ")),a.a.createElement("div",null,a.a.createElement("b",null,"mode"),":"),a.a.createElement("pre",null,JSON.stringify(e.mode,null,"  ")),a.a.createElement("div",null,a.a.createElement("b",null,"frame:")),a.a.createElement("pre",null,JSON.stringify(e.selectedImageFrameTime,null,"  "))))},ae=n(409),ie=n.n(ae),re=n(726),se=n(720),ce=n(375),le=n(673),de=n(727),ge=n(410),me=n.n(ge),he=n(134),ue=n.n(he),pe=n(76),be=n.n(pe);const ye=Object(s.a)(),Oe=Object(l.a)(e=>({emptyText:{fontSize:14,fontWeight:"bold",color:j.a[500],textAlign:"center",padding:20}})),Ee={paddingLeft:16};var fe=Object(o.memo)(({history:e,onRestoreHistory:t})=>{const n=Oe();return a.a.createElement(c.a,{theme:ye},a.a.createElement(S,{title:"History",icon:a.a.createElement(ie.a,{style:{color:j.a[700]}}),expandedByDefault:!0},a.a.createElement(re.a,null,0===e.length&&a.a.createElement("div",{className:n.emptyText},"No History Yet"),e.map(({name:e,time:n},o)=>a.a.createElement(se.a,{button:!0,dense:!0,key:o},a.a.createElement(ce.a,{style:Ee,primary:e,secondary:ue()(n).format("LT")}),0===o&&a.a.createElement(de.a,{onClick:()=>t()},a.a.createElement(le.a,null,a.a.createElement(me.a,null))))))))},(e,t)=>be()(e.history.map(e=>[e.name,e.time]),t.history.map(e=>[e.name,e.time]))),xe=n(205);var we=({mousePosition:e,x:t,y:n})=>{const i=Object(o.useState)(),r=Object(b.a)(i,2),s=(r[0],r[1]);return e&&(t=e.current.x,n=e.current.y),Object(o.useEffect)(()=>{if(!e)return;const o=setInterval(()=>{t===e.current.x&&n===e.current.y||s([e.current.x,e.current.y])},10);return()=>clearInterval(o)}),a.a.createElement(o.Fragment,null,a.a.createElement("div",{style:{position:"absolute",height:"100%",width:1,zIndex:10,backgroundColor:"#f00",left:t,pointerEvents:"none",top:0}}),a.a.createElement("div",{style:{position:"absolute",width:"100%",zIndex:10,height:1,backgroundColor:"#f00",top:n,pointerEvents:"none",left:0}}))},ve={canvas:{width:"100%",height:"100%",position:"relative",zIndex:1},zoomIndicator:{position:"absolute",bottom:16,right:0,backgroundColor:"rgba(0,0,0,0.4)",color:"#fff",opacity:.5,fontWeight:"bolder",fontSize:14,padding:4},fixedRegionLabel:{position:"absolute",zIndex:10,top:10,left:10,opacity:.5,transition:"opacity 500ms","&:hover":{opacity:1}}},je=n(717);const Ie=Object(s.a)(),Te=Object(w.a)("div")(({theme:e})=>({"& > div":{width:"100%",height:"100%"}}));var Ce=e=>{let t=e.children,n=Object(f.a)(e,["children"]);const i=Object(o.useState)(!1),r=Object(b.a)(i,2),s=r[0],l=r[1],d=Object(C.a)(e=>{s||l(!0),n.onMouseMove&&n.onMouseMove(e)}),g=Object(C.a)(e=>{setTimeout(()=>{s&&l(!1)},100)});return a.a.createElement(c.a,{theme:Ie},a.a.createElement(Te,Object.assign({},n,{onMouseMove:d,onMouseLeave:g}),a.a.createElement(je.a,{enabled:s,removeScrollBar:!1},t)))},Me=n(721),Ne=n(707);var _e=(e=1/0,t=1/0)=>{const n="undefined"!==typeof window,a=Object(Me.a)({width:n?window.innerWidth:e,height:n?window.innerHeight:t}),i=Object(b.a)(a,2),r=i[0],s=i[1];return Object(o.useEffect)(()=>{if(!n)return;const e=()=>{s({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),Object(Ne.a)(()=>{n&&(window.innerWidth===r.width&&window.innerHeight===r.height||s({width:window.innerWidth,height:window.innerHeight}))},100),r};var Se=({canvasEl:e,changeMat:t,changeDragging:n,zoomStart:a,zoomEnd:i,changeZoomStart:r,changeZoomEnd:s,layoutParams:c,zoomWithPrimary:l,dragWithPrimary:d,mat:g,onMouseMove:m,onMouseUp:h,onMouseDown:u,dragging:p})=>{const b=Object(o.useRef)({x:0,y:0}),y=Object(o.useRef)({x:0,y:0}),O=(e,n)=>{const o=[n.x,n.y],a=o[0],i=o[1];let r="object"===typeof e?e.to/g.a:1+.2*e;g.translate(a,i).scaleU(r),g.a>2&&g.scaleU(2/g.a),g.a<.05&&g.scaleU(.05/g.a),g.translate(-a,-i),t(g.clone())};return{mouseEvents:{onMouseMove:n=>{const o=e.current.getBoundingClientRect(),i=o.left,r=o.top;y.current.x=b.current.x,y.current.y=b.current.y,b.current.x=n.clientX-i,b.current.y=n.clientY-r;const d=g.applyToPoint(b.current.x,b.current.y);l&&a&&s(d);const h=c.current,u=h.iw,O=h.ih;m({x:d.x/u,y:d.y/O}),p&&(g.translate(y.current.x-b.current.x,y.current.y-b.current.y),t(g.clone())),n.preventDefault()},onMouseDown:(e,t={})=>{if(e.preventDefault(),1===e.button||2===e.button||0===e.button&&d)return n(!0);const o=g.applyToPoint(b.current.x,b.current.y);if(l&&0===e.button)return r(o),void s(o);if(0===e.button){t.type,t.type;const e=c.current,n=e.iw,a=e.ih;u({x:o.x/n,y:o.y/a})}},onMouseUp:e=>{e.preventDefault();const o=g.applyToPoint(b.current.x,b.current.y);if(a){const e=o;if(Math.abs(a.x-e.x)<10&&Math.abs(a.y-e.y)<10)g.a<1?O({to:1},b.current):O({to:.25},b.current);else{const n=c.current,o=n.iw,r=n.ih;if(a.x>e.x){var i=[e.x,a.x];a.x=i[0],e.x=i[1]}if(a.y>e.y){var l=[e.y,a.y];a.y=l[0],e.y=l[1]}let s=Math.min((e.x-a.x)/o,(e.y-a.y)/r);s<.05&&(s=.05),s>10&&(s=10);const d=xe.Matrix.from(1,0,0,1,-10,-10).translate(a.x,a.y).scaleU(s);t(d.clone())}r(null),s(null)}if(1===e.button||2===e.button||0===e.button&&d)return n(!1);if(0===e.button){const e=c.current,t=e.iw,n=e.ih;h({x:o.x/t,y:o.y/n})}},onWheel:e=>{const t=e.deltaY>0?1:e.deltaY<0?-1:0;O(t,b.current)},onContextMenu:e=>{e.preventDefault()}},mousePosition:b}};var ke=({layoutParams:e,mat:t})=>Object(C.a)(n=>{const o=e.current,a=o.iw,i=o.ih,r=(e=>{switch(e.type){case"polygon":{const t={x:Math.min(...e.points.map(([e,t])=>e)),y:Math.min(...e.points.map(([e,t])=>t)),w:0,h:0};return t.w=Math.max(...e.points.map(([e,t])=>e))-t.x,t.h=Math.max(...e.points.map(([e,t])=>t))-t.y,t}case"keypoints":{const t=Math.min(...Object.values(e.points).map(({x:e,y:t})=>e)),n=Math.min(...Object.values(e.points).map(({x:e,y:t})=>t));return{x:t,y:n,w:Math.max(...Object.values(e.points).map(({x:e,y:t})=>e))-t,h:Math.max(...Object.values(e.points).map(({x:e,y:t})=>t))-n}}case"expanding-line":{const t={x:Math.min(...e.points.map(({x:e,y:t})=>e)),y:Math.min(...e.points.map(({x:e,y:t})=>t)),w:0,h:0};return t.w=Math.max(...e.points.map(({x:e,y:t})=>e))-t.x,t.h=Math.max(...e.points.map(({x:e,y:t})=>t))-t.y,t}case"line":return{x:e.x1,y:e.y1,w:0,h:0};case"box":return{x:e.x,y:e.y,w:e.w,h:e.h};case"point":return{x:e.x,y:e.y,w:0,h:0};default:return{x:0,y:0,w:0,h:0}}throw new Error("unknown region")})(n),s="point"===n.type?15:2,c={x:r.x*a-s,y:r.y*i-s,w:r.w*a+2*s,h:r.h*i+2*s};return Object(h.a)(Object(h.a)({},t.clone().inverse().applyToPoint(c.x,c.y)),{},{w:c.w/t.a,h:c.h/t.d})});const Le=Object(s.a)(),Re=Object(w.a)("svg")(({theme:e})=>({pointerEvents:"none",position:"absolute",zIndex:1,left:0,top:0,width:"100%",height:"100%","& text":{fill:"#fff"},"& path":{vectorEffect:"non-scaling-stroke",strokeWidth:2,opacity:.5,stroke:"#FFF",fill:"none",strokeDasharray:5,animationDuration:"4s",animationTimingFunction:"linear",animationIterationCount:"infinite",animationPlayState:"running"}}));var De=({projectRegionBox:e,regions:t,pointDistancePrecision:n,realSize:i})=>a.a.createElement(c.a,{theme:Le},a.a.createElement(Re,null,t.filter(e=>"point"===e.type).flatMap((r,s)=>t.filter((e,t)=>t>s).filter(e=>"point"===e.type).map(t=>{const s=e(r),c=e(t),l={x:(s.x+s.w/2+c.x+c.w/2)/2,y:(s.y+s.h/2+c.y+c.h/2)/2};let d;if(i){const e=i.w,o=i.h,a=i.unitName;d=Math.sqrt(Math.pow(r.x*e-t.x*e,2)+Math.pow(r.y*o-t.y*o,2)).toFixed(n)+a}else d=(100*Math.sqrt(Math.pow(r.x-t.x,2)+Math.pow(r.y-t.y,2))).toFixed(n)+"%";return a.a.createElement(o.Fragment,null,a.a.createElement("path",{d:"M".concat(s.x+s.w/2,",").concat(s.y+s.h/2," L").concat(c.x+c.w/2,",").concat(c.y+c.h/2)}),a.a.createElement("text",{x:l.x,y:l.y},d))})))),Ae=n(675),Pe={regionInfo:{fontSize:12,cursor:"default",transition:"opacity 200ms",opacity:.5,"&:hover":{opacity:.9,cursor:"pointer"},"&.highlighted":{opacity:.9,"&:hover":{opacity:1}},fontWeight:600,color:j.a[900],padding:8,"& .name":{display:"flex",flexDirection:"row",alignItems:"center","& .circle":{marginRight:4,boxShadow:"0px 0px 2px rgba(0,0,0,0.4)",width:10,height:10,borderRadius:5}},"& .tags":{"& .tag":{color:j.a[700],display:"inline-block",margin:1,fontSize:10,textDecoration:"underline"}}},commentBox:{fontWeight:400,fontSize:13}},We=n(398),Be=n(108),ze=n.n(Be),Ge=n(254),He=n.n(Ge),Ve=n(376),Ue=n(141),Fe=n(411);const Ye=Object(s.a)(),Ke=Object(l.a)(e=>Pe);var Xe=Object(o.memo)(({region:e,editing:t,allowedClasses:n,allowedTags:i,onDelete:r,onChange:s,onClose:l,onOpen:d,onRegionClassAdded:g,allowComments:m})=>{const u=Ke(),p=Object(o.useRef)(null);return a.a.createElement(c.a,{theme:Ye},a.a.createElement(Ae.a,{onClick:()=>t?null:d(e),className:T()(u.regionInfo,{highlighted:e.highlighted})},t?a.a.createElement("div",{style:{width:200}},a.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},a.a.createElement("div",{style:{display:"flex",backgroundColor:e.color||"#888",color:"#fff",padding:4,paddingLeft:8,paddingRight:8,borderRadius:4,fontWeight:"bold",textShadow:"0px 0px 5px rgba(0,0,0,0.4)"}},e.type),a.a.createElement("div",{style:{flexGrow:1}}),a.a.createElement(le.a,{onClick:()=>r(e),tabIndex:-1,style:{width:22,height:22},size:"small",variant:"outlined"},a.a.createElement(ze.a,{style:{marginTop:-8,width:16,height:16}}))),(n||[]).length>0&&a.a.createElement("div",{style:{marginTop:6}},a.a.createElement(Fe.a,{placeholder:"Classification",onChange:(t,n)=>("create-option"==n.action&&g(t.value),s(Object(h.a)(Object(h.a)({},e),{},{cls:t.value}))),value:e.cls?{label:e.cls,value:e.cls}:null,options:Object(O.asMutable)(n.map(e=>({value:e,label:e})))})),(i||[]).length>0&&a.a.createElement("div",{style:{marginTop:4}},a.a.createElement(Ue.default,{onChange:t=>s(Object(h.a)(Object(h.a)({},e),{},{tags:t.map(e=>e.value)})),placeholder:"Tags",value:(e.tags||[]).map(e=>({label:e,value:e})),isMulti:!0,options:Object(O.asMutable)(i.map(e=>({value:e,label:e})))})),m&&a.a.createElement(Ve.a,{InputProps:{className:u.commentBox},fullWidth:!0,multiline:!0,rows:3,ref:p,onClick:e=>{const t=p.current.children[0].children[0];if(t)return t.focus()},value:e.comment||"",onChange:t=>s(Object(h.a)(Object(h.a)({},e),{},{comment:t.target.value}))}),l&&a.a.createElement("div",{style:{marginTop:4,display:"flex"}},a.a.createElement("div",{style:{flexGrow:1}}),a.a.createElement(We.a,{onClick:()=>l(e),size:"small",variant:"contained",color:"primary"},a.a.createElement(He.a,null)))):a.a.createElement("div",null,e.cls&&a.a.createElement("div",{className:"name"},a.a.createElement("div",{className:"circle",style:{backgroundColor:e.color}}),e.cls),e.tags&&a.a.createElement("div",{className:"tags"},e.tags.map(e=>a.a.createElement("div",{key:e,className:"tag"},e))))))},(e,t)=>e.editing===t.editing&&e.region===t.region),Ze=n(167),qe=n.n(Ze);var Je=({regions:e,projectRegionBox:t,mouseEvents:n,regionClsList:o,regionTagList:i,onBeginRegionEdit:r,onChangeRegion:s,onCloseRegionEdit:c,onDeleteRegion:l,layoutParams:d,imageSrc:g,RegionEditLabel:m,onRegionClassAdded:u,allowComments:p})=>{const b=null!=m?m:Xe;return e.filter(e=>e.visible||void 0===e.visible).map(m=>{const y=t(m),O=d.current;O.iw,O.ih;let E=8;m.highlighted&&"box"===m.type&&(E+=6);const f=m.editingLabels&&!m.locked?170:m.tags?60:50,x=y.y>f,w=x?{left:y.x,top:y.y-E/2}:{left:y.x,top:y.y+y.h+E/2};return m.locked?a.a.createElement("div",{key:m.id,style:Object(h.a)(Object(h.a)({position:"absolute"},w),{},{zIndex:10+(m.editingLabels?5:0)})},a.a.createElement(Ae.a,{style:Object(h.a)(Object(h.a)({position:"absolute",left:0},x?{bottom:0}:{top:0}),{},{zIndex:10,backgroundColor:"#fff",borderRadius:4,padding:2,paddingBottom:0,opacity:.5,pointerEvents:"none"})},a.a.createElement(qe.a,{style:{width:16,height:16,color:"#333"}}))):a.a.createElement("div",{key:m.id,style:Object(h.a)(Object(h.a)({position:"absolute"},w),{},{zIndex:10+(m.editingLabels?5:0),width:200}),onMouseDown:e=>e.preventDefault(),onMouseUp:e=>e.preventDefault(),onMouseEnter:e=>{m.editingLabels&&(n.onMouseUp(e),e.button=1,n.onMouseUp(e))}},a.a.createElement("div",Object.assign({style:Object(h.a)({position:"absolute",zIndex:20,left:0},x?{bottom:0}:{top:0})},m.editingLabels?{}:((e,...t)=>{const n=Object(h.a)({},e);for(var o=0,a=t;o<a.length;o++){delete n[a[o]]}return n})(n,"onMouseDown","onMouseUp")),a.a.createElement(b,{allowedClasses:o,allowedTags:i,onOpen:r,onChange:s,onClose:c,onDelete:l,editing:m.editingLabels,region:m,regions:e,imageSrc:g,onRegionClassAdded:u,allowComments:p})))})},$e=n(728);var Qe=e=>{let t=Array.from(document.getElementsByTagName("img")).find(t=>t.src===e);const n=document.createElement("canvas"),o=n.getContext("2d");return t||(t=new Image,t.crossOrigin="anonymous",t.src=e),new Promise((e,a)=>{t.onload=()=>{n.width=t.naturalWidth,n.height=t.naturalHeight,o.drawImage(t,0,0);const a=o.getImageData(0,0,t.naturalWidth,t.naturalHeight);e(a)}})},et=n(215),tt=n.n(et);var nt=({regions:e,regionClsList:t,imageSrc:n,imagePosition:i,zIndex:r=1,hide:s=!1,autoSegmentationOptions:c={type:"simple"}})=>{const l=Object(o.useState)(null),d=Object(b.a)(l,2),g=d[0],m=d[1],u=Object(o.useState)(),p=Object(b.a)(u,2),y=p[0],O=p[1];Object(o.useEffect)(()=>{n&&Qe(n).then(e=>{tt.a.setConfig(Object(h.a)({classNames:t},c)),tt.a.loadImage(e),O(e)})},[n]),Object($e.a)(()=>{if(s)return;if(!g)return;if(!y)return;if(e.filter(e=>e.cls).length<2)return;const t=function(e){return e.map(e=>{switch(e.type){case"point":return{regionType:"point",classification:e.cls,x:e.x,y:e.y};case"polygon":return{regionType:"polygon",classification:e.cls,points:e.points.map(([e,t])=>({x:e,y:t}))};case"box":return{regionType:"bounding-box",classification:e.cls,centerX:e.x+e.w/2,centerY:e.y+e.h/2,width:e.w,height:e.h};default:return null}}).filter(Boolean)}(e);tt.a.getMask(t).then(e=>{const t=g.getContext("2d");t.clearRect(0,0,e.width,e.height),t.putImageData(e,0,0)})},1e3,[g,y,e,s]);const E=Object(o.useMemo)(()=>{let e=i.bottomRight.x-i.topLeft.x,t=i.bottomRight.y-i.topLeft.y;return{display:s?"none":void 0,imageRendering:"pixelated",transform:"translateZ(0px)",left:i.topLeft.x,top:i.topLeft.y,width:isNaN(e)?0:e,height:isNaN(t)?0:t,zIndex:r,position:"absolute",pointerEvents:"none"}},[i.topLeft.x,i.topLeft.y,i.bottomRight.x,i.bottomRight.y,r,s]);return a.a.createElement("canvas",{style:E,width:y?y.width:0,height:y?y.height:0,ref:m})};const ot=Object(s.a)(),at=Object(l.a)(e=>({"@keyframes borderDance":{from:{strokeDashoffset:0},to:{strokeDashoffset:100}},highlightBox:{zIndex:2,transition:"opacity 500ms","&.highlighted":{zIndex:3},"&:not(.highlighted)":{opacity:0},"&:not(.highlighted):hover":{opacity:.6},"& path":{vectorEffect:"non-scaling-stroke",strokeWidth:2,stroke:"#FFF",fill:"none",strokeDasharray:5,animationName:"$borderDance",animationDuration:"4s",animationTimingFunction:"linear",animationIterationCount:"infinite",animationPlayState:"running"}}}));var it=({mouseEvents:e,dragWithPrimary:t,zoomWithPrimary:n,createWithPrimary:o,onBeginMovePoint:i,onSelectRegion:r,region:s,pbox:l})=>{const d=at();if(!l.w||l.w===1/0)return null;if(!l.h||l.h===1/0)return null;if(s.unfinished)return null;const g="point"===s.type?{left:l.x+l.w/2-30,top:l.y+l.h/2-30,width:60,height:60}:{left:l.x-5,top:l.y-5,width:l.w+10,height:l.h+10},m="point"===s.type?"M5,5 L".concat(g.width-5," 5L").concat(g.width-5," ").concat(g.height-5,"L5 ").concat(g.height-5,"Z"):"M5,5 L".concat(l.w+5,",5 L").concat(l.w+5,",").concat(l.h+5," L5,").concat(l.h+5," Z");return a.a.createElement(c.a,{theme:ot},a.a.createElement("svg",Object.assign({key:s.id,className:T()(d.highlightBox,{highlighted:s.highlighted})},e,n||t?{}:{onMouseDown:t=>!s.locked&&"point"===s.type&&s.highlighted&&0===t.button?i(s):0!==t.button||o?void e.onMouseDown(t):r(s)},{style:Object(h.a)(Object(h.a)({},s.highlighted?{pointerEvents:"point"!==s.type?"none":void 0,cursor:"grab"}:{cursor:n||t||o?void 0:"pointer",pointerEvents:n||t||o&&!s.highlighted?"none":void 0}),{},{position:"absolute"},g)}),a.a.createElement("path",{d:m})))},rt=n(723);const st=Object(s.a)(),ct=Object(w.a)("div")(({theme:e})=>({width:8,height:8,zIndex:2,border:"2px solid #FFF",position:"absolute"})),lt=[["nw-resize","n-resize","ne-resize"],["w-resize","grab","e-resize"],["sw-resize","s-resize","se-resize"]],dt=Object(o.memo)(({region:e,mouseEvents:t,projectRegionBox:n,dragWithPrimary:i,createWithPrimary:r,zoomWithPrimary:s,onBeginMovePoint:l,onSelectRegion:d,layoutParams:g,fullImageSegmentationMode:m=!1,mat:h,onBeginBoxTransform:u,onBeginMovePolygonPoint:p,onBeginMoveKeypoint:b,onAddPolygonPoint:y,showHighlightBox:O})=>{const E=n(e),f=g.current,x=f.iw,w=f.ih;return a.a.createElement(c.a,{theme:st},a.a.createElement(o.Fragment,null,a.a.createElement(Ce,null,O&&"polygon"!==e.type&&a.a.createElement(it,{region:e,mouseEvents:t,dragWithPrimary:i,createWithPrimary:r,zoomWithPrimary:s,onBeginMovePoint:l,onSelectRegion:d,pbox:E}),"box"===e.type&&!i&&!s&&!e.locked&&e.highlighted&&h.a<1.2&&[[0,0],[.5,0],[1,0],[1,.5],[1,1],[.5,1],[0,1],[0,.5],[.5,.5]].map(([n,o],i)=>a.a.createElement(ct,Object.assign({key:i},t,{onMouseDown:a=>{if(0===a.button)return u(e,[2*n-1,2*o-1]);t.onMouseDown(a)},style:{left:E.x-4-2+E.w*n,top:E.y-4-2+E.h*o,cursor:lt[2*o][2*n],borderRadius:.5===n&&.5===o?4:void 0}}))),"polygon"===e.type&&!i&&!s&&!e.locked&&e.highlighted&&e.points.map(([n,o],i)=>{const r=h.clone().inverse().applyToPoint(n*x,o*w);return a.a.createElement(ct,Object.assign({key:i},t,{onMouseDown:n=>{if(0===n.button&&(!e.open||0===i))return p(e,i);t.onMouseDown(n)},style:{cursor:e.open?0===i?"pointer":void 0:"move",zIndex:10,pointerEvents:e.open&&i===e.points.length-1?"none":void 0,left:r.x-4,top:r.y-4}}))}),"polygon"===e.type&&e.highlighted&&!i&&!s&&!e.locked&&!e.open&&e.points.length>1&&e.points.map((t,n)=>[t,e.points[(n+1)%e.points.length]]).map(([e,t])=>[(e[0]+t[0])/2,(e[1]+t[1])/2]).map((n,o)=>{const i=h.clone().inverse().applyToPoint(n[0]*x,n[1]*w);return a.a.createElement(ct,Object.assign({key:o},t,{onMouseDown:a=>{if(0===a.button)return y(e,n,o+1);t.onMouseDown(a)},style:{cursor:"copy",zIndex:10,left:i.x-4,top:i.y-4,border:"2px dotted #fff",opacity:.5}}))}),"keypoints"===e.type&&!i&&!s&&!e.locked&&e.highlighted&&Object.entries(e.points).map(([n,{x:o,y:i}],r)=>{const s=h.clone().inverse().applyToPoint(o*x,i*w);return a.a.createElement(rt.a,{title:n,key:r},a.a.createElement(ct,Object.assign({key:r},t,{onMouseDown:o=>{if(0===o.button&&(!e.open||0===r))return b(e,n);t.onMouseDown(o)},style:{cursor:e.open?0===r?"pointer":void 0:"move",zIndex:10,pointerEvents:e.open&&r===e.points.length-1?"none":void 0,left:s.x-4,top:s.y-4}})))}))))},(e,t)=>e.region===t.region&&e.dragWithPrimary===t.dragWithPrimary&&e.createWithPrimary===t.createWithPrimary&&e.zoomWithPrimary===t.zoomWithPrimary&&e.mat===t.mat);var gt=Object(o.memo)(e=>e.regions.filter(e=>e.visible||void 0===e.visible).filter(e=>!e.locked).map((t,n)=>a.a.createElement(dt,Object.assign({key:t.id},e,{region:t}))),(e,t)=>e.regions===t.regions&&e.mat===t.mat);const mt=Object(o.createContext)({showCrosshairs:!1,showHighlightBox:!0,wasdMode:!0}),ht=()=>Object(o.useContext)(mt);var ut=({children:e})=>{const t=Object(o.useState)(()=>(()=>{if(!window||!window.localStorage)return{};let e={};for(let n=0;n<window.localStorage.length;n++){const o=window.localStorage.key(n);if(o.startsWith("settings_"))try{e[o.replace("settings_","")]=JSON.parse(window.localStorage.getItem(o))}catch(t){}}return e})()),n=Object(b.a)(t,2),i=n[0],r=n[1];return a.a.createElement(mt.Provider,{value:Object(h.a)(Object(h.a)({},i),{},{changeSetting:(e,t)=>{r(Object(h.a)(Object(h.a)({},i),{},{[e]:t})),window.localStorage.setItem("settings_".concat(e),JSON.stringify(t))}})},e)};const pt=Object(s.a)(),bt=Object(w.a)("video")(({theme:e})=>({zIndex:0,position:"absolute"})),yt=Object(w.a)("img")(({theme:e})=>({zIndex:0,position:"absolute"})),Ot=Object(w.a)("div")(({theme:e})=>({zIndex:0,position:"absolute",left:0,right:0,bottom:0,top:0,backgroundColor:"rgba(255,0,0,0.2)",color:"#ff0000",fontWeight:"bold",whiteSpace:"pre-wrap",padding:50}));var Et=({imagePosition:e,mouseEvents:t,videoTime:n,videoSrc:i,imageSrc:r,onLoad:s,useCrossOrigin:l=!1,videoPlaying:d,onChangeVideoTime:g,onChangeVideoPlaying:m})=>{const h=ht(),u=Object(o.useRef)(),p=Object(o.useRef)(),y=Object(o.useState)(),O=Object(b.a)(y,2),E=O[0],f=O[1];Object(o.useEffect)(()=>{!d&&u.current&&(u.current.currentTime=(n||0)/1e3)},[n]),Object(o.useEffect)(()=>{let e=!1;return u.current&&(d?(u.current.play(),e=!0,h.videoPlaybackSpeed&&(u.current.playbackRate=parseFloat(h.videoPlaybackSpeed))):u.current.pause()),function t(){if(!e)return;if(!u.current)return;const o=Math.floor(1e3*u.current.currentTime);n!==o&&g(o),u.current.paused&&(e=!1,m(!1)),requestAnimationFrame(t)}(),()=>{e=!1}},[d]);const x=Object(C.a)(e=>{const t=e.currentTarget;t.currentTime=(n||0)/1e3,s&&s({naturalWidth:t.videoWidth,naturalHeight:t.videoHeight,videoElm:t,duration:t.duration})}),w=Object(C.a)(e=>{const t=e.currentTarget;s&&s({naturalWidth:t.naturalWidth,naturalHeight:t.naturalHeight,imageElm:t})}),v=Object(C.a)(e=>{f("Could not load image\n\nMake sure your image works by visiting ".concat(r||i," in a web browser. If that URL works, the server hosting the URL may be not allowing you to access the image from your current domain. Adjust server settings to enable the image to be viewed.").concat(l?"\n\nYour image may be blocked because it's not being sent with CORs headers. To do pixel segmentation, browser web security requires CORs headers in order for the algorithm to read the pixel data from the image. CORs headers are easy to add if you're using an S3 bucket or own the server hosting your images.":"","\n\n If you need a hand, reach out to the community at universaldatatool.slack.com"))}),j=Object(o.useMemo)(()=>{let t=e.bottomRight.x-e.topLeft.x,n=e.bottomRight.y-e.topLeft.y;return{imageRendering:"pixelated",left:e.topLeft.x,top:e.topLeft.y,width:isNaN(t)?0:t,height:isNaN(n)?0:n}},[e.topLeft.x,e.topLeft.y,e.bottomRight.x,e.bottomRight.y]);return i||r?E?a.a.createElement(Ot,null,E):a.a.createElement(c.a,{theme:pt},r&&void 0===n?a.a.createElement(yt,Object.assign({},t,{src:r,ref:p,style:j,onLoad:w,onError:v,crossOrigin:l?"anonymous":void 0})):a.a.createElement(bt,Object.assign({},t,{ref:u,style:j,onLoadedMetadata:x,src:i||r}))):a.a.createElement(Ot,null,"No imageSrc or videoSrc provided")},ft=n(62),xt=n.n(ft);function wt(e,t,n){return e<=t?t:e>=n?n:e}const vt={point:Object(o.memo)(({region:e,iw:t,ih:n})=>a.a.createElement("g",{transform:"translate(".concat(e.x*t," ").concat(e.y*n,")")},a.a.createElement("path",{d:"M0 8L8 0L0 -8L-8 0Z",strokeWidth:2,stroke:e.color,fill:"transparent"}))),line:Object(o.memo)(({region:e,iw:t,ih:n})=>a.a.createElement("g",{transform:"translate(".concat(e.x1*t," ").concat(e.y1*n,")")},a.a.createElement("line",{strokeWidth:2,x1:0,y1:0,x2:(e.x2-e.x1)*t,y2:(e.y2-e.y1)*n,stroke:xt()(e.color,.75),fill:xt()(e.color,.25)}))),box:Object(o.memo)(({region:e,iw:t,ih:n})=>a.a.createElement("g",{transform:"translate(".concat(e.x*t," ").concat(e.y*n,")")},a.a.createElement("rect",{strokeWidth:2,x:0,y:0,width:Math.max(e.w*t,0),height:Math.max(e.h*n,0),stroke:xt()(e.color,.75),fill:xt()(e.color,.25)}))),polygon:Object(o.memo)(({region:e,iw:t,ih:n,fullSegmentationMode:o})=>{const i=e.open?"polyline":"polygon";return a.a.createElement(i,{points:e.points.map(([e,o])=>[e*t,o*n]).map(e=>e.join(" ")).join(" "),strokeWidth:2,stroke:xt()(e.color,.75),fill:xt()(e.color,.25)})}),keypoints:({region:e,iw:t,ih:n,keypointDefinitions:o})=>{const i=e.points,r=e.keypointsDefinitionId;if(!o[r])throw new Error('No definition for keypoint configuration "'.concat(r,'"'));const s=o[r],c=s.landmarks,l=s.connections;return a.a.createElement("g",null,Object.entries(i).map(([e,{x:o,y:i}],r)=>a.a.createElement("g",{key:r,transform:"translate(".concat(o*t," ").concat(i*n,")")},a.a.createElement("path",{d:"M0 8L8 0L0 -8L-8 0Z",strokeWidth:2,stroke:c[e].color,fill:"transparent"}))),l.map(([e,o])=>{const r=i[e],s=i[o],l=(r.x+s.x)/2,d=(r.y+s.y)/2;return a.a.createElement("g",{key:"".concat(r.x,",").concat(r.y,".").concat(s.x,",").concat(s.y)},a.a.createElement("line",{x1:r.x*t,y1:r.y*n,x2:l*t,y2:d*n,strokeWidth:2,stroke:c[e].color}),a.a.createElement("line",{x1:s.x*t,y1:s.y*n,x2:l*t,y2:d*n,strokeWidth:2,stroke:c[o].color}))}))},"expanding-line":Object(o.memo)(({region:e,iw:t,ih:n})=>{let o=e.expandingWidth,i=void 0===o?.005:o,r=e.points;i=r.slice(-1)[0].width||i;const s=r.map(({x:e,y:t,angle:n,width:o},a)=>{if(!n){const e=r[wt(a+1,0,r.length-1)],t=r[wt(a-1,0,r.length-1)];n=Math.atan2(t.x-e.x,t.y-e.y)+Math.PI/2}const s=Math.sin(n)*(o||i)/2,c=Math.cos(n)*(o||i)/2;return[{x:e+s,y:t+c},{x:e-s,y:t-c}]}),c=s.map(([e,t])=>e),l=s.map(([e,t])=>t).asMutable();l.reverse();const d=r.slice(-1)[0];return a.a.createElement(a.a.Fragment,null,a.a.createElement("polygon",{points:c.concat(e.candidatePoint?[e.candidatePoint]:[]).concat(l).map(e=>"".concat(e.x*t," ").concat(e.y*n)).join(" "),strokeWidth:2,stroke:xt()(e.color,.75),fill:xt()(e.color,.25)}),r.map(({x:o,y:i,angle:r},s)=>a.a.createElement("g",{key:s,transform:"translate(".concat(o*t," ").concat(i*n,") rotate(").concat(180*-(r||0)/Math.PI,")")},a.a.createElement("g",null,a.a.createElement("rect",{x:-5,y:-5,width:10,height:10,strokeWidth:2,stroke:xt()(e.color,.75),fill:xt()(e.color,.25)})))),a.a.createElement("rect",{x:d.x*t-8,y:d.y*n-8,width:16,height:16,strokeWidth:4,stroke:xt()(e.color,.5),fill:"transparent"}))}),pixel:()=>null},jt=Object(o.memo)(({regions:e,keypointDefinitions:t,iw:n,ih:o,fullSegmentationMode:i})=>e.filter(e=>!1!==e.visible).map(e=>{const r=vt[e.type];return a.a.createElement(r,{key:e.regionId,region:e,iw:n,ih:o,keypointDefinitions:t,fullSegmentationMode:i})}),(e,t)=>e.regions===t.regions&&e.iw===t.iw&&e.ih===t.ih);var It=({mat:e,imagePosition:t,regions:n=[],keypointDefinitions:o,fullSegmentationMode:i})=>{const r=t.bottomRight.x-t.topLeft.x,s=t.bottomRight.y-t.topLeft.y;return isNaN(r)||isNaN(s)?null:a.a.createElement("svg",{width:r,height:s,style:{position:"absolute",zIndex:2,left:t.topLeft.x,top:t.topLeft.y,pointerEvents:"none",width:r,height:s}},a.a.createElement(jt,{key:"wrapped-region-list",regions:n,iw:r,ih:s,keypointDefinitions:o,fullSegmentationMode:i}))};const Tt=Object(s.a)(),Ct=Object(l.a)(e=>ve),Mt=(e=null,{iw:t,ih:n}={})=>{let o=xe.Matrix.from(1,0,0,1,-10,-10);return e&&t&&(o=o.translate(e.x*t,e.y*n).scaleU(e.w+.05)),o};var Nt=({regions:e,imageSrc:t,videoSrc:n,videoTime:i,realSize:r,showTags:s,onMouseMove:l=(e=>null),onMouseDown:d=(e=>null),onMouseUp:g=(e=>null),dragWithPrimary:m=!1,zoomWithPrimary:u=!1,createWithPrimary:p=!1,pointDistancePrecision:y=0,regionClsList:O,regionTagList:E,showCrosshairs:f,showHighlightBox:x=!0,showPointDistances:w,allowedArea:v,RegionEditLabel:j=null,videoPlaying:I=!1,showMask:T=!0,fullImageSegmentationMode:M,autoSegmentationOptions:N,onImageOrVideoLoaded:_,onChangeRegion:S,onBeginRegionEdit:k,onCloseRegionEdit:L,onBeginBoxTransform:R,onBeginMovePolygonPoint:D,onAddPolygonPoint:A,onBeginMoveKeypoint:P,onSelectRegion:W,onBeginMovePoint:B,onDeleteRegion:z,onChangeVideoTime:G,onChangeVideoPlaying:H,onRegionClassAdded:V,zoomOnAllowedArea:U=!0,modifyingAllowedArea:F=!1,keypointDefinitions:Y,allowComments:K})=>{const X=Ct(),Z=Object(o.useRef)(null),q=Object(o.useRef)({}),J=Object(Me.a)(!1),$=Object(b.a)(J,2),Q=$[0],ee=$[1],te=Object(Me.a)(0),ne=Object(b.a)(te,2),oe=(ne[0],ne[1],Object(Me.a)(null)),ae=Object(b.a)(oe,2),ie=ae[0],re=ae[1],se=Object(Me.a)(null),ce=Object(b.a)(se,2),le=ce[0],de=ce[1],ge=Object(Me.a)(Mt()),me=Object(b.a)(ge,2),he=me[0],ue=me[1],pe=(Object(o.useRef)({}),_e());(({getLatestMat:e,changeMat:t})=>{const n=ht().wasdMode;Object(o.useEffect)(()=>{if(!n)return;const o={w:[0,-10],a:[-10,0],s:[0,10],d:[10,0]},a={},i=Object.keys(o),r=e=>{i.includes(e.key)&&(a[e.key]=!0,e.preventDefault(),e.stopPropagation())},s=e=>{i.includes(e.key)&&(a[e.key]=!1,e.preventDefault(),e.stopPropagation())},c=setInterval(()=>{let n=e().clone(),i=!1;for(const e in a)a[e]&&(n=n.translate(...o[e]),i=!0);i&&t(n)},16);return window.addEventListener("keydown",r),window.addEventListener("keyup",s),()=>{clearInterval(c),window.removeEventListener("keydown",r),window.removeEventListener("keyup",s)}},[n])})({getLatestMat:Object(C.a)(()=>he),changeMat:ue});const be=Se({canvasEl:Z,dragging:Q,mat:he,layoutParams:q,changeMat:ue,zoomStart:ie,zoomEnd:le,changeZoomStart:re,changeZoomEnd:de,changeDragging:ee,zoomWithPrimary:u,dragWithPrimary:m,onMouseMove:l,onMouseDown:d,onMouseUp:g}),ye=be.mouseEvents,Oe=be.mousePosition;Object(o.useLayoutEffect)(()=>ue(he.clone()),[pe]);he.applyToPoint(Oe.current.x,Oe.current.y);const Ee=ke({layoutParams:q,mat:he}),fe=Object(o.useState)(),xe=Object(b.a)(fe,2),ve=xe[0],je=xe[1],Ie=Boolean(ve&&ve.naturalWidth),Te=Object(C.a)(({naturalWidth:e,naturalHeight:t,duration:n})=>{const o={naturalWidth:e,naturalHeight:t,duration:n};_&&_(o),je(o),setTimeout(()=>je(o),10)}),Ne=(()=>{const e=Object(o.useRef)(null);if(null===e.current){e.current={image:new Image,pattern:null};const t=document.createElement("canvas");t.width=100,t.height=100;const n=t.getContext("2d");e.current.image.onload=()=>{e.current.pattern=n.createPattern(e.current.image,"repeat")},e.current.image.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH4wMSAxY5oG+lzgAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAcSURBVAjXY/jPwPCfAQnA+TAGugLcAhhakRUAAK3lEe8m9qZhAAAAAElFTkSuQmCC"}return e.current.pattern})(),Le=Z.current;if(Le&&Ie){const e=Le.clientWidth,t=Le.clientHeight,n=Math.max(ve.naturalWidth/(e-20),ve.naturalHeight/(t-20)),o=ve.naturalWidth/n,a=ve.naturalHeight/n;q.current={iw:o,ih:a,fitScale:n,canvasWidth:e,canvasHeight:t}}Object(o.useEffect)(()=>{Ie&&ue(Mt(U?v:null,q.current))},[Ie]),Object(o.useLayoutEffect)(()=>{if(!ve)return;const e=Le.clientWidth,t=Le.clientHeight;Le.width=e,Le.height=t;const n=Le.getContext("2d");n.save(),n.transform(...he.clone().inverse().toArray());const o=q.current,a=o.iw,i=o.ih;if(v){const e=v.x,t=v.y,o=v.w,r=v.h;n.save(),n.globalAlpha=1;const s=[[0,0],[a,0],[a,i],[0,i]],c=[[e*a,t*i],[e*a+o*a,t*i],[e*a+o*a,t*i+r*i],[e*a,t*i+r*i]];n.moveTo(...s[0]),s.forEach(e=>n.lineTo(...e)),n.lineTo(...s[0]),n.closePath(),c.reverse(),n.moveTo(...c[0]),c.forEach(e=>n.lineTo(...e)),n.lineTo(...c[0]),n.fillStyle=Ne||"#f00",n.fill(),n.restore()}n.restore()});const Re=q.current,Ae=Re.iw,Pe=Re.ih;let We=ie&&le?Object(h.a)(Object(h.a)({},he.clone().inverse().applyToPoint(ie.x,ie.y)),{},{w:(le.x-ie.x)/he.a,h:(le.y-ie.y)/he.d}):null;We&&(We.w<0&&(We.x+=We.w,We.w*=-1),We.h<0&&(We.y+=We.h,We.h*=-1));const Be={topLeft:he.clone().inverse().applyToPoint(0,0),bottomRight:he.clone().inverse().applyToPoint(Ae,Pe)},ze=Object(o.useMemo)(()=>{const t=e.filter(e=>e.highlighted);return 1!==t.length?null:t[0]},[e]);return a.a.createElement(c.a,{theme:Tt},a.a.createElement("div",{style:{width:"100%",height:"100%",maxHeight:"calc(100vh - 68px)",position:"relative",overflow:"hidden",cursor:p?"crosshair":Q?"grabbing":m?"grab":u?he.a<1?"zoom-out":"zoom-in":void 0}},f&&a.a.createElement(we,{key:"crossHairs",mousePosition:Oe}),Ie&&!Q&&a.a.createElement(gt,{key:"regionSelectAndTransformBoxes",regions:F&&v?[{type:"box",id:"$$allowed_area",cls:"allowed_area",highlighted:!0,x:v.x,y:v.y,w:v.w,h:v.h,visible:!0,color:"#ff0"}]:e,mouseEvents:ye,projectRegionBox:Ee,dragWithPrimary:m,createWithPrimary:p,zoomWithPrimary:u,onBeginMovePoint:B,onSelectRegion:W,layoutParams:q,mat:he,onBeginBoxTransform:R,onBeginMovePolygonPoint:D,onBeginMoveKeypoint:P,onAddPolygonPoint:A,showHighlightBox:x}),Ie&&s&&!Q&&a.a.createElement(Ce,{key:"regionTags"},a.a.createElement(Je,{regions:e,projectRegionBox:Ee,mouseEvents:ye,regionClsList:O,regionTagList:E,onBeginRegionEdit:k,onChangeRegion:S,onCloseRegionEdit:L,onDeleteRegion:z,layoutParams:q,imageSrc:t,RegionEditLabel:j,onRegionClassAdded:V,allowComments:K})),!s&&ze&&a.a.createElement("div",{key:"topLeftTag",className:X.fixedRegionLabel},a.a.createElement(Xe,{disableClose:!0,allowedClasses:O,allowedTags:E,onChange:S,onDelete:z,editing:!0,region:ze,imageSrc:t,allowComments:K})),u&&null!==We&&a.a.createElement("div",{key:"zoomBox",style:{position:"absolute",zIndex:1,border:"1px solid #fff",pointerEvents:"none",left:We.x,top:We.y,width:We.w,height:We.h}}),w&&a.a.createElement(De,{key:"pointDistances",regions:e,realSize:r,projectRegionBox:Ee,pointDistancePrecision:y}),a.a.createElement(Ce,Object.assign({style:{width:"100%",height:"100%"}},ye),a.a.createElement(a.a.Fragment,null,M&&a.a.createElement(nt,{hide:!T,autoSegmentationOptions:N,imagePosition:Be,regionClsList:O,imageSrc:t,regions:e}),a.a.createElement("canvas",{style:{opacity:.25},className:X.canvas,ref:Z}),a.a.createElement(It,{mat:he,keypointDefinitions:Y,imagePosition:Be,regions:e,fullSegmentationMode:M}),a.a.createElement(Et,{videoPlaying:I,imagePosition:Be,mouseEvents:ye,onLoad:Te,videoTime:i,videoSrc:n,imageSrc:t,useCrossOrigin:M,onChangeVideoTime:G,onChangeVideoPlaying:H}))),a.a.createElement("div",{className:X.zoomIndicator},(1/he.a*100).toFixed(0),"%")))},_t=n(413),St=n.n(_t);const kt=Object(s.a)(),Lt=Object(l.a)(e=>({img:{width:40,height:40,borderRadius:8}})),Rt=e=>[e.name,(e.regions||[]).length,e.src];Object(o.memo)(({images:e,onSelect:t})=>{const n=Lt();return a.a.createElement(c.a,{theme:kt},a.a.createElement(S,{title:"Images",subTitle:"(".concat(e.length,")"),icon:a.a.createElement(St.a,{style:{color:j.a[700]}})},a.a.createElement("div",null,a.a.createElement(re.a,null,e.map((e,o)=>a.a.createElement(se.a,{button:!0,onClick:()=>t(e),dense:!0,key:o},a.a.createElement("img",{className:n.img,src:e.src}),a.a.createElement(ce.a,{primary:e.name,secondary:"".concat((e.regions||[]).length," Labels")})))))))},(e,t)=>be()(e.images.map(Rt),t.images.map(Rt)));var Dt=n(91),At=n(259),Pt=n.n(At),Wt=n(414);var Bt=(e,t=1)=>{if(e<1e3)return e+"ms";{const n=e/1e3;if(n<60)return Number.isInteger(n)?n+"s":n.toFixed(t)+"s";{const e=n/60;return Number.isInteger(e)?e+"m":e.toFixed(t)+"m"}}};const zt=Object(s.a)(),Gt=Object(w.a)("div")(({theme:e})=>({position:"relative",display:"flex",flexGrow:1,minWidth:240,height:64,marginLeft:16,marginRight:16})),Ht=Object(w.a)("div")(({theme:e})=>({position:"absolute",width:2,marginLeft:-1,height:"100%",backgroundColor:j.a[300],bottom:0})),Vt=Object(w.a)("div")(({theme:e})=>({position:"absolute",userSelect:"none",fontSize:10,color:j.a[600],fontWeight:"bold",bottom:0})),Ut=Object(w.a)("div")(({theme:e})=>({position:"absolute",bottom:"calc(50% + 6px)",fontSize:10,fontWeight:"bold",color:"#fff",display:"grid",placeItems:"center",width:48,marginLeft:-24,borderRadius:2,height:24,backgroundColor:L.a[500],userSelect:"none",fontVariantNumeric:"tabular-nums","&::before":{position:"absolute",bottom:-6,left:16,content:'""',width:0,height:0,borderTop:"8px solid ".concat(L.a[500]),borderLeft:"8px solid transparent",borderRight:"8px solid transparent"}})),Ft=Object(w.a)("div")(({theme:e})=>({position:"absolute",bottom:8,cursor:"pointer",opacity:.75,fontSize:10,fontWeight:"bold",color:"#fff",display:"grid",placeItems:"center",width:16,marginLeft:0,borderTopLeftRadius:2,borderTopRightRadius:2,height:12,marginLeft:-8,backgroundColor:k.a[500],userSelect:"none",fontVariantNumeric:"tabular-nums","&::before":{position:"absolute",bottom:-8,left:0,content:'""',width:0,height:0,borderTop:"8px solid ".concat(k.a[500]),borderLeft:"8px solid transparent",borderRight:"8px solid transparent"}})),Yt=6e4,Kt=[[50,250],[100,500],[250,1e3],[1e3,5e3],[5e3,3e4],[1e4,Yt],[3e4,2*Yt],[Yt,5*Yt],[5*Yt,30*Yt],[10*Yt,60*Yt],[30*Yt,60*Yt*3],[60*Yt,60*Yt*5]];var Xt=({currentTime:e=0,duration:t,onChangeCurrentTime:n,keyframes:i})=>{const r=Object(Wt.a)(),s=Object(b.a)(r,2),l=s[0],d=s[1],g=Object(o.useState)(e),m=Object(b.a)(g,2),h=m[0],u=m[1],p=Object(Me.a)(!1),y=Object(b.a)(p,2),O=y[0],E=y[1],f=Object.keys(i||{}).map(e=>parseInt(e)).filter(e=>!isNaN(e)).sort((e,t)=>e-t);Object(o.useEffect)(()=>{e!==h&&u(e)},[e]);const x=Object(o.useMemo)(()=>(e=>{var t,n=Object(Dt.a)(Kt);try{for(n.s();!(t=n.n()).done;){const n=Object(b.a)(t.value,2),o=n[0],a=n[1];if(e/a<6&&e/a>2)return[o,a]}}catch(o){n.e(o)}finally{n.f()}return[e/4,e]})(t),[t]),w=Object(b.a)(x,2),v=w[0],j=w[1],I=Object(C.a)(e=>{if(O){const n=(e.clientX-d.left)/d.width;u(Math.min(t,Math.max(0,Math.floor(n*t))))}}),T=Object(C.a)(e=>{E(!1);const o=(e.clientX-d.left)/d.width,a=Math.min(t,Math.max(0,Math.floor(o*t)));u(a),n(a)});return t?a.a.createElement(c.a,{theme:zt},a.a.createElement(Gt,{onMouseMove:I,onMouseUp:T,ref:l},Pt()(0,t,j).map(e=>a.a.createElement(a.a.Fragment,null,a.a.createElement(Ht,{key:e,style:{left:e/t*d.width,height:"50%"}}),a.a.createElement(Vt,{style:{left:e/t*d.width+8,bottom:"calc(50% - 12px)"}},Bt(e)))),Pt()(0,t,v).filter(e=>!Number.isInteger(e/j)).map(e=>a.a.createElement(Ht,{key:e,style:{left:e/t*d.width,height:"25%"}})),f.map(e=>a.a.createElement(Ft,{onClick:()=>n(e),key:e,style:{left:e/t*d.width}})),a.a.createElement(Ut,{onMouseDown:e=>E(!0),style:{cursor:O?"grabbing":"grab",left:h/t*d.width}},Bt(h)))):null},Zt=n(415),qt=n.n(Zt);const Jt=Object(s.a)(),$t=Object(w.a)("div")(({theme:e})=>({cursor:"pointer",display:"flex",alignItems:"center",padding:8,fontSize:14,color:j.a[700],"&.current":{backgroundColor:L.a[100]},"&:hover":{backgroundColor:j.a[100]},"& .time":{flexGrow:1,fontWeight:"bold","& .regionCount":{marginLeft:8,fontWeight:"normal",color:j.a[500]}},"& .trash":{"& .icon":{fontSize:18,color:j.a[600],transition:"transform 80ms","&:hover":{color:j.a[800],transform:"scale(1.25,1.25)"}}}}));var Qt=({currentVideoTime:e,keyframes:t,onChangeVideoTime:n,onDeleteKeyframe:o})=>{const i=Object.keys(t).map(e=>parseInt(e));return a.a.createElement(c.a,{theme:Jt},a.a.createElement(S,{title:"Keyframes",subTitle:"",icon:a.a.createElement(qt.a,{style:{color:j.a[700]}}),expandedByDefault:!0},i.map(i=>{var r;return a.a.createElement($t,{fullWidth:!0,key:i,className:e===i?"current":"",onClick:()=>n(i)},a.a.createElement("div",{className:"time"},Bt(i,2),a.a.createElement("span",{className:"regionCount"},"(",((null===(r=t[i])||void 0===r?void 0:r.regions)||[]).length,")")),a.a.createElement("div",{className:"trash"},a.a.createElement(ze.a,{onClick:e=>{o(i),e.stopPropagation()},className:"icon"})))})))},en=n(420),tn=n.n(en),nn=n(722),on=n(416),an=n.n(on),rn=n(417),sn=n.n(rn),cn=n(418),ln=n.n(cn),dn=n(261),gn=n.n(dn),mn=n(419),hn=n.n(mn),un={container:{fontSize:11,fontWeight:"bold",color:j.a[700],"& .icon":{marginTop:4,width:16,height:16},"& .icon2":{opacity:.5,width:16,height:16,transition:"200ms opacity","&:hover":{cursor:"pointer",opacity:1}}},row:{padding:4,cursor:"pointer","&.header:hover":{backgroundColor:"#fff"},"&.highlighted":{backgroundColor:L.a[100]},"&:hover":{backgroundColor:L.a[50],color:j.a[800]}},chip:{display:"flex",flexDirection:"row",padding:2,borderRadius:2,paddingLeft:4,paddingRight:4,alignItems:"center","& .color":{borderRadius:5,width:10,height:10,marginRight:4},"& .text":{}}};const pn=Object(s.a)(),bn=Object(l.a)(e=>un),yn=Object(w.a)("div")(({theme:e})=>({borderTop:"1px solid ".concat(j.a[200]),marginTop:2,marginBottom:2})),On=({color:e,text:t})=>{const n=bn();return a.a.createElement("span",{className:n.chip},a.a.createElement("div",{className:"color",style:{backgroundColor:e}}),a.a.createElement("div",{className:"text"},t))},En=({header:e,highlighted:t,order:n,classification:i,area:r,tags:s,trash:c,lock:l,visible:d,onClick:g})=>{const m=bn(),h=Object(o.useState)(!1),u=Object(b.a)(h,2),p=(u[0],u[1]);return a.a.createElement("div",{onClick:g,onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),className:T()(m.row,{header:e,highlighted:t})},a.a.createElement(nn.a,{container:!0,alignItems:"center"},a.a.createElement(nn.a,{item:!0,xs:2},a.a.createElement("div",{style:{textAlign:"right",paddingRight:10}},n)),a.a.createElement(nn.a,{item:!0,xs:5},i),a.a.createElement(nn.a,{item:!0,xs:2},a.a.createElement("div",{style:{textAlign:"right",paddingRight:6}},r)),a.a.createElement(nn.a,{item:!0,xs:1},c),a.a.createElement(nn.a,{item:!0,xs:1},l),a.a.createElement(nn.a,{item:!0,xs:1},d)))},fn=Object(o.memo)(()=>a.a.createElement(En,{header:!0,highlighted:!1,order:a.a.createElement(an.a,{className:"icon"}),classification:a.a.createElement("div",{style:{paddingLeft:10}},"Class"),area:a.a.createElement(sn.a,{className:"icon"}),trash:a.a.createElement(ze.a,{className:"icon"}),lock:a.a.createElement(qe.a,{className:"icon"}),visible:a.a.createElement(gn.a,{className:"icon"})})),xn=Object(o.memo)(({region:e,highlighted:t,onSelectRegion:n,onDeleteRegion:o,onChangeRegion:i,visible:r,locked:s,color:c,cls:l,index:d})=>a.a.createElement(En,{header:!1,highlighted:t,onClick:()=>n(e),order:"#".concat(d+1),classification:a.a.createElement(On,{text:l||"",color:c||"#ddd"}),area:"",trash:a.a.createElement(ze.a,{onClick:()=>o(e),className:"icon2"}),lock:e.locked?a.a.createElement(qe.a,{onClick:()=>i(Object(h.a)(Object(h.a)({},e),{},{locked:!1})),className:"icon2"}):a.a.createElement(ln.a,{onClick:()=>i(Object(h.a)(Object(h.a)({},e),{},{locked:!0})),className:"icon2"}),visible:e.visible||void 0===e.visible?a.a.createElement(gn.a,{onClick:()=>i(Object(h.a)(Object(h.a)({},e),{},{visible:!1})),className:"icon2"}):a.a.createElement(hn.a,{onClick:()=>i(Object(h.a)(Object(h.a)({},e),{},{visible:!0})),className:"icon2"})}),(e,t)=>e.highlighted===t.highlighted&&e.visible===t.visible&&e.locked===t.locked&&e.id===t.id&&e.index===t.index&&e.cls===t.cls&&e.color===t.color),wn=[],vn=e=>[e.id,e.color,e.locked,e.visible,e.highlighted];var jn=Object(o.memo)(({regions:e=wn,onDeleteRegion:t,onChangeRegion:n,onSelectRegion:o})=>{const i=bn();return a.a.createElement(c.a,{theme:pn},a.a.createElement(S,{title:"Regions",subTitle:"",icon:a.a.createElement(tn.a,{style:{color:j.a[700]}}),expandedByDefault:!0},a.a.createElement("div",{className:i.container},a.a.createElement(fn,null),a.a.createElement(yn,null),e.map((e,i)=>a.a.createElement(xn,Object.assign({key:e.id},e,{region:e,index:i,onSelectRegion:o,onDeleteRegion:t,onChangeRegion:n}))))))},(e,t)=>be()((e.regions||wn).map(vn),(t.regions||wn).map(vn))),In=n(729),Tn=n(715),Cn=n(730),Mn=n(731),Nn=n(421),_n=n.n(Nn);var Sn=({open:e,onClose:t})=>{const n=ht();return a.a.createElement(In.a,{open:e||!1,onClose:t},a.a.createElement(Tn.a,null,"Settings"),a.a.createElement(Cn.a,{style:{minWidth:400}},a.a.createElement(_n.a,{variant:"flat",noActions:!0,defaultAnswers:n,onQuestionChange:(e,t,o)=>n.changeSetting(e,t),form:{questions:[{type:"boolean",title:"Show Crosshairs",name:"showCrosshairs"},{type:"boolean",title:"Show Highlight Box",name:"showHighlightBox"},{type:"boolean",title:"WASD Mode",name:"wasdMode"},{type:"dropdown",title:"Video Playback Speed",name:"videoPlaybackSpeed",defaultValue:"1x",choices:["0.25x","0.5x","1x","2x"]}]}})),a.a.createElement(Mn.a,null,a.a.createElement(We.a,{onClick:t},"Close")))},kn=n(426),Ln=n.n(kn);const Rn=[],Dn=()=>null;var An=Object(o.memo)(({currentImage:e,imageClsList:t=Rn,imageTagList:n=Rn,onChangeImage:i=Dn})=>{const r=e||{},s=r.tags,c=void 0===s?[]:s,l=r.cls,d=void 0===l?null:l,g=Object(C.a)(e=>i({cls:e.value})),m=Object(C.a)(e=>i({tags:e.map(e=>e.value)})),h=Object(o.useMemo)(()=>d?{value:d,label:d}:null,[d]),u=Object(o.useMemo)(()=>Object(O.asMutable)(t.map(e=>({value:e,label:e}))),[t]),p=Object(o.useMemo)(()=>Object(O.asMutable)(n.map(e=>({value:e,label:e}))),[n]),b=Object(o.useMemo)(()=>c.map(e=>({value:e,label:e})),[c]);return e?a.a.createElement(S,{title:"Image Tags",expandedByDefault:!0,noScroll:!0,icon:a.a.createElement(Ln.a,{style:{color:j.a[700]}})},t.length>0&&a.a.createElement("div",{style:{padding:8}},a.a.createElement(Ue.default,{placeholder:"Image Classification",onChange:g,value:h,options:u})),n.length>0&&a.a.createElement("div",{style:{padding:8,paddingTop:0}},a.a.createElement(Ue.default,{isMulti:!0,placeholder:"Image Tags",onChange:m,value:b,options:p}))):null},(e,t)=>e.currentImage.cls===t.currentImage.cls&&e.currentImage.tags===t.currentImage.tags&&e.imageClsList===t.imageClsList&&e.imageTagList===t.imageTagList),Pn=n(428),Wn=n.n(Pn),Bn=n(427),zn=n.n(Bn);const Gn=Object(s.a)(),Hn=Object(w.a)("div")(({theme:e})=>({paddingLeft:16,paddingRight:16,fontSize:12,"& h1":{fontSize:18},"& h2":{fontSize:14},"& h3":{fontSize:12},"& h4":{fontSize:12},"& h5":{fontSize:12},"& h6":{fontSize:12},"& p":{fontSize:12},"& a":{},"& img":{width:"100%"}}));var Vn=Object(o.memo)(({description:e})=>a.a.createElement(c.a,{theme:Gn},a.a.createElement(S,{title:"Task Description",icon:a.a.createElement(Wn.a,{style:{color:j.a[700]}}),expandedByDefault:!e||""===e},a.a.createElement(Hn,null,a.a.createElement(zn.a,{source:e}))))),Un=n(435),Fn=e=>{let t,n,o=null;return"image"===e.annotationType?(o=e.selectedImage,-1===o?(o=null,n=null):(t=["images",o],n=Object(O.getIn)(e,t))):"video"===e.annotationType&&(t=["keyframes",e.currentVideoTime||0],n=Object(O.getIn)(e,t)||null),{currentImageIndex:o,pathToActiveImage:t,activeImage:n}},Yn=n(139);var Kn=e=>{var t,n,o;const a=null===(t=Object(Yn.getApplicationKeyMap)()[e])||void 0===t||null===(n=t.sequences)||void 0===n||null===(o=n[0])||void 0===o?void 0:o.sequence;return a?" (".concat(a,")"):""},Xn=n(63),Zn=n(64),qn=n(210),Jn=n.n(qn),$n=n(433);const Qn={marginTop:4,width:16,height:16,marginBottom:4};var eo={select:()=>a.a.createElement(Xn.a,{style:Qn,size:"xs",fixedWidth:!0,icon:Zn.h}),pan:()=>a.a.createElement(Xn.a,{style:Qn,size:"xs",fixedWidth:!0,icon:Zn.f}),zoom:()=>a.a.createElement(Xn.a,{style:Qn,size:"xs",fixedWidth:!0,icon:Zn.i}),"show-tags":()=>a.a.createElement(Xn.a,{style:Qn,size:"xs",fixedWidth:!0,icon:Zn.j}),"create-point":()=>a.a.createElement(Xn.a,{style:Qn,size:"xs",fixedWidth:!0,icon:Zn.b}),"create-box":()=>a.a.createElement(Xn.a,{style:Qn,size:"xs",fixedWidth:!0,icon:Zn.k}),"create-polygon":()=>a.a.createElement(Xn.a,{style:Qn,size:"xs",fixedWidth:!0,icon:Zn.c}),"create-expanding-line":()=>a.a.createElement(Xn.a,{style:Qn,size:"xs",fixedWidth:!0,icon:Zn.e}),"create-line":()=>a.a.createElement(Xn.a,{style:Qn,size:"xs",fixedWidth:!0,icon:Zn.a}),"show-mask":()=>a.a.createElement(Xn.a,{style:Qn,size:"xs",fixedWidth:!0,icon:Zn.g}),"modify-allowed-area":()=>a.a.createElement(Xn.a,{style:Qn,size:"xs",fixedWidth:!0,icon:Zn.d}),"create-keypoints":n.n($n).a,window:Jn.a},to={container:{display:"flex",flexGrow:1,flexDirection:"column",height:"100%",maxHeight:"100vh",backgroundColor:"#fff",overflow:"hidden","&.fullscreen":{position:"absolute",zIndex:99999,left:0,right:0,top:0,bottom:0}},headerTitle:{fontWeight:"bold",color:j.a[700],paddingLeft:16}};const no={};for(var oo=0,ao=[{id:"select_tool",description:"Switch to the Select Tool",binding:"escape"},{id:"zoom_tool",description:"Select the Zoom Tool",binding:"z"},{id:"create_point",description:"Create a point"},{id:"create_bounding_box",description:"Create a bounding box",binding:"b"},{id:"pan_tool",description:"Select the Pan Tool",binding:"m"},{id:"create_polygon",description:"Create a Polygon",binding:"p"},{id:"create_pixel",description:"Create a Pixel Mask"},{id:"save_and_previous_sample",description:"Save and go to previous sample",binding:"ArrowLeft"},{id:"save_and_next_sample",description:"Save and go to next sample",binding:"ArrowRight"},{id:"save_and_exit_sample",description:"Save and exit current sample"},{id:"exit_sample",description:"Exit sample without saving"},{id:"delete_region",description:"Delete selected region",binding:"d"},{id:"undo",description:"Undo latest change",binding:"Ctrl+z"}];oo<ao.length;oo++){const e=ao[oo],t=e.id,n=e.binding;no[t]=n}const io=({dispatch:e})=>Object(o.useMemo)(()=>({select_tool:()=>{e({type:"SELECT_TOOL",selectedTool:"select"})},zoom_tool:()=>{e({type:"SELECT_TOOL",selectedTool:"zoom"})},create_point:()=>{e({type:"SELECT_TOOL",selectedTool:"create-point"})},create_bounding_box:()=>{e({type:"SELECT_TOOL",selectedTool:"create-box"})},pan_tool:()=>{e({type:"SELECT_TOOL",selectedTool:"pan"})},create_polygon:()=>{e({type:"SELECT_TOOL",selectedTool:"create-polygon"})},create_pixel:()=>{e({type:"SELECT_TOOL",selectedTool:"create-pixel"})},save_and_previous_sample:()=>{e({type:"HEADER_BUTTON_CLICKED",buttonName:"Prev"})},save_and_next_sample:()=>{e({type:"HEADER_BUTTON_CLICKED",buttonName:"Next"})},save_and_exit_sample:()=>{e({type:"HEADER_BUTTON_CLICKED",buttonName:"Save"})},delete_region:()=>{e({type:"DELETE_SELECTED_REGION"})},undo:()=>{e({type:"RESTORE_HISTORY"})}}),[e]);const ro=[];var so=(e,t)=>{if(e[t||0])return e[t||0].regions;const n=Object.keys(e).map(e=>parseInt(e)).filter(e=>!isNaN(e));if(0===n.length)return ro;n.sort((e,t)=>e-t);let o=n.findIndex(e=>e>=t);if(-1===o)return e[n[n.length-1]].regions||ro;if(0===o)return ro;const a=n[o-1],i=e[a],r=n[o],s=e[r],c={},l={};var d,g=Object(Dt.a)(i.regions);try{for(g.s();!(d=g.n()).done;){const e=d.value;c[e.id]=e}}catch(x){g.e(x)}finally{g.f()}var m,u=Object(Dt.a)(s.regions);try{for(u.s();!(m=u.n()).done;){const e=m.value;l[e.id]=e}}catch(x){u.e(x)}finally{u.f()}const p=[],y=(r-t)/(r-a),O=1-y;for(const w in c){const e=[c[w],l[w]],t=e[0],n=e[1];if(n)switch(t.type){case"point":p.push(Object(h.a)(Object(h.a)({},t),{},{highlighted:!1,editingLabels:!1,x:t.x*y+n.x*O,y:t.y*y+n.y*O}));break;case"box":p.push(Object(h.a)(Object(h.a)({},t),{},{highlighted:!1,editingLabels:!1,x:t.x*y+n.x*O,y:t.y*y+n.y*O,w:t.w*y+n.w*O,h:t.h*y+n.h*O}));break;case"polygon":n.points.length===t.points.length?p.push(Object(h.a)(Object(h.a)({},t),{},{highlighted:!1,editingLabels:!1,points:t.points.map((e,t)=>[e[0]*y+n.points[t][0]*O,e[1]*y+n.points[t][1]*O])})):p.push(t);break;case"keypoints":{const e={};for(var E=0,f=Object.entries(t.points);E<f.length;E++){const t=Object(b.a)(f[E],2),o=t[0],a=t[1];e[o]={x:a.x*y+n.points[o].x*O,y:a.y*y+n.points[o].y*O}}p.push(Object(h.a)(Object(h.a)({},t),{},{highlighted:!1,editingLabels:!1,points:e}));break}}else p.push(Object(h.a)(Object(h.a)({},t),{},{highlighted:!1,editingLabels:!1}))}return p};const co=[];var lo=n(434),go=n.n(lo);const mo=[],ho=Object(s.a)(),uo=Object(l.a)(e=>to),po=Object(Yn.withHotKeys)(e=>{let t=e.hotKeys,n=e.children,o=e.divRef,i=Object(f.a)(e,["hotKeys","children","divRef"]);return a.a.createElement("div",Object.assign({},Object(h.a)(Object(h.a)({},t),i),{ref:o}),n)}),bo=Object(w.a)("div")(({theme:e})=>({width:"100%",height:"100%","& .fullscreen":{width:"100%",height:"100%"}}));var yo=({state:e,dispatch:t,alwaysShowNextButton:n=!1,alwaysShowPrevButton:i=!1,RegionEditLabel:r,onRegionClassAdded:s,hideHeader:l,hideHeaderText:d,hideNext:g=!1,hidePrev:m=!1,hideClone:u=!1,hideSettings:p=!1,hideFullScreen:b=!1,hideSave:y=!1})=>{const O=uo(),E=ht(),f=Object(x.b)(),w=Object(o.useRef)({}),v=(e,...n)=>{const o="".concat(e,"(").concat(n.join(","),")");if(w.current[o])return w.current[o];const a=(...o)=>n.length>0?t(Object(h.a)({type:e},n.reduce((e,t,n)=>(e[t]=o[n],e),{}))):t(Object(h.a)({type:e},o[0]));return w.current[o]=a,a},j=Fn(e),I=j.currentImageIndex,M=j.activeImage;let N;null!==I&&(N=e.images[I+1]),go()(()=>t({type:"CANCEL"}),{detectKeys:[27]});M&&M.frameTime;const _=Object(o.useRef)(),S=io({dispatch:t});let k=(e=>{if("video"!==e.annotationType)return co;const t=e.keyframes,n=e.currentVideoTime,a=void 0===n?0:n;return Object(o.useMemo)(()=>so(t,a),[t,a])})(e);const L=Object(o.useCallback)(e=>{_.current&&(_.current.contains(document.activeElement)||_.current.contains(e.target)&&(_.current.focus(),e.target.focus()))},[]),R=a.a.createElement(Nt,Object.assign({},E,{showCrosshairs:E.showCrosshairs&&!["select","pan","zoom"].includes(e.selectedTool),key:e.selectedImage,showMask:e.showMask,fullImageSegmentationMode:e.fullImageSegmentationMode,autoSegmentationOptions:e.autoSegmentationOptions,showTags:e.showTags,allowedArea:e.allowedArea,modifyingAllowedArea:"modify-allowed-area"===e.selectedTool,regionClsList:e.regionClsList,regionTagList:e.regionTagList,regions:"image"===e.annotationType?M.regions||[]:k,realSize:M?M.realSize:void 0,videoPlaying:e.videoPlaying,imageSrc:"image"===e.annotationType?M.src:null,videoSrc:"video"===e.annotationType?e.videoSrc:null,pointDistancePrecision:e.pointDistancePrecision,createWithPrimary:e.selectedTool.includes("create"),dragWithPrimary:"pan"===e.selectedTool,zoomWithPrimary:"zoom"===e.selectedTool,showPointDistances:e.showPointDistances,videoTime:"image"===e.annotationType?e.selectedImageFrameTime:e.currentVideoTime,keypointDefinitions:e.keypointDefinitions,onMouseMove:v("MOUSE_MOVE"),onMouseDown:v("MOUSE_DOWN"),onMouseUp:v("MOUSE_UP"),onChangeRegion:v("CHANGE_REGION","region"),onBeginRegionEdit:v("OPEN_REGION_EDITOR","region"),onCloseRegionEdit:v("CLOSE_REGION_EDITOR","region"),onDeleteRegion:v("DELETE_REGION","region"),onBeginBoxTransform:v("BEGIN_BOX_TRANSFORM","box","directions"),onBeginMovePolygonPoint:v("BEGIN_MOVE_POLYGON_POINT","polygon","pointIndex"),onBeginMoveKeypoint:v("BEGIN_MOVE_KEYPOINT","region","keypointId"),onAddPolygonPoint:v("ADD_POLYGON_POINT","polygon","point","pointIndex"),onSelectRegion:v("SELECT_REGION","region"),onBeginMovePoint:v("BEGIN_MOVE_POINT","point"),onImageLoaded:v("IMAGE_LOADED","image"),RegionEditLabel:r,onImageOrVideoLoaded:v("IMAGE_OR_VIDEO_LOADED","metadata"),onChangeVideoTime:v("CHANGE_VIDEO_TIME","newTime"),onChangeVideoPlaying:v("CHANGE_VIDEO_PLAYING","isPlaying"),onRegionClassAdded:s,allowComments:e.allowComments})),D=Object(C.a)(e=>{t({type:"SELECT_TOOL",selectedTool:e.name})}),A=Object(C.a)(e=>{"Fullscreen"===e.name?f.enter():"Window"===e.name&&f.exit(),t({type:"HEADER_BUTTON_CLICKED",buttonName:e.name})}),P=Boolean(window.localStorage.$ANNOTATE_DEBUG_MODE&&e),W=!N||N.regions&&N.regions.length>0;return a.a.createElement(c.a,{theme:ho},a.a.createElement(bo,null,a.a.createElement(x.a,{handle:f,onChange:e=>{e||(f.exit(),v("HEADER_BUTTON_CLICKED","buttonName")("Window"))}},a.a.createElement(po,{tabIndex:-1,divRef:_,onMouseDown:L,onMouseOver:L,allowChanges:!0,handlers:S,className:T()(O.container,e.fullScreen&&"Fullscreen")},a.a.createElement(Un.a,{allowFullscreen:!0,iconDictionary:eo,hideHeader:l,hideHeaderText:d,headerLeftSide:["video"===e.annotationType?a.a.createElement(Xt,{currentTime:e.currentVideoTime,duration:e.videoDuration,onChangeCurrentTime:v("CHANGE_VIDEO_TIME","newTime"),keyframes:e.keyframes}):M?a.a.createElement("div",{className:O.headerTitle},M.name):null].filter(Boolean),headerItems:[!m&&{name:"Prev"},!g&&{name:"Next"},"video"!==e.annotationType?null:e.videoPlaying?{name:"Pause"}:{name:"Play"},!u&&!W&&M.regions&&{name:"Clone"},!p&&{name:"Settings"},!b&&(e.fullScreen?{name:"Window"}:{name:"Fullscreen"}),!y&&{name:"Save"}].filter(Boolean),onClickHeaderItem:A,onClickIconSidebarItem:D,selectedTools:[e.selectedTool,e.showTags&&"show-tags",e.showMask&&"show-mask"].filter(Boolean),iconSidebarItems:[{name:"select",helperText:"Select"+Kn("select_tool"),alwaysShowing:!0},{name:"pan",helperText:"Drag/Pan (right or middle click)"+Kn("pan_tool"),alwaysShowing:!0},{name:"zoom",helperText:"Zoom In/Out (scroll)"+Kn("zoom_tool"),alwaysShowing:!0},{name:"show-tags",helperText:"Show / Hide Tags",alwaysShowing:!0},{name:"create-point",helperText:"Add Point"+Kn("create_point")},{name:"create-box",helperText:"Add Bounding Box"+Kn("create_bounding_box")},{name:"create-polygon",helperText:"Add Polygon"+Kn("create_polygon")},{name:"create-line",helperText:"Add Line"},{name:"create-expanding-line",helperText:"Add Expanding Line"},{name:"create-keypoints",helperText:"Add Keypoints (Pose)"},e.fullImageSegmentationMode&&{name:"show-mask",alwaysShowing:!0,helperText:"Show / Hide Mask"},{name:"modify-allowed-area",helperText:"Modify Allowed Area"}].filter(Boolean).filter(t=>t.alwaysShowing||e.enabledTools.includes(t.name)),rightSidebarItems:[P&&a.a.createElement(oe,{state:P,lastAction:e.lastAction}),e.taskDescription&&a.a.createElement(Vn,{description:e.taskDescription}),e.regionClsList&&a.a.createElement(ne,{selectedCls:e.selectedCls,regionClsList:e.regionClsList,onSelectCls:v("SELECT_CLASSIFICATION","cls")}),e.labelImages&&a.a.createElement(An,{currentImage:M,imageClsList:e.imageClsList,imageTagList:e.imageTagList,onChangeImage:v("CHANGE_IMAGE","delta"),expandedByDefault:!0}),a.a.createElement(jn,{regions:M?M.regions:mo,onSelectRegion:v("SELECT_REGION","region"),onDeleteRegion:v("DELETE_REGION","region"),onChangeRegion:v("CHANGE_REGION","region")}),e.keyframes&&a.a.createElement(Qt,{onChangeVideoTime:v("CHANGE_VIDEO_TIME","newTime"),onDeleteKeyframe:v("DELETE_KEYFRAME","time"),onChangeCurrentTime:v("CHANGE_VIDEO_TIME","newTime"),currentTime:e.currentVideoTime,duration:e.videoDuration,keyframes:e.keyframes}),a.a.createElement(fe,{history:e.history,onRestoreHistory:v("RESTORE_HISTORY")})].filter(Boolean)},R),a.a.createElement(Sn,{open:e.settingsOpen,onClose:()=>t({type:"HEADER_BUTTON_CLICKED",buttonName:"Settings"})})))))};const Oo={BEGIN_BOX_TRANSFORM:"Transform/Move Box",BEGIN_MOVE_POINT:"Move Point",DELETE_REGION:"Delete Region"},Eo=(e,t)=>Object(O.updateIn)(e,["history"],n=>[{time:ue()().toDate(),state:Object(O.without)(e,"history"),name:t}].concat((n||[]).slice(0,9)));function fo(e,t,n){return e<=t?t:e>=n?n:e}var xo=e=>{const t=e.expandingWidth||.005,n=e.points.map(({x:n,y:o,angle:a,width:i},r)=>{if(!a){const t=e.points[fo(r+1,0,e.points.length-1)],n=e.points[fo(r-1,0,e.points.length-1)];a=Math.atan2(n.x-t.x,n.y-t.y)+Math.PI/2}const s=Math.sin(a)*(i||t)/2,c=Math.cos(a)*(i||t)/2;return[{x:n+s,y:o+c},{x:n-s,y:o-c}]}),o=n.map(([e,t])=>e),a=n.map(([e,t])=>t).asMutable();a.reverse();const i=o.concat(a).map(({x:e,y:t})=>[e,t]);return Object(h.a)(Object(h.a)({},e),{},{type:"polygon",open:!1,points:i,unfinished:void 0,candidatePoint:void 0})},wo=n(265),vo=n.n(wo),jo=({center:e,scale:t,landmarks:n})=>{const o={};var a,i=Object(Dt.a)(Object.entries(n));try{for(i.s();!(a=i.n()).done;){const n=Object(b.a)(a.value,2),i=n[0],r=n[1].defaultPosition;o[i]={x:r[0]*t+e.x,y:r[1]*t+e.y}}}catch(r){i.e(r)}finally{i.f()}return o};const Io=()=>Math.random().toString().split(".")[1];var To=(e,t)=>{if(e.allowedArea&&"modify-allowed-area"!==e.selectedTool&&["MOUSE_DOWN","MOUSE_UP","MOUSE_MOVE"].includes(t.type)){const n=e.allowedArea;t.x=vo()(t.x,n.x,n.x+n.w),t.y=vo()(t.y,n.y,n.y+n.h)}if("ON_CLS_ADDED"===t.type&&t.cls&&""!==t.cls){const n=e.regionClsList;return Object(h.a)(Object(h.a)({},e),{},{regionClsList:n.concat(t.cls)})}if("MOUSE_MOVE"===t.type){if(Date.now()-(e.lastMouseMoveCall||0)<16)return e;e=Object(O.setIn)(e,["lastMouseMoveCall"],Date.now())}t.type.includes("MOUSE")||(e=Object(O.setIn)(e,["lastAction"],t));const n=Fn(e),o=n.currentImageIndex,a=n.pathToActiveImage,i=n.activeImage,r=e=>{const t="string"===typeof e||"number"===typeof e?e:e.id;if(!i)return null;const n=(i.regions||[]).findIndex(e=>e.id===t);return-1===n?null:n},s=e=>{if(!i)return null;const t=r(e);return null===t?[null,null]:[i.regions[t],t]},c=(t,n)=>{const o=s(t),r=Object(b.a)(o,2),c=r[0],l=r[1];if(!c)return e;if(null!==n)return Object(O.setIn)(e,[...a,"regions",l],Object(h.a)(Object(h.a)({},c),n));{const t=i.regions;return Object(O.setIn)(e,[...a,"regions"],(t||[]).filter(e=>e.id!==c.id))}},l=e=>null===o?e:Object(O.setIn)(e,[...a,"regions"],(i.regions||[]).map(e=>Object(h.a)(Object(h.a)({},e),{},{editingLabels:!1}))),d=(t,n)=>{let o="object"===typeof t?t:{src:t},a=(o.src,o.frameTime);return Object(O.setIn)(Object(O.setIn)(e,["selectedImage"],n),["selectedImageFrameTime"],a)};switch(t.type){case"@@INIT":return e;case"SELECT_IMAGE":return d(t.image,t.imageIndex);case"SELECT_CLASSIFICATION":return Object(O.setIn)(e,["selectedCls"],t.cls);case"CHANGE_REGION":{const n=r(t.region);if(null===n)return e;const o=i.regions[n];if(o.cls!==t.region.cls){const n=(e=Eo(e,"Change Region Classification")).regionClsList.indexOf(t.region.cls);-1!==n&&(e=Object(O.setIn)(e,["selectedCls"],t.region.cls),t.region.color=F[n%F.length])}return be()(o.tags,t.region.tags)||(e=Eo(e,"Change Region Tags")),be()(o.comment,t.region.comment)||(e=Eo(e,"Change Region Comment")),Object(O.setIn)(e,[...a,"regions",n],t.region)}case"CHANGE_IMAGE":{if(!i)return e;const n=t.delta;for(var g=0,m=Object.keys(n);g<m.length;g++){const t=m[g];"cls"===t&&Eo(e,"Change Image Class"),"tags"===t&&Eo(e,"Change Image Tags"),e=Object(O.setIn)(e,[...a,t],n[t])}return e}case"SELECT_REGION":{const n=t.region;if(null===r(t.region))return e;const o=[...i.regions||[]].map(e=>Object(h.a)(Object(h.a)({},e),{},{highlighted:e.id===n.id,editingLabels:e.id===n.id}));return Object(O.setIn)(e,[...a,"regions"],o)}case"BEGIN_MOVE_POINT":return e=l(e),Object(O.setIn)(e,["mode"],{mode:"MOVE_REGION",regionId:t.point.id});case"BEGIN_BOX_TRANSFORM":{const n=t.box,o=t.directions;return e=l(e),0===o[0]&&0===o[1]?Object(O.setIn)(e,["mode"],{mode:"MOVE_REGION",regionId:n.id}):Object(O.setIn)(e,["mode"],{mode:"RESIZE_BOX",regionId:n.id,freedom:o,original:{x:n.x,y:n.y,w:n.w,h:n.h}})}case"BEGIN_MOVE_POLYGON_POINT":{const n=t.polygon,o=t.pointIndex;return(e=l(e)).mode&&"DRAW_POLYGON"===e.mode.mode&&0===o?Object(O.setIn)(c(n,{points:n.points.slice(0,-1),open:!1}),["mode"],null):(e=Eo(e,"Move Polygon Point"),Object(O.setIn)(e,["mode"],{mode:"MOVE_POLYGON_POINT",regionId:n.id,pointIndex:o}))}case"BEGIN_MOVE_KEYPOINT":{const n=t.region,o=t.keypointId;return e=l(e),e=Eo(e,"Move Keypoint"),Object(O.setIn)(e,["mode"],{mode:"MOVE_KEYPOINT",regionId:n.id,keypointId:o})}case"ADD_POLYGON_POINT":{const n=t.polygon,o=t.point,i=t.pointIndex,s=r(n);if(null===s)return e;const c=[...n.points];return c.splice(i,0,o),Object(O.setIn)(e,[...a,"regions",s],Object(h.a)(Object(h.a)({},n),{},{points:c}))}case"MOUSE_MOVE":{const n=t.x,o=t.y;if(!e.mode)return e;if(!i)return e;e.mouseDownAt;switch(e.mode.mode){case"MOVE_POLYGON_POINT":{const t=e.mode,i=t.pointIndex,s=t.regionId,c=r(s);return null===c?e:Object(O.setIn)(e,[...a,"regions",c,"points",i],[n,o])}case"MOVE_KEYPOINT":{const t=e.mode,i=t.keypointId,r=t.regionId,c=s(r),l=Object(b.a)(c,2),d=l[0],g=l[1];return null===g?e:Object(O.setIn)(e,[...a,"regions",g,"points",i],Object(h.a)(Object(h.a)({},d.points[i]),{},{x:n,y:o}))}case"MOVE_REGION":{const t=e.mode.regionId;if("$$allowed_area"===t){const t=e.allowedArea,a=t.w,i=t.h;return Object(O.setIn)(e,["allowedArea"],{x:n-a/2,y:o-i/2,w:a,h:i})}const s=r(t);return null===s?e:Object(O.setIn)(e,[...a,"regions",s],((e,t,n)=>{switch(e.type){case"point":return Object(h.a)(Object(h.a)({},e),{},{x:t,y:n});case"box":return Object(h.a)(Object(h.a)({},e),{},{x:t-e.w/2,y:n-e.h/2})}return e})(i.regions[s],n,o))}case"RESIZE_BOX":{const t=e.mode,s=t.regionId,c=Object(b.a)(t.freedom,2),l=c[0],d=c[1],g=t.original,m=g.x,u=g.y,p=g.w,y=g.h,E=0===l?m:-1===l?Math.min(m+p,n):m,f=0===l?p:-1===l?p+(m-E):Math.max(0,p+(n-m-p)),x=0===d?u:-1===d?Math.min(u+y,o):u,w=0===d?y:-1===d?y+(u-x):Math.max(0,y+(o-u-y));if(f<=.001&&(e=Object(O.setIn)(e,["mode","freedom"],[-1*l,d])),w<=.001&&(e=Object(O.setIn)(e,["mode","freedom"],[l,-1*d])),"$$allowed_area"===s)return Object(O.setIn)(e,["allowedArea"],{x:E,w:f,y:x,h:w});const v=r(s);if(null===v)return e;const j=i.regions[v];return Object(O.setIn)(e,[...a,"regions",v],Object(h.a)(Object(h.a)({},j),{},{x:E,w:f,y:x,h:w}))}case"RESIZE_KEYPOINTS":{const t=e.mode,a=t.regionId,i=t.landmarks,r=t.centerX,s=t.centerY,l=Math.sqrt(Math.pow(r-n,2)+Math.pow(s-o,2));return c(a,{points:jo({landmarks:i,center:{x:r,y:s},scale:l/.15})})}case"DRAW_POLYGON":{const t=e.mode.regionId,i=s(t),r=Object(b.a)(i,2),c=r[0],l=r[1];return c?Object(O.setIn)(e,[...a,"regions",l,"points",c.points.length-1],[n,o]):Object(O.setIn)(e,["mode"],null)}case"DRAW_LINE":{const t=e.mode.regionId,i=s(t),r=Object(b.a)(i,2),c=r[0],l=r[1];return c?Object(O.setIn)(e,[...a,"regions",l],Object(h.a)(Object(h.a)({},c),{},{x2:n,y2:o})):Object(O.setIn)(e,["mode"],null)}case"DRAW_EXPANDING_LINE":{const t=e.mode.regionId,i=s(t),r=Object(b.a)(i,2),c=r[0],l=r[1];if(!c)return e;if(Boolean(e.mouseDownAt)){const t=c.points.slice(-1)[0],i=Math.sqrt(Math.pow(t.x-n,2)+Math.pow(t.y-o,2));return i<.002&&!t.width?e:Object(O.setIn)(e,[...a,"regions",l,"points"],c.points.slice(0,-1).concat([Object(h.a)(Object(h.a)({},t),{},{width:2*i,angle:Math.atan2(t.x-n,t.y-o)})]))}return Object(O.setIn)(e,[...a,"regions",l],Object(h.a)(Object(h.a)({},c),{},{candidatePoint:{x:n,y:o}}))}case"SET_EXPANDING_LINE_WIDTH":{const t=e.mode.regionId,i=s(t),r=Object(b.a)(i,2),c=r[0],l=r[1];if(!c)return e;const d=c.points.slice(-1)[0];e.mouseDownAt;return Object(O.setIn)(e,[...a,"regions",l,"expandingWidth"],Math.sqrt(Math.pow(d.x-n,2)+Math.pow(d.y-o,2)))}default:return e}}case"MOUSE_DOWN":{if(!i)return e;const n=t.x,o=t.y;if((e=Object(O.setIn)(e,["mouseDownAt"],{x:n,y:o})).mode)switch(e.mode.mode){case"DRAW_POLYGON":{const t=s(e.mode.regionId),i=Object(b.a)(t,2),r=i[0],c=i[1];if(!r)break;return Object(O.setIn)(e,[...a,"regions",c],Object(h.a)(Object(h.a)({},r),{},{points:r.points.concat([[n,o]])}))}case"DRAW_LINE":{const t=s(e.mode.regionId),i=Object(b.a)(t,2),r=i[0],c=i[1];if(!r)break;return Object(O.setIn)(e,[...a,"regions",c],Object(h.a)(Object(h.a)({},r),{},{x2:n,y2:o})),Object(O.setIn)(e,["mode"],null)}case"DRAW_EXPANDING_LINE":{const t=s(e.mode.regionId),i=Object(b.a)(t,2),r=i[0],c=i[1];if(!r)break;const l=r.points.slice(-1)[0];return r.points.length>1&&Math.sqrt(Math.pow(l.x-n,2)+Math.pow(l.y-o,2))<.002?l.width?e.setIn([...a,"regions",c],xo(r)).setIn(["mode"],null):Object(O.setIn)(e,["mode"],{mode:"SET_EXPANDING_LINE_WIDTH",regionId:e.mode.regionId}):Object(O.setIn)(e,[...a,"regions",c,"points"],r.points.concat([{x:n,y:o,angle:null,width:null}]))}case"SET_EXPANDING_LINE_WIDTH":{const t=s(e.mode.regionId),n=Object(b.a)(t,2),o=n[0],i=n[1];if(!o)break;const r=o.expandingWidth;return e.setIn([...a,"regions",i],xo(Object(h.a)(Object(h.a)({},o),{},{points:o.points.map(e=>e.width?e:Object(h.a)(Object(h.a)({},e),{},{width:r})),expandingWidth:void 0}))).setIn(["mode"],null)}}let r,c=e.selectedCls,l="#ff0000";const d=(e.regionClsList||[]).indexOf(c);switch(-1!==d&&(l=F[d%F.length]),e.selectedTool){case"create-point":e=Eo(e,"Create Point"),r={type:"point",x:n,y:o,highlighted:!0,editingLabels:!0,color:l,id:Io(),cls:c};break;case"create-box":e=Eo(e,"Create Box"),r={type:"box",x:n,y:o,w:0,h:0,highlighted:!0,editingLabels:!1,color:l,cls:c,id:Io()},e=Object(O.setIn)(e,["mode"],{mode:"RESIZE_BOX",editLabelEditorAfter:!0,regionId:r.id,freedom:[1,1],original:{x:n,y:o,w:r.w,h:r.h},isNew:!0});break;case"create-polygon":if(e.mode&&"DRAW_POLYGON"===e.mode.mode)break;e=Eo(e,"Create Polygon"),r={type:"polygon",points:[[n,o],[n,o]],open:!0,highlighted:!0,color:l,cls:c,id:Io()},e=Object(O.setIn)(e,["mode"],{mode:"DRAW_POLYGON",regionId:r.id});break;case"create-expanding-line":e=Eo(e,"Create Expanding Line"),r={type:"expanding-line",unfinished:!0,points:[{x:n,y:o,angle:null,width:null}],open:!0,highlighted:!0,color:l,cls:c,id:Io()},e=Object(O.setIn)(e,["mode"],{mode:"DRAW_EXPANDING_LINE",regionId:r.id});break;case"create-line":if(e.mode&&"DRAW_LINE"===e.mode.mode)break;e=Eo(e,"Create Line"),r={type:"line",x1:n,y1:o,x2:n,y2:o,highlighted:!0,editingLabels:!1,color:l,cls:c,id:Io()},e=Object(O.setIn)(e,["mode"],{mode:"DRAW_LINE",regionId:r.id});break;case"create-keypoints":{e=Eo(e,"Create Keypoints");const t=Object.entries(e.keypointDefinitions),a=Object(b.a)(t,1),i=Object(b.a)(a[0],2),s=i[0],c=i[1],l=c.landmarks;c.connections;r={type:"keypoints",keypointsDefinitionId:s,points:jo({landmarks:l,center:{x:n,y:o},scale:1}),highlighted:!0,editingLabels:!1,id:Io()},e=Object(O.setIn)(e,["mode"],{mode:"RESIZE_KEYPOINTS",landmarks:l,centerX:n,centerY:o,regionId:r.id,isNew:!0});break}}const g=[...Object(O.getIn)(e,a).regions||[]].map(e=>Object(O.setIn)(e,["editingLabels"],!1).setIn(["highlighted"],!1)).concat(r?[r]:[]);return Object(O.setIn)(e,[...a,"regions"],g)}case"MOUSE_UP":{const n=t.x,o=t.y,i=e.mouseDownAt,r=void 0===i?{x:n,y:o}:i;if(!e.mode)return e;switch((e=Object(O.setIn)(e,["mouseDownAt"],null)).mode.mode){case"RESIZE_BOX":if(e.mode.isNew&&(Math.abs(e.mode.original.x-n)<.002||Math.abs(e.mode.original.y-o)<.002))return Object(O.setIn)(c(e.mode.regionId,null),["mode"],null);if(e.mode.editLabelEditorAfter)return Object(h.a)(Object(h.a)({},c(e.mode.regionId,{editingLabels:!0})),{},{mode:null});case"MOVE_REGION":case"RESIZE_KEYPOINTS":case"MOVE_POLYGON_POINT":case"MOVE_KEYPOINT":return Object(h.a)(Object(h.a)({},e),{},{mode:null});case"CREATE_POINT_LINE":return e;case"DRAW_EXPANDING_LINE":{const t=s(e.mode.regionId),i=Object(b.a)(t,2),c=i[0],l=i[1];if(!c)return e;let d=c;const g=0!==c.points.length?c.points.slice(-1)[0]:r;let m;if(m=c.points.length>1?c.points.slice(-2)[0]:g,!(Math.sqrt(Math.pow(g.x-n,2)+Math.pow(g.y-o,2))>.002))return e;{const e=[...c.points];for(let t=0;t<e.length-1;t++)e[t].width||(e[t]=Object(h.a)(Object(h.a)({},e[t]),{},{width:g.width}));d=Object(O.setIn)(c,["points"],e)}return Object(O.setIn)(e,[...a,"regions",l],d)}default:return e}}case"OPEN_REGION_EDITOR":{t.region;const n=r(t.region);if(null===n)return e;const o=Object(O.setIn)(i.regions.map(e=>Object(h.a)(Object(h.a)({},e),{},{highlighted:!1,editingLabels:!1})),[n],Object(h.a)(Object(h.a)({},(i.regions||[])[n]),{},{highlighted:!0,editingLabels:!0}));return Object(O.setIn)(e,[...a,"regions"],o)}case"CLOSE_REGION_EDITOR":{t.region;const n=r(t.region);return null===n?e:Object(O.setIn)(e,[...a,"regions",n],Object(h.a)(Object(h.a)({},(i.regions||[])[n]),{},{editingLabels:!1}))}case"DELETE_REGION":return null===r(t.region)?e:Object(O.setIn)(e,[...a,"regions"],(i.regions||[]).filter(e=>e.id!==t.region.id));case"DELETE_SELECTED_REGION":return Object(O.setIn)(e,[...a,"regions"],(i.regions||[]).filter(e=>!e.highlighted));case"HEADER_BUTTON_CLICKED":switch(t.buttonName.toLowerCase()){case"prev":return null===o||0===o?e:d(e.images[o-1],o-1);case"next":return null===o||o===e.images.length-1?e:d(e.images[o+1],o+1);case"clone":return null===o||o===e.images.length-1?e:Object(O.setIn)(d(e.images[o+1],o+1),["images",o+1,"regions"],i.regions);case"settings":return Object(O.setIn)(e,["settingsOpen"],!e.settingsOpen);case"help":return e;case"fullscreen":return Object(O.setIn)(e,["fullScreen"],!0);case"exit fullscreen":case"window":return Object(O.setIn)(e,["fullScreen"],!1);case"hotkeys":return e;case"exit":case"done":default:return e}case"SELECT_TOOL":return"show-tags"===t.selectedTool?(u="showTags",p=!e.showTags,window.localStorage.setItem("__REACT_IMAGE_ANNOTATE_".concat(u),JSON.stringify(p)),Object(O.setIn)(e,["showTags"],!e.showTags)):"show-mask"===t.selectedTool?Object(O.setIn)(e,["showMask"],!e.showMask):("modify-allowed-area"!==t.selectedTool||e.allowedArea||(e=Object(O.setIn)(e,["allowedArea"],{x:0,y:0,w:1,h:1})),e=Object(O.setIn)(e,["mode"],null),Object(O.setIn)(e,["selectedTool"],t.selectedTool));case"CANCEL":{const t=e.mode;if(t)switch(t.mode){case"DRAW_EXPANDING_LINE":case"SET_EXPANDING_LINE_WIDTH":case"DRAW_POLYGON":return c(t.regionId,null);case"MOVE_POLYGON_POINT":case"RESIZE_BOX":case"MOVE_REGION":return Object(O.setIn)(e,["mode"],null);default:return e}const n=i.regions;if(n&&n.some(e=>e.editingLabels))return Object(O.setIn)(e,[...a,"regions"],n.map(e=>Object(h.a)(Object(h.a)({},e),{},{editingLabels:!1})));if(n)return Object(O.setIn)(e,[...a,"regions"],n.map(e=>Object(h.a)(Object(h.a)({},e),{},{highlighted:!1})));break}}var u,p;return e},Co=(e,t)=>{try{return JSON.parse(window.localStorage["__REACT_IMAGE_ANNOTATE_".concat(e)])}catch(n){return t}},Mo=(e,t)=>{const n=Fn(e),o=n.currentImageIndex;n.pathToActiveImage,n.activeImage;switch(t.type){case"IMAGE_OR_VIDEO_LOADED":return Object(O.setIn)(e,["images",o,"pixelSize"],{w:t.metadata.naturalWidth,h:t.metadata.naturalHeight})}return e},No=(e,t)=>{const n=()=>Object(O.setIn)(Eo(e,"Add Keyframe"),["keyframes",e.currentVideoTime||0],{regions:so(e.keyframes,e.currentVideoTime)});switch(t.type){case"IMAGE_OR_VIDEO_LOADED":{const n=t.metadata.duration;if("number"===typeof n)return Object(O.setIn)(e,["videoDuration"],1e3*n)}case"HEADER_BUTTON_CLICKED":switch(t.buttonName.toLowerCase()){case"play":return Object(O.setIn)(e,["videoPlaying"],!0);case"pause":return Object(O.setIn)(e,["videoPlaying"],!1)}case"CHANGE_VIDEO_TIME":return Object(O.setIn)(e,["currentVideoTime"],t.newTime);case"CHANGE_VIDEO_PLAYING":return Object(O.setIn)(e,["videoPlaying"],t.isPlaying);case"DELETE_KEYFRAME":return Object(O.setIn)(e,["keyframes"],Object(O.without)(e.keyframes,t.time))}if(!e.keyframes[e.currentVideoTime])switch(t.type){case"BEGIN_BOX_TRANSFORM":case"BEGIN_MOVE_POINT":case"BEGIN_MOVE_KEYPOINT":case"BEGIN_MOVE_POLYGON_POINT":case"ADD_POLYGON_POINT":case"SELECT_REGION":case"CHANGE_REGION":case"DELETE_REGION":case"OPEN_REGION_EDITOR":return n();case"MOUSE_DOWN":switch(e.selectedTool){case"create-point":case"create-polygon":case"create-box":case"create-keypoints":return n()}}return e};var _o=({images:e,allowedArea:t,selectedImage:n=(e&&e.length>0?0:void 0),showPointDistances:i,pointDistancePrecision:r,showTags:s=Co("showTags",!0),enabledTools:c=["select","create-point","create-box","create-polygon","create-line","create-expanding-line","show-mask"],selectedTool:l="select",regionTagList:d=[],regionClsList:g=[],imageTagList:m=[],imageClsList:u=[],keyframes:p={},taskDescription:y="",fullImageSegmentationMode:f=!1,RegionEditLabel:x,videoSrc:w,videoTime:v=0,videoName:j,onExit:I,onNextImage:T,onPrevImage:M,keypointDefinitions:N,autoSegmentationOptions:_={type:"autoseg"},hideHeader:S,hideHeaderText:k,hideNext:L,hidePrev:R,hideClone:D,hideSettings:A,hideFullScreen:P,hideSave:W,allowComments:B,onChange:z,onImageChange:G})=>{"string"===typeof n&&-1===(n=(e||[]).findIndex(e=>e.src===n))&&(n=void 0);const H=e?"image":"video",V=Object(o.useReducer)((K=((...e)=>(t,n)=>{var o,a=Object(Dt.a)(e);try{for(a.s();!(o=a.n()).done;)t=(0,o.value)(t,n)}catch(i){a.e(i)}finally{a.f()}return t})("image"===H?Mo:No,To),(e,t)=>{const n=e,o=K(e,t);if("RESTORE_HISTORY"===t.type){if(e.history.length>0)return Object(O.setIn)(o.history[0].state,["history"],o.history.slice(1))}else if(n!==o&&Object.keys(Oo).includes(t.type))return Object(O.setIn)(o,["history"],[{time:ue()().toDate(),state:Object(O.without)(n,"history"),name:Oo[t.type]||t.type}].concat(o.history||[]).slice(0,9));return o}),E()(Object(h.a)({annotationType:H,showTags:s,allowedArea:t,showPointDistances:i,pointDistancePrecision:r,selectedTool:l,fullImageSegmentationMode:f,autoSegmentationOptions:_,mode:null,taskDescription:y,showMask:!0,labelImages:u.length>0||m.length>0,regionClsList:g,regionTagList:d,imageClsList:u,imageTagList:m,currentVideoTime:v,enabledTools:c,history:[],videoName:j,keypointDefinitions:N,allowComments:B},"image"===H?{selectedImage:n,images:e,selectedImageFrameTime:e&&e.length>0?e[0].frameTime:void 0}:{videoSrc:w,keyframes:p}))),U=Object(b.a)(V,2),F=U[0],Y=U[1];var K;const X=Object(C.a)(e=>{if("HEADER_BUTTON_CLICKED"===e.type){if(["Exit","Done","Save","Complete"].includes(e.buttonName))return I(Object(O.without)(F,"history"));if("Next"===e.buttonName&&T)return T(Object(O.without)(F,"history"));if("Prev"===e.buttonName&&M)return M(Object(O.without)(F,"history"))}Y(e)}),Z=Object(C.a)(e=>{Y({type:"ON_CLS_ADDED",cls:e})}),q=Object(o.useMemo)(()=>F.images.at(F.selectedImage),[F.images,F.selectedImage]);return Object(o.useEffect)(()=>{null===z||void 0===z||z(q)},[q]),Object(o.useEffect)(()=>{null===G||void 0===G||G(F.selectedImage)},[F.selectedImage]),Object(o.useEffect)(()=>{void 0!==n&&Y({type:"SELECT_IMAGE",imageIndex:n,image:F.images[n]})},[n,F.images]),e||w?a.a.createElement(ut,null,a.a.createElement(yo,{RegionEditLabel:x,alwaysShowNextButton:Boolean(T),alwaysShowPrevButton:Boolean(M),state:F,dispatch:X,onRegionClassAdded:Z,hideHeader:S,hideHeaderText:k,hideNext:L,hidePrev:R,hideClone:D,hideSettings:A,hideFullScreen:P,hideSave:W})):'Missing required prop "images" or "videoSrc"'};const So="http://167.235.19.121:1000";function ko(){return Lo.apply(this,arguments)}function Lo(){return(Lo=Object(y.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(So,"/api/decks/1"),{mode:"cors",headers:{"Content-Type":"application/json"}});case 3:return t=e.sent,e.next=6,t.json();case 6:return n=e.sent,e.abrupt("return",n.cards.map(e=>{const t=JSON.parse(e.data);return Object(h.a)(Object(h.a)({},e),{},{src:"".concat(So).concat(e.src)},t)}));case 10:return e.prev=10,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}var Ro=()=>{const e=Object(o.useState)(0),t=Object(b.a)(e,2),n=t[0],i=t[1],r=Object(o.useState)([]),s=Object(b.a)(r,2),c=s[0],l=s[1],d=function(){var e=Object(y.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ko();case 3:t=e.sent,console.log(t),l(t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();Object(o.useEffect)(()=>{d()},[]);const g=function(){var e=Object(y.a)(p.a.mark((function e(t){var n,o,a,i,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.id,o=t.regions,a=t.pixelSize,e.next=4,fetch("".concat(So,"/api/cards/").concat(n),{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({regions:o,pixelSize:a})});case 4:return i=e.sent,e.next=7,i.json();case 7:r=e.sent,console.log(r),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}();return c.length?a.a.createElement("div",null,a.a.createElement(_o,{labelImages:!0,showTags:!0,allowComments:!0,isLabelOn:!0,hideClone:!0,hideNext:n===c.length-1,hidePrev:0===n,hideSettings:!0,imageClsList:[],regionClsList:[...new Set(c.map(e=>e.regions.map(e=>e.cls)).flat())],enabledTools:["create-polygon","select"],images:c,selectedImage:n,onExit:e=>{g(e.images[e.selectedImage]),console.log(e)},onChange:e=>console.log(e),onNextImage:e=>{i(e=>e+1),g(e.images[e.selectedImage])},onPrevImage:e=>{i(e=>e-1),g(e.images[e.selectedImage])}})):a.a.createElement("div",null,"Loading...")};n(659);const Do=()=>a.a.createElement(m,null,a.a.createElement(Ro,null));r.a.render(a.a.createElement(Do,null),document.getElementById("root"))}},[[449,1,2]]]);
//# sourceMappingURL=main.50ae11d0.chunk.js.map